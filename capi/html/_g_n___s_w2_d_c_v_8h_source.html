<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>proteus: GN_SW2DCV.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX-AMS-MML_HTMLorMML.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proteus
   &#160;<span id="projectnumber">1.7.2</span>
   </div>
   <div id="projectbrief">C/C++/Fortran libraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_43e0a1f539e00dcfa1a6bc4d4fee4fc2.html">home</a></li><li class="navelem"><a class="el" href="dir_08a8391b992a14344a0999056aee6393.html">tridelat</a></li><li class="navelem"><a class="el" href="dir_ea00e9b50a0f6d637a9dd4ed40825cbc.html">PROTEUS</a></li><li class="navelem"><a class="el" href="dir_d23a82edd4ac0940d9425868b4e8e61c.html">proteus2</a></li><li class="navelem"><a class="el" href="dir_fe87453fcfc0d512029001dc42c43d5c.html">proteus</a></li><li class="navelem"><a class="el" href="dir_7345f39f9a430cfefb4e585cf0572b86.html">mprans</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">GN_SW2DCV.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_g_n___s_w2_d_c_v_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#ifndef GN_SW2DCV_H</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#define GN_SW2DCV_H</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_comp_kernel_8h.html">CompKernel.h</a>&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_model_factory_8h.html">ModelFactory.h</a>&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;valarray&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; </div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// cek todo</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// 2. Get stabilization right</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// 3. Add Riemann solvers for external flux</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// 4. Add Riemann solvers for internal flux and DG terms</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// 5. Try other choices of variables h,hu,hv, Bova-Carey symmetrization?</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="_g_n___s_w2_d_c_v_8h.html#aa30b36303b632a14d8f23dd32b047922">   17</a></span>&#160;<span class="preprocessor">#define GLOBAL_FCT 0</span></div>
<div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="_g_n___s_w2_d_c_v_8h.html#a3452ab29367216c56ee2ef46257c22be">   18</a></span>&#160;<span class="preprocessor">#define POWER_SMOOTHNESS_INDICATOR 4</span></div>
<div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">   19</a></span>&#160;<span class="preprocessor">#define VEL_FIX_POWER 2.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="_g_n___s_w2_d_c_v_8h.html#ab3b1ffcd39d6fc4308df5f1494e0b028">   20</a></span>&#160;<span class="preprocessor">#define REESTIMATE_MAX_EDGE_BASED_CFL 0</span></div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">   21</a></span>&#160;<span class="preprocessor">#define LAMBDA_MGN 1</span></div>
<div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="_g_n___s_w2_d_c_v_8h.html#a10b9177dd08eb7e17dd16dba2a85fc3a">   22</a></span>&#160;<span class="preprocessor">#define IF_BOTH_GAMMA_BRANCHES 0</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceproteus.html">proteus</a> {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">// for mGN stuff &quot;max&quot; wave speeds. See section 4.4 of first mGN paper by</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// Guermond, Popov, Tovar, Kees for formulas</span></div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="namespaceproteus.html#adc5e96637123993f3be93306da696177">   28</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#adc5e96637123993f3be93306da696177">GN_nu1</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hL, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uL,</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;etaL, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;meshSizeL) {</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordtype">double</span> augL = <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> / (3. * meshSizeL) * (6. * hL + 12. * (hL - etaL));</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordflow">if</span> (etaL &gt;= hL) {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    augL = <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> / (3. * meshSizeL) * (6. * hL);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  }</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  augL = augL * std::pow(meshSizeL / fmax(meshSizeL, hL), 2);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">return</span> uL - sqrt(g * hL) * sqrt(1. + augL);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;}</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="namespaceproteus.html#ab14e2f847e0f10815ee8f083bfae1b0e">   40</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#ab14e2f847e0f10815ee8f083bfae1b0e">GN_nu3</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hR, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uR,</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;etaR, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;meshSizeR) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="comment">// See section 4.4 of first mGN paper by Guermond, Popov, Tovar, Kees for</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="comment">// formulas</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordtype">double</span> augR = <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> / (3. * meshSizeR) * (6. * hR + 12. * (hR - etaR));</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordflow">if</span> (etaR &gt;= hR) {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    augR = <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> / (3. * meshSizeR) * (6. * hR);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  augR = augR * std::pow(meshSizeR / fmax(meshSizeR, hR), 2);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">return</span> uR + sqrt(g * hR) * sqrt(1 + augR);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// FOR CELL BASED ENTROPY VISCOSITY</span></div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a168fa7179bef9c8bff1dc8fbdf4737ca">   54</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a168fa7179bef9c8bff1dc8fbdf4737ca">ENTROPY</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hu,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                      <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hv, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;<a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                      <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;one_over_hReg) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">return</span> 0.5 *</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;         (g * h * h + one_over_hReg * (hu * hu + hv * hv) + 2. * g * h * <a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="namespaceproteus.html#aa7382e6e38581baca5f477ee2d1a4ed4">   60</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#aa7382e6e38581baca5f477ee2d1a4ed4">DENTROPY_DH</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hu,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                          <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hv, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;<a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                          <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;one_over_hReg) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">return</span> g * h - 0.5 * (hu * hu + hv * hv) * std::pow(one_over_hReg, 2) + g * <a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a5eb23919a33f36a2faf26440020d0a70">   65</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a5eb23919a33f36a2faf26440020d0a70">DENTROPY_DHU</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hu,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hv, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;<a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;one_over_hReg) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">return</span> hu * one_over_hReg;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;}</div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a9db7dbbd169fd6f6b5a8d999bcdf9db1">   70</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a9db7dbbd169fd6f6b5a8d999bcdf9db1">DENTROPY_DHV</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hu,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hv, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;<a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;one_over_hReg) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">return</span> hv * one_over_hReg;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;}</div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a1eb3932cf3ec78d9e5e0a63256d5378a">   75</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a1eb3932cf3ec78d9e5e0a63256d5378a">ENTROPY_FLUX1</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hu,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hv, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;<a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;one_over_hReg) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="namespaceproteus.html#a168fa7179bef9c8bff1dc8fbdf4737ca">ENTROPY</a>(g, h, hu, hv, <a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>, one_over_hReg) + 0.5 * g * h * h +</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;          g * h * <a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>) *</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;         hu * one_over_hReg;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}</div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="namespaceproteus.html#ac5017200ca551e2c3c646a25c6619391">   82</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#ac5017200ca551e2c3c646a25c6619391">ENTROPY_FLUX2</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hu,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hv, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;<a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>,</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;one_over_hReg) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="namespaceproteus.html#a168fa7179bef9c8bff1dc8fbdf4737ca">ENTROPY</a>(g, h, hu, hv, <a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>, one_over_hReg) + 0.5 * g * h * h +</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;          g * h * <a class="code" href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a>) *</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;         hv * one_over_hReg;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">// FOR ESTIMATING MAX WAVE SPEEDS, GIVE REFERENCE</span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="namespaceproteus.html#af05ccedae3a5249ffcee18ba28860db4">   90</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#af05ccedae3a5249ffcee18ba28860db4">f</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hZ) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordflow">return</span> ((h &lt;= hZ) ? 2. * (sqrt(g * h) - sqrt(g * hZ))</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                    : (h - hZ) * sqrt(0.5 * g * (h + hZ) / h / hZ));</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">   94</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hL,</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                  <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hR, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uL, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uR) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="namespaceproteus.html#af05ccedae3a5249ffcee18ba28860db4">f</a>(g, h, hL) + <a class="code" href="namespaceproteus.html#af05ccedae3a5249ffcee18ba28860db4">f</a>(g, h, hR) + uR - uL);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="namespaceproteus.html#aea851b1d02fbb510e83331beade83dbc">   98</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#aea851b1d02fbb510e83331beade83dbc">fp</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hZ) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordflow">return</span> ((h &lt;= hZ)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;              ? sqrt(g / h)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;              : g * (2 * h * h + h * hZ + hZ * hZ) /</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                    (2 * sqrt(2 * g) * h * h * hZ * sqrt(1 / h + 1 / hZ)));</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;}</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a475fb9d85bb327fe4849011189f20e62">  104</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a475fb9d85bb327fe4849011189f20e62">phip</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hL,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hR) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="namespaceproteus.html#aea851b1d02fbb510e83331beade83dbc">fp</a>(g, h, hL) + <a class="code" href="namespaceproteus.html#aea851b1d02fbb510e83331beade83dbc">fp</a>(g, h, hR));</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="namespaceproteus.html#aafdd121958af52516e1f8564c737cbf3">  108</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#aafdd121958af52516e1f8564c737cbf3">nu1</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hStar, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hL,</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                  <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uL) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">return</span> (uL - sqrt(g * hL) * sqrt((1 + fmax((hStar - hL) / 2 / hL, 0.0)) *</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                                   (1 + fmax((hStar - hL) / hL, 0.))));</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a75eb6ad7fbb7f589b2e8a6b836e0bae2">  113</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a75eb6ad7fbb7f589b2e8a6b836e0bae2">nu3</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hStar, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hR,</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                  <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uR) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordflow">return</span> (uR + sqrt(g * hR) * sqrt((1 + fmax((hStar - hR) / 2 / hR, 0.0)) *</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                                   (1 + fmax((hStar - hR) / hR, 0.))));</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;}</div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a24e3549b98c861e0a822612a088a0d82">  118</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a24e3549b98c861e0a822612a088a0d82">phiDiff</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h1k, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h2k,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                      <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hL, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hR, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uL,</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                      <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uR) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordflow">return</span> ((<a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, h2k, hL, hR, uL, uR) - <a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, h1k, hL, hR, uL, uR)) /</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          (h2k - h1k));</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a7667307f5ed3630618f22cc94c48d7af">  124</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a7667307f5ed3630618f22cc94c48d7af">phiDDiff1</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h1k, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h2k,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hL, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hR, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uL,</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uR) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">return</span> ((<a class="code" href="namespaceproteus.html#a24e3549b98c861e0a822612a088a0d82">phiDiff</a>(g, h1k, h2k, hL, hR, uL, uR) - <a class="code" href="namespaceproteus.html#a475fb9d85bb327fe4849011189f20e62">phip</a>(g, h1k, hL, hR)) /</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;          (h2k - h1k));</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a2883fc0e26145438f8d6d901e5af539c">  130</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a2883fc0e26145438f8d6d901e5af539c">phiDDiff2</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h1k, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h2k,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hL, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hR, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uL,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uR) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">return</span> ((<a class="code" href="namespaceproteus.html#a475fb9d85bb327fe4849011189f20e62">phip</a>(g, h2k, hL, hR) - <a class="code" href="namespaceproteus.html#a24e3549b98c861e0a822612a088a0d82">phiDiff</a>(g, h1k, h2k, hL, hR, uL, uR)) /</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;          (h2k - h1k));</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="namespaceproteus.html#a7330c388dd299f1f57a761407b3f9803">  136</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#a7330c388dd299f1f57a761407b3f9803">hStarLFromQuadPhiFromAbove</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hStarL,</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hStarR, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hL,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hR, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uL,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uR) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordflow">return</span> (hStarL -</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;          2 * <a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, hStarL, hL, hR, uL, uR) /</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;              (<a class="code" href="namespaceproteus.html#a475fb9d85bb327fe4849011189f20e62">phip</a>(g, hStarL, hL, hR) +</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;               sqrt(std::pow(<a class="code" href="namespaceproteus.html#a475fb9d85bb327fe4849011189f20e62">phip</a>(g, hStarL, hL, hR), 2) -</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                    4 * <a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, hStarL, hL, hR, uL, uR) *</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        <a class="code" href="namespaceproteus.html#a7667307f5ed3630618f22cc94c48d7af">phiDDiff1</a>(g, hStarL, hStarR, hL, hR, uL, uR))));</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="namespaceproteus.html#aa4fb5dbd416856817199520f28e815b6">  147</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="namespaceproteus.html#aa4fb5dbd416856817199520f28e815b6">hStarRFromQuadPhiFromBelow</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hStarL,</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hStarR, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hL,</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hR, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uL,</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;uR) {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordflow">return</span> (hStarR -</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;          2 * <a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, hStarR, hL, hR, uL, uR) /</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;              (<a class="code" href="namespaceproteus.html#a475fb9d85bb327fe4849011189f20e62">phip</a>(g, hStarR, hL, hR) +</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;               sqrt(std::pow(<a class="code" href="namespaceproteus.html#a475fb9d85bb327fe4849011189f20e62">phip</a>(g, hStarR, hL, hR), 2) -</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                    4 * <a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, hStarR, hL, hR, uL, uR) *</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                        <a class="code" href="namespaceproteus.html#a2883fc0e26145438f8d6d901e5af539c">phiDDiff2</a>(g, hStarL, hStarR, hL, hR, uL, uR))));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;}</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;} <span class="comment">// namespace proteus</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceproteus.html">proteus</a> {</div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html">  161</a></span>&#160;<span class="keyword">class </span><a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html">GN_SW2DCV_base</a> {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">  163</a></span>&#160;  std::valarray&lt;double&gt; <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>, <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>, <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>, <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>, <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>, <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>, <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>,</div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">  164</a></span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>, <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ab50314b4fa3cd11d2ff906d644950a03">hwLow</a>, <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ac6e00955095da826c07d5a65e419776c">  165</a></span>&#160;  <span class="keyword">virtual</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ac6e00955095da826c07d5a65e419776c">~GN_SW2DCV_base</a>() {}</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ac6bd84763068cb470a81a333430bdf42">FCTStep</a>(<span class="keywordtype">double</span> dt,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;          <span class="keywordtype">int</span> NNZ,     <span class="comment">// number on non-zero entries on sparsity pattern</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          <span class="keywordtype">int</span> numDOFs, <span class="comment">// number of DOFs</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;          <span class="keywordtype">double</span> *lumped_mass_matrix, <span class="comment">// lumped mass matrix (as vector)</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;          <span class="keywordtype">double</span> *h_old,              <span class="comment">// DOFs of solution at last stage</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;          <span class="keywordtype">double</span> *hu_old, <span class="keywordtype">double</span> *hv_old, <span class="keywordtype">double</span> *heta_old, <span class="keywordtype">double</span> *hw_old,</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;          <span class="keywordtype">double</span> *b_dof,</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;          <span class="keywordtype">double</span> *high_order_hnp1, <span class="comment">// DOFs of high order solution at tnp1</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;          <span class="keywordtype">double</span> *high_order_hunp1, <span class="keywordtype">double</span> *high_order_hvnp1,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;          <span class="keywordtype">double</span> *high_order_hetanp1, <span class="keywordtype">double</span> *high_order_hwnp1,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          <span class="keywordtype">double</span> *extendedSourceTerm_hu, <span class="keywordtype">double</span> *extendedSourceTerm_hv,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;          <span class="keywordtype">double</span> *extendedSourceTerm_heta, <span class="keywordtype">double</span> *extendedSourceTerm_hw,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;          <span class="keywordtype">double</span> *limited_hnp1, <span class="keywordtype">double</span> *limited_hunp1, <span class="keywordtype">double</span> *limited_hvnp1,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;          <span class="keywordtype">double</span> *limited_hetanp1, <span class="keywordtype">double</span> *limited_hwnp1,</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          <span class="keywordtype">int</span> *csrRowIndeces_DofLoops,    <span class="comment">// csr row indeces</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;          <span class="keywordtype">int</span> *csrColumnOffsets_DofLoops, <span class="comment">// csr column offsets</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;          <span class="keywordtype">double</span> *MassMatrix,             <span class="comment">// mass matrix</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;          <span class="keywordtype">double</span> *dH_minus_dL, <span class="keywordtype">double</span> *muH_minus_muL, <span class="keywordtype">double</span> hEps, <span class="keywordtype">double</span> *hReg,</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;          <span class="keywordtype">int</span> LUMPED_MASS_MATRIX,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          <span class="comment">// LOCAL LIMITING</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          <span class="keywordtype">double</span> *dLow, <span class="keywordtype">double</span> *hBT, <span class="keywordtype">double</span> *huBT, <span class="keywordtype">double</span> *hvBT, <span class="keywordtype">double</span> *hetaBT,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;          <span class="keywordtype">double</span> *hwBT) = 0;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a502f4f7aa291898c7da52a885c329295">convexLimiting</a>(</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordtype">double</span> dt,</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordtype">int</span> NNZ,     <span class="comment">// number on non-zero entries on sparsity pattern</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordtype">int</span> numDOFs, <span class="comment">// number of DOFs</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keywordtype">double</span> *lumped_mass_matrix, <span class="comment">// lumped mass matrix (as vector)</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordtype">double</span> *h_old,              <span class="comment">// DOFs of solution at last stage</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordtype">double</span> *hu_old, <span class="keywordtype">double</span> *hv_old, <span class="keywordtype">double</span> *heta_old, <span class="keywordtype">double</span> *hw_old,</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordtype">double</span> *b_dof,</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordtype">double</span> *high_order_hnp1, <span class="comment">// DOFs of high order solution at tnp1</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keywordtype">double</span> *high_order_hunp1, <span class="keywordtype">double</span> *high_order_hvnp1,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordtype">double</span> *high_order_hetanp1, <span class="keywordtype">double</span> *high_order_hwnp1,</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordtype">double</span> *extendedSourceTerm_hu, <span class="keywordtype">double</span> *extendedSourceTerm_hv,</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordtype">double</span> *extendedSourceTerm_heta, <span class="keywordtype">double</span> *extendedSourceTerm_hw,</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordtype">double</span> *limited_hnp1, <span class="keywordtype">double</span> *limited_hunp1, <span class="keywordtype">double</span> *limited_hvnp1,</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordtype">double</span> *limited_hetanp1, <span class="keywordtype">double</span> *limited_hwnp1,</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_DofLoops,    <span class="comment">// csr row indeces</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_DofLoops, <span class="comment">// csr column offsets</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keywordtype">double</span> *MassMatrix,             <span class="comment">// mass matrix</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keywordtype">double</span> *dH_minus_dL, <span class="keywordtype">double</span> *muH_minus_muL, <span class="keywordtype">double</span> hEps, <span class="keywordtype">double</span> *hReg,</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordtype">int</span> LUMPED_MASS_MATRIX,</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="comment">// LOCAL LIMITING</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keywordtype">double</span> *dLow, <span class="keywordtype">double</span> *hBT, <span class="keywordtype">double</span> *huBT, <span class="keywordtype">double</span> *hvBT, <span class="keywordtype">double</span> *hetaBT,</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordtype">double</span> *hwBT, <span class="keywordtype">double</span> *new_SourceTerm_hu, <span class="keywordtype">double</span> *new_SourceTerm_hv,</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordtype">double</span> *new_SourceTerm_heta, <span class="keywordtype">double</span> *new_SourceTerm_hw) = 0;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a3ce25285b7615ee67d67513149711ed3">calculateEdgeBasedCFL</a>(</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="keywordtype">double</span> g,</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordtype">int</span> numDOFsPerEqn,          <span class="comment">// number of DOFs</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordtype">double</span> *lumped_mass_matrix, <span class="comment">// lumped mass matrix (as vector)</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordtype">double</span> *h_old,              <span class="comment">// DOFs of solution at last stage</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <span class="keywordtype">double</span> *hu_old, <span class="keywordtype">double</span> *hv_old, <span class="keywordtype">double</span> *heta_old, <span class="keywordtype">double</span> *b_dof,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_DofLoops,    <span class="comment">// csr row indeces</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_DofLoops, <span class="comment">// csr column offsets</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordtype">double</span> hEps, <span class="keywordtype">double</span> *hReg, <span class="keywordtype">double</span> *Cx, <span class="keywordtype">double</span> *Cy, <span class="keywordtype">double</span> *CTx,</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="keywordtype">double</span> *CTy, <span class="keywordtype">double</span> *dLow, <span class="keywordtype">double</span> run_cfl, <span class="keywordtype">double</span> *edge_based_cfl,</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="keywordtype">int</span> debug) = 0;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ad8491c72b07674f0b84a021454406b36">calculateResidual</a>( <span class="comment">// last EDGE BASED version</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_ref, <span class="keywordtype">double</span> *mesh_grad_trial_ref, <span class="keywordtype">double</span> *mesh_dof,</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="keywordtype">double</span> *mesh_velocity_dof,</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keywordtype">double</span> MOVING_DOMAIN, <span class="comment">// 0 or 1</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="keywordtype">int</span> *mesh_l2g, <span class="keywordtype">double</span> *dV_ref, <span class="keywordtype">double</span> *h_trial_ref,</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <span class="keywordtype">double</span> *h_grad_trial_ref, <span class="keywordtype">double</span> *h_test_ref, <span class="keywordtype">double</span> *h_grad_test_ref,</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordtype">double</span> *vel_trial_ref, <span class="keywordtype">double</span> *vel_grad_trial_ref, <span class="keywordtype">double</span> *vel_test_ref,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="keywordtype">double</span> *vel_grad_test_ref,</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="comment">// element boundary</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_trace_ref, <span class="keywordtype">double</span> *mesh_grad_trial_trace_ref,</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordtype">double</span> *dS_ref, <span class="keywordtype">double</span> *h_trial_trace_ref, <span class="keywordtype">double</span> *h_grad_trial_trace_ref,</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="keywordtype">double</span> *h_test_trace_ref, <span class="keywordtype">double</span> *h_grad_test_trace_ref,</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="keywordtype">double</span> *vel_trial_trace_ref, <span class="keywordtype">double</span> *vel_grad_trial_trace_ref,</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordtype">double</span> *vel_test_trace_ref, <span class="keywordtype">double</span> *vel_grad_test_trace_ref,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordtype">double</span> *normal_ref, <span class="keywordtype">double</span> *boundaryJac_ref,</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <span class="comment">// physics</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordtype">double</span> *elementDiameter, <span class="keywordtype">int</span> nElements_global, <span class="keywordtype">double</span> useRBLES,</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="keywordtype">double</span> useMetrics, <span class="keywordtype">double</span> alphaBDF, <span class="keywordtype">double</span> nu, <span class="keywordtype">double</span> g, <span class="keywordtype">int</span> *h_l2g,</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="keywordtype">int</span> *vel_l2g, <span class="keywordtype">double</span> *h_dof_old, <span class="keywordtype">double</span> *hu_dof_old, <span class="keywordtype">double</span> *hv_dof_old,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keywordtype">double</span> *heta_dof_old, <span class="keywordtype">double</span> *hw_dof_old, <span class="keywordtype">double</span> *b_dof, <span class="keywordtype">double</span> *h_dof,</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="keywordtype">double</span> *hu_dof, <span class="keywordtype">double</span> *hv_dof, <span class="keywordtype">double</span> *heta_dof, <span class="keywordtype">double</span> *hw_dof,</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordtype">double</span> *h_dof_sge, <span class="keywordtype">double</span> *hu_dof_sge, <span class="keywordtype">double</span> *hv_dof_sge,</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordtype">double</span> *heta_dof_sge, <span class="keywordtype">double</span> *hw_dof_sge, <span class="keywordtype">double</span> *q_mass_acc,</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="keywordtype">double</span> *q_mom_hu_acc, <span class="keywordtype">double</span> *q_mom_hv_acc, <span class="keywordtype">double</span> *q_mass_adv,</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordtype">double</span> *q_mass_acc_beta_bdf, <span class="keywordtype">double</span> *q_mom_hu_acc_beta_bdf,</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keywordtype">double</span> *q_mom_hv_acc_beta_bdf, <span class="keywordtype">double</span> *q_cfl, <span class="keywordtype">int</span> *sdInfo_hu_hu_rowptr,</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hu_hu_colind, <span class="keywordtype">int</span> *sdInfo_hu_hv_rowptr,</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hu_hv_colind, <span class="keywordtype">int</span> *sdInfo_hv_hv_rowptr,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hv_colind, <span class="keywordtype">int</span> *sdInfo_hv_hu_rowptr,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hu_colind, <span class="keywordtype">int</span> offset_h, <span class="keywordtype">int</span> offset_hu, <span class="keywordtype">int</span> offset_hv,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keywordtype">int</span> offset_heta, <span class="keywordtype">int</span> offset_hw, <span class="keywordtype">int</span> stride_h, <span class="keywordtype">int</span> stride_hu,</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordtype">int</span> stride_hv, <span class="keywordtype">int</span> stride_heta, <span class="keywordtype">int</span> stride_hw, <span class="keywordtype">double</span> *globalResidual,</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="keywordtype">int</span> nExteriorElementBoundaries_global,</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keywordtype">int</span> *exteriorElementBoundariesArray, <span class="keywordtype">int</span> *elementBoundaryElementsArray,</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="keywordtype">int</span> *elementBoundaryLocalElementBoundariesArray, <span class="keywordtype">int</span> *isDOFBoundary_h,</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keywordtype">int</span> *isDOFBoundary_hu, <span class="keywordtype">int</span> *isDOFBoundary_hv,</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_h, <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hu,</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hv, <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hu,</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hv, <span class="keywordtype">double</span> *ebqe_bc_h_ext,</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mass_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hu_adv_ext,</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hv_adv_ext, <span class="keywordtype">double</span> *ebqe_bc_hu_ext,</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_hu_diff_ext, <span class="keywordtype">double</span> *ebqe_penalty_ext,</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_hv_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_hv_diff_ext,</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="keywordtype">double</span> *q_velocity, <span class="keywordtype">double</span> *ebqe_velocity, <span class="keywordtype">double</span> *flux,</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordtype">double</span> *elementResidual_h,</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="comment">// C matrices</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordtype">double</span> *Cx, <span class="keywordtype">double</span> *Cy, <span class="keywordtype">double</span> *CTx, <span class="keywordtype">double</span> *CTy,</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="comment">// PARAMETERS FOR EDGE BASED STABILIZATION</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordtype">int</span> numDOFsPerEqn, <span class="keywordtype">int</span> NNZ, <span class="keywordtype">int</span> *csrRowIndeces_DofLoops,</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_DofLoops,</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="comment">// LUMPED MASS MATRIX</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keywordtype">double</span> *lumped_mass_matrix, <span class="keywordtype">double</span> cfl_run, <span class="keywordtype">double</span> hEps, <span class="keywordtype">double</span> *hReg,</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="comment">// SAVE SOLUTION (mql)</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordtype">double</span> *hnp1_at_quad_point, <span class="keywordtype">double</span> *hunp1_at_quad_point,</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keywordtype">double</span> *hvnp1_at_quad_point, <span class="keywordtype">double</span> *hetanp1_at_quad_point,</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="keywordtype">double</span> *hwnp1_at_quad_point,</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="comment">// TO COMPUTE LOW ORDER</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordtype">double</span> *extendedSourceTerm_hu, <span class="keywordtype">double</span> *extendedSourceTerm_hv,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordtype">double</span> *extendedSourceTerm_heta, <span class="keywordtype">double</span> *extendedSourceTerm_hw,</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="comment">// FOR FCT</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="keywordtype">double</span> *dH_minus_dL, <span class="keywordtype">double</span> *muH_minus_muL, <span class="keywordtype">double</span> <a class="code" href="_n_c_l_s3_p_8h.html#ac3a8009eac7340083df50a7d681f77bc">cE</a>,</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordtype">int</span> LUMPED_MASS_MATRIX, <span class="keywordtype">double</span> dt, <span class="keywordtype">int</span> LINEAR_FRICTION, <span class="keywordtype">double</span> mannings,</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="comment">// Quant of interests</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keywordtype">double</span> *quantDOFs, <span class="keywordtype">int</span> SECOND_CALL_CALCULATE_RESIDUAL,</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="comment">// NORMAL COMPONENTS</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordtype">int</span> COMPUTE_NORMALS, <span class="keywordtype">double</span> *normalx, <span class="keywordtype">double</span> *normaly, <span class="keywordtype">double</span> *dLow,</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      <span class="keywordtype">double</span> *hBT, <span class="keywordtype">double</span> *huBT, <span class="keywordtype">double</span> *hvBT, <span class="keywordtype">double</span> *hetaBT, <span class="keywordtype">double</span> *hwBT,</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordtype">int</span> lstage, <span class="keywordtype">double</span> *new_SourceTerm_hu, <span class="keywordtype">double</span> *new_SourceTerm_hv,</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="keywordtype">double</span> *new_SourceTerm_heta, <span class="keywordtype">double</span> *new_SourceTerm_hw) = 0;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#af6240d87277608a214507e7580087dee">calculateMassMatrix</a>( <span class="comment">// element</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_ref, <span class="keywordtype">double</span> *mesh_grad_trial_ref, <span class="keywordtype">double</span> *mesh_dof,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordtype">double</span> *mesh_velocity_dof, <span class="keywordtype">double</span> MOVING_DOMAIN, <span class="keywordtype">int</span> *mesh_l2g,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keywordtype">double</span> *dV_ref, <span class="keywordtype">double</span> *h_trial_ref, <span class="keywordtype">double</span> *h_grad_trial_ref,</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keywordtype">double</span> *h_test_ref, <span class="keywordtype">double</span> *h_grad_test_ref, <span class="keywordtype">double</span> *vel_trial_ref,</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keywordtype">double</span> *vel_grad_trial_ref, <span class="keywordtype">double</span> *vel_test_ref,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="keywordtype">double</span> *vel_grad_test_ref,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="comment">// element boundary</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_trace_ref, <span class="keywordtype">double</span> *mesh_grad_trial_trace_ref,</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="keywordtype">double</span> *dS_ref, <span class="keywordtype">double</span> *h_trial_trace_ref, <span class="keywordtype">double</span> *h_grad_trial_trace_ref,</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordtype">double</span> *h_test_trace_ref, <span class="keywordtype">double</span> *h_grad_test_trace_ref,</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordtype">double</span> *vel_trial_trace_ref, <span class="keywordtype">double</span> *vel_grad_trial_trace_ref,</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="keywordtype">double</span> *vel_test_trace_ref, <span class="keywordtype">double</span> *vel_grad_test_trace_ref,</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keywordtype">double</span> *normal_ref, <span class="keywordtype">double</span> *boundaryJac_ref,</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="comment">// physics</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keywordtype">double</span> *elementDiameter, <span class="keywordtype">int</span> nElements_global, <span class="keywordtype">double</span> useRBLES,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordtype">double</span> useMetrics, <span class="keywordtype">double</span> alphaBDF, <span class="keywordtype">double</span> nu, <span class="keywordtype">double</span> g, <span class="keywordtype">int</span> *h_l2g,</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordtype">int</span> *vel_l2g, <span class="keywordtype">double</span> *b_dof, <span class="keywordtype">double</span> *h_dof, <span class="keywordtype">double</span> *hu_dof,</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordtype">double</span> *hv_dof, <span class="keywordtype">double</span> *heta_dof, <span class="keywordtype">double</span> *hw_dof, <span class="keywordtype">double</span> *h_dof_sge,</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordtype">double</span> *hu_dof_sge, <span class="keywordtype">double</span> *hv_dof_sge, <span class="keywordtype">double</span> *heta_dof_sge,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keywordtype">double</span> *hw_dof_sge, <span class="keywordtype">double</span> *q_mass_acc_beta_bdf,</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordtype">double</span> *q_mom_hu_acc_beta_bdf, <span class="keywordtype">double</span> *q_mom_hv_acc_beta_bdf,</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keywordtype">double</span> *q_cfl, <span class="keywordtype">int</span> *sdInfo_hu_hu_rowptr, <span class="keywordtype">int</span> *sdInfo_hu_hu_colind,</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hu_hv_rowptr, <span class="keywordtype">int</span> *sdInfo_hu_hv_colind,</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hv_rowptr, <span class="keywordtype">int</span> *sdInfo_hv_hv_colind,</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hu_rowptr, <span class="keywordtype">int</span> *sdInfo_hv_hu_colind,</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="comment">// h</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_h, <span class="keywordtype">int</span> *csrColumnOffsets_h_h,</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hu, <span class="keywordtype">int</span> *csrColumnOffsets_h_hu,</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hv, <span class="keywordtype">int</span> *csrColumnOffsets_h_hv,</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_heta, <span class="keywordtype">int</span> *csrColumnOffsets_h_heta,</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hw, <span class="keywordtype">int</span> *csrColumnOffsets_h_hw,</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="comment">// hu</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_h, <span class="keywordtype">int</span> *csrColumnOffsets_hu_h,</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hu,</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hv,</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hu_heta,</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hw,</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="comment">// hv</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_h, <span class="keywordtype">int</span> *csrColumnOffsets_hv_h,</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hu,</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hv,</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hv_heta,</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hw,</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="comment">// heta</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_h, <span class="keywordtype">int</span> *csrColumnOffsets_heta_h,</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hu, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hu,</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hv, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hv,</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_heta, <span class="keywordtype">int</span> *csrColumnOffsets_heta_heta,</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hw, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hw,</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="comment">// hw</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_h, <span class="keywordtype">int</span> *csrColumnOffsets_hw_h,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hu,</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hv,</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hw_heta,</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hw,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordtype">double</span> *globalJacobian, <span class="keywordtype">int</span> nExteriorElementBoundaries_global,</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordtype">int</span> *exteriorElementBoundariesArray, <span class="keywordtype">int</span> *elementBoundaryElementsArray,</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="keywordtype">int</span> *elementBoundaryLocalElementBoundariesArray, <span class="keywordtype">int</span> *isDOFBoundary_h,</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <span class="keywordtype">int</span> *isDOFBoundary_hu, <span class="keywordtype">int</span> *isDOFBoundary_hv,</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_h, <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hu,</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hv, <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hu,</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hv, <span class="keywordtype">double</span> *ebqe_bc_h_ext,</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mass_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hu_adv_ext,</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hv_adv_ext, <span class="keywordtype">double</span> *ebqe_bc_hu_ext,</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_hu_diff_ext, <span class="keywordtype">double</span> *ebqe_penalty_ext,</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_hv_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_hv_diff_ext,</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_h, <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_hu,</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_hv, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_h,</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_hu, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_hv,</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_h, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_hu,</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_hv, <span class="keywordtype">double</span> dt) = 0;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a77009295d486912b7757c95258ed6c1f">calculateLumpedMassMatrix</a>( <span class="comment">// element</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_ref, <span class="keywordtype">double</span> *mesh_grad_trial_ref, <span class="keywordtype">double</span> *mesh_dof,</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordtype">double</span> *mesh_velocity_dof, <span class="keywordtype">double</span> MOVING_DOMAIN, <span class="keywordtype">int</span> *mesh_l2g,</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordtype">double</span> *dV_ref, <span class="keywordtype">double</span> *h_trial_ref, <span class="keywordtype">double</span> *h_grad_trial_ref,</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="keywordtype">double</span> *h_test_ref, <span class="keywordtype">double</span> *h_grad_test_ref, <span class="keywordtype">double</span> *vel_trial_ref,</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordtype">double</span> *vel_grad_trial_ref, <span class="keywordtype">double</span> *vel_test_ref,</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordtype">double</span> *vel_grad_test_ref,</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="comment">// element boundary</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_trace_ref, <span class="keywordtype">double</span> *mesh_grad_trial_trace_ref,</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="keywordtype">double</span> *dS_ref, <span class="keywordtype">double</span> *h_trial_trace_ref, <span class="keywordtype">double</span> *h_grad_trial_trace_ref,</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordtype">double</span> *h_test_trace_ref, <span class="keywordtype">double</span> *h_grad_test_trace_ref,</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="keywordtype">double</span> *vel_trial_trace_ref, <span class="keywordtype">double</span> *vel_grad_trial_trace_ref,</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordtype">double</span> *vel_test_trace_ref, <span class="keywordtype">double</span> *vel_grad_test_trace_ref,</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordtype">double</span> *normal_ref, <span class="keywordtype">double</span> *boundaryJac_ref,</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="comment">// physics</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="keywordtype">double</span> *elementDiameter, <span class="keywordtype">int</span> nElements_global, <span class="keywordtype">double</span> useRBLES,</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordtype">double</span> useMetrics, <span class="keywordtype">double</span> alphaBDF, <span class="keywordtype">double</span> nu, <span class="keywordtype">double</span> g, <span class="keywordtype">int</span> *h_l2g,</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="keywordtype">int</span> *vel_l2g, <span class="keywordtype">double</span> *b_dof, <span class="keywordtype">double</span> *h_dof, <span class="keywordtype">double</span> *hu_dof,</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="keywordtype">double</span> *hv_dof, <span class="keywordtype">double</span> *h_dof_sge, <span class="keywordtype">double</span> *hu_dof_sge, <span class="keywordtype">double</span> *hv_dof_sge,</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="keywordtype">double</span> *q_mass_acc_beta_bdf, <span class="keywordtype">double</span> *q_mom_hu_acc_beta_bdf,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keywordtype">double</span> *q_mom_hv_acc_beta_bdf, <span class="keywordtype">double</span> *q_cfl, <span class="keywordtype">int</span> *sdInfo_hu_hu_rowptr,</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hu_hu_colind, <span class="keywordtype">int</span> *sdInfo_hu_hv_rowptr,</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hu_hv_colind, <span class="keywordtype">int</span> *sdInfo_hv_hv_rowptr,</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hv_colind, <span class="keywordtype">int</span> *sdInfo_hv_hu_rowptr,</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hu_colind,</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      <span class="comment">// h</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_h, <span class="keywordtype">int</span> *csrColumnOffsets_h_h,</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hu, <span class="keywordtype">int</span> *csrColumnOffsets_h_hu,</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hv, <span class="keywordtype">int</span> *csrColumnOffsets_h_hv,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_heta, <span class="keywordtype">int</span> *csrColumnOffsets_h_heta,</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hw, <span class="keywordtype">int</span> *csrColumnOffsets_h_hw,</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="comment">// hu</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_h, <span class="keywordtype">int</span> *csrColumnOffsets_hu_h,</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hu,</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hv,</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hu_heta,</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hw,</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="comment">// hv</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_h, <span class="keywordtype">int</span> *csrColumnOffsets_hv_h,</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hu,</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hv,</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hv_heta,</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hw,</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="comment">// heta</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_h, <span class="keywordtype">int</span> *csrColumnOffsets_heta_h,</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hu, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hu,</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hv, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hv,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_heta, <span class="keywordtype">int</span> *csrColumnOffsets_heta_heta,</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hw, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hw,</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="comment">// hw</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_h, <span class="keywordtype">int</span> *csrColumnOffsets_hw_h,</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hu,</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hv,</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hw_heta,</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hw,</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="keywordtype">double</span> *globalJacobian, <span class="keywordtype">int</span> nExteriorElementBoundaries_global,</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <span class="keywordtype">int</span> *exteriorElementBoundariesArray, <span class="keywordtype">int</span> *elementBoundaryElementsArray,</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="keywordtype">int</span> *elementBoundaryLocalElementBoundariesArray, <span class="keywordtype">int</span> *isDOFBoundary_h,</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordtype">int</span> *isDOFBoundary_hu, <span class="keywordtype">int</span> *isDOFBoundary_hv,</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_h, <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hu,</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hv, <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hu,</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hv, <span class="keywordtype">double</span> *ebqe_bc_h_ext,</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mass_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hu_adv_ext,</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hv_adv_ext, <span class="keywordtype">double</span> *ebqe_bc_hu_ext,</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_hu_diff_ext, <span class="keywordtype">double</span> *ebqe_penalty_ext,</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_hv_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_hv_diff_ext,</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_h, <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_hu,</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_hv, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_h,</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_hu, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_hv,</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_h, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_hu,</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_hv, <span class="keywordtype">double</span> dt) = 0;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;};</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">class </span>CompKernelType, <span class="keywordtype">int</span> nSpace, <span class="keywordtype">int</span> nQuadraturePoints_element,</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;          <span class="keywordtype">int</span> nDOF_mesh_trial_element, <span class="keywordtype">int</span> nDOF_trial_element,</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;          <span class="keywordtype">int</span> nDOF_test_element, <span class="keywordtype">int</span> nQuadraturePoints_elementBoundary&gt;</div>
<div class="line"><a name="l00442"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html">  442</a></span>&#160;<span class="keyword">class </span><a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html">GN_SW2DCV</a> : <span class="keyword">public</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html">GN_SW2DCV_base</a> {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a95f449fbd959cfa2f867bc3362169d24">  444</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a95f449fbd959cfa2f867bc3362169d24">nDOF_test_X_trial_element</a>;</div>
<div class="line"><a name="l00445"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">  445</a></span>&#160;  CompKernelType <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>;</div>
<div class="line"><a name="l00446"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a293b9dac10d981553663f46a4e815674">  446</a></span>&#160;  <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a293b9dac10d981553663f46a4e815674">GN_SW2DCV</a>()</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      : <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a95f449fbd959cfa2f867bc3362169d24">nDOF_test_X_trial_element</a>(nDOF_test_element * nDOF_trial_element),</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>() {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Constructing GN_SW2DCV&lt;CompKernelTemplate&lt;&quot;</span> &lt;&lt; nSpace &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;              &lt;&lt; nQuadraturePoints_element &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; nDOF_mesh_trial_element</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; nDOF_trial_element &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; nDOF_test_element &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;              &lt;&lt; nQuadraturePoints_elementBoundary &lt;&lt; <span class="stringliteral">&quot;&gt;());&quot;</span> &lt;&lt; std::endl</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;              &lt;&lt; std::flush;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a6cf917d2db4b144bf075f553cbdfa4b0">  456</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a6cf917d2db4b144bf075f553cbdfa4b0">maxWaveSpeedSharpInitialGuess</a>(<span class="keywordtype">double</span> g, <span class="keywordtype">double</span> nx, <span class="keywordtype">double</span> ny,</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                                              <span class="keywordtype">double</span> hL, <span class="keywordtype">double</span> huL, <span class="keywordtype">double</span> hvL,</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                                              <span class="keywordtype">double</span> hetaL, <span class="keywordtype">double</span> lumpedL,</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                                              <span class="keywordtype">double</span> hR, <span class="keywordtype">double</span> huR, <span class="keywordtype">double</span> hvR,</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                                              <span class="keywordtype">double</span> hetaR, <span class="keywordtype">double</span> lumpedR,</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                              <span class="keywordtype">double</span> hEpsL, <span class="keywordtype">double</span> hEpsR,</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                                              <span class="keywordtype">bool</span> debugging) {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordtype">double</span> lambda1, lambda3;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordtype">double</span> hVelL = nx * huL + ny * hvL;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordtype">double</span> hVelR = nx * huR + ny * hvR;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordtype">double</span> velL = 2.0 * hL / (hL * hL + std::pow(fmax(hL, hEpsL), 2)) * hVelL;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordtype">double</span> velR = 2.0 * hR / (hR * hR + std::pow(fmax(hR, hEpsR), 2)) * hVelR;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordtype">double</span> etaL = 2.0 * hL / (hL * hL + std::pow(fmax(hL, hEpsL), 2)) * hetaL;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordtype">double</span> etaR = 2.0 * hR / (hR * hR + std::pow(fmax(hR, hEpsR), 2)) * hetaR;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordtype">double</span> meshSizeL = sqrt(lumpedL);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordtype">double</span> meshSizeR = sqrt(lumpedR);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">/* See equation 4.12 from mGN paper:</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">      1-eigenvalue: uL-sqrt(g*hL)*sqrt(1 + augL)</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">      3-eigenvalue: uR+sqrt(g*hR)*sqrt(1 + augR)</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    lambda1 = <a class="code" href="namespaceproteus.html#adc5e96637123993f3be93306da696177">GN_nu1</a>(g, hL, velL, etaL, meshSizeL);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    lambda3 = <a class="code" href="namespaceproteus.html#ab14e2f847e0f10815ee8f083bfae1b0e">GN_nu3</a>(g, hR, velR, etaR, meshSizeR);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="comment">// if (debugging) {</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="comment">//   std::cout &lt;&lt; &quot;lambda 1 &quot; &lt;&lt; lambda1 &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="comment">//   std::cout &lt;&lt; &quot;lambda 3 &quot; &lt;&lt; lambda3 &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="comment">//   std::cout &lt;&lt; &quot;hL &quot; &lt;&lt; hL &lt;&lt; &quot; velL &quot; &lt;&lt; velL &lt;&lt; &quot; etaL &quot; &lt;&lt; etaL</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">//             &lt;&lt; &quot; hetaL &quot; &lt;&lt; hetaL &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">//   std::cout &lt;&lt; &quot;hR &quot; &lt;&lt; hR &lt;&lt; &quot; velR &quot; &lt;&lt; velR &lt;&lt; &quot; etaR &quot; &lt;&lt; etaR</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="comment">//             &lt;&lt; &quot; hetaR &quot; &lt;&lt; hetaR &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="comment">// }</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">return</span> fmax(fabs(lambda1), fabs(lambda3));</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">// Don&#39;t need this right now but keeping it just in case we need it later</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">double</span> maxWaveSpeedIterativeProcess(<span class="keywordtype">double</span> g, <span class="keywordtype">double</span> nx, <span class="keywordtype">double</span> ny,</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                             <span class="keywordtype">double</span> hL, <span class="keywordtype">double</span> huL, <span class="keywordtype">double</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                                             hvL, <span class="keywordtype">double</span> hR, <span class="keywordtype">double</span> huR,</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                                             <span class="keywordtype">double</span> hvR, <span class="keywordtype">double</span> hEpsL, <span class="keywordtype">double</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                                             hEpsR, <span class="keywordtype">bool</span> verbose) {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordtype">double</span> tol = 1E-15;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">// 1-eigenvalue: uL-sqrt(g*hL)</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">// 3-eigenvalue: uR+sqrt(g*hR)</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordtype">double</span> hVelL = nx * huL + ny * hvL;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordtype">double</span> hVelR = nx * huR + ny * hvR;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordtype">double</span> velL = 2 * hL / (hL * hL + std::pow(fmax(hL, hEpsL), 2)) * hVelL;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordtype">double</span> velR = 2 * hR / (hR * hR + std::pow(fmax(hR, hEpsR), 2)) * hVelR;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordtype">double</span> lambda1, lambda3;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="comment">// CHECK IF BOTH STATES ARE DRY:</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> (hL == 0 &amp;&amp; hR == 0) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      lambda1 = 0.;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      lambda3 = 0.;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      <span class="keywordflow">return</span> 0.;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hL == 0) <span class="comment">// left dry state</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      lambda1 = velR - 2 * sqrt(g * hR);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      lambda3 = velR + sqrt(g * hR);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordflow">return</span> fmax(fabs(lambda1), fabs(lambda3));</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hR == 0) <span class="comment">// right dry state</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      lambda1 = velL - sqrt(g * hL);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      lambda3 = velL + 2 * sqrt(g * hL);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="keywordflow">return</span> fmax(fabs(lambda1), fabs(lambda3));</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="comment">// ESTIMATE hStar //</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment"></span>      <span class="comment">// Initial estimate of hStar0 from above.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="comment">// This is computed via phiR(h) &gt;= phi(h) ---&gt; hStar0 &gt;= hStar</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="keywordtype">double</span> hStar0 = 1;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordtype">double</span> hStar = hStar0;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="comment">// ALGORITHM 1: Initialization //</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment"></span>      <span class="comment">// Requires: tol</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="comment">// Ensures: hStarL, hStarR</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordtype">double</span> hStarL, hStarR;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordtype">double</span> hMin = fmin(hL, hR);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keywordtype">double</span> hMax = fmin(hL, hR);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keywordtype">double</span> phiMin = <a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, hMin, hL, hR, velL, velR);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordtype">double</span> phiMax = <a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, hMax, hL, hR, velL, velR);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">if</span> (0 &lt;= phiMin) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="comment">// This is a 1- and 3-rarefactions situation. We know the solution in</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="comment">// this case</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        lambda1 = velL - sqrt(g * hL);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        lambda3 = velR + sqrt(g * hR);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;lambda Min, lambda Max: &quot;</span> &lt;&lt; lambda1 &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; lambda3</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                  &lt;&lt; std::endl;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">return</span> fmax(fabs(lambda1), fabs(lambda3));</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keywordflow">if</span> (phiMax == 0) <span class="comment">// if hMax &quot;hits&quot; hStar (very unlikely)</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        hStar = hMax;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        lambda1 = <a class="code" href="namespaceproteus.html#aafdd121958af52516e1f8564c737cbf3">nu1</a>(g, hStar, hL, velL);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        lambda3 = <a class="code" href="namespaceproteus.html#a75eb6ad7fbb7f589b2e8a6b836e0bae2">nu3</a>(g, hStar, hR, velR);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">return</span> fmax(fabs(lambda1), fabs(lambda3));</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keywordtype">double</span> hStarTwoRarefactions =</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;          std::pow(velL - velR + 2 * sqrt(g) * (sqrt(hL) + sqrt(hR)), 2) / 16</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;          / g;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="keywordflow">if</span> (phiMax &lt; 0) <span class="comment">// This is a 1- and 3-shock situation</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        hStarL = hMax;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        hStarR = hStarTwoRarefactions;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      } <span class="keywordflow">else</span> <span class="comment">// Here we have one shock and one rarefaction</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        hStarL = hMin;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        hStarR = fmin(hMax, hStarTwoRarefactions);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="comment">// improve estimate from below via one newton step (not required)</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      hStarL = fmax(hStarL, hStarR - <a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, hStarR, hL, hR, velL, velR) /</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                                         <a class="code" href="namespaceproteus.html#a475fb9d85bb327fe4849011189f20e62">phip</a>(g, hStarR, hL, hR));</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="comment">// COMPUTE lambdaMin0 and lambdaMax0</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordtype">double</span> nu11 = <a class="code" href="namespaceproteus.html#aafdd121958af52516e1f8564c737cbf3">nu1</a>(g, hStarR, hL, velL);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordtype">double</span> nu12 = <a class="code" href="namespaceproteus.html#aafdd121958af52516e1f8564c737cbf3">nu1</a>(g, hStarL, hL, velL);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      <span class="keywordtype">double</span> nu31 = <a class="code" href="namespaceproteus.html#a75eb6ad7fbb7f589b2e8a6b836e0bae2">nu3</a>(g, hStarL, hR, velR);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordtype">double</span> nu32 = <a class="code" href="namespaceproteus.html#a75eb6ad7fbb7f589b2e8a6b836e0bae2">nu3</a>(g, hStarR, hR, velR);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordtype">double</span> lambdaMin = fmax(fmax(nu31, 0), fmax(-nu12, 0));</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keywordtype">double</span> lambdaMax = fmax(fmax(nu32, 0), fmax(-nu11, 0));</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <span class="keywordflow">if</span> (verbose) {</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;hStarL, hStarR: &quot;</span> &lt;&lt; hStarL &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; hStarR &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;lambda Min, lambda Max: &quot;</span> &lt;&lt; lambdaMin &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                  &lt;&lt; lambdaMax &lt;&lt; std::endl;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="comment">// CHECK IF TOL IS SATISFIED. O.W. GOT TO ALGORITHM 2 //</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordflow">if</span> (lambdaMin &gt; 0 &amp;&amp; lambdaMax / lambdaMin - 1 &lt;= tol)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">return</span> lambdaMax;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="keywordflow">else</span> <span class="comment">// Proceed to algorithm 2</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="comment">// ALGORITHM 2: ESTIMATION OF LAMBDA MAX //</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment"></span>        <span class="comment">// Requires: hStarL, hStarR</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="comment">// Ensures: lambdaMax</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordtype">int</span> aux_counter = 0;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          aux_counter++;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;          <span class="comment">// Start having lambdaMin and lambdaMax</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          <span class="comment">// Check if current lambdaMin and lambdaMax satisfy the tolerance</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          <span class="keywordflow">if</span> (verbose) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            std::cout &lt;&lt; lambdaMin &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; lambdaMax &lt;&lt; std::endl;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;          <span class="keywordflow">if</span> (lambdaMin &gt; 0 &amp;&amp; lambdaMax / lambdaMin - 1 &lt;= tol)</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="keywordflow">return</span> lambdaMax;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;          <span class="comment">// Check for round off error</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, hStarL, hL, hR, velL, velR) &gt; 0 ||</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;              <a class="code" href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">phi</a>(g, hStarR, hL, hR, velL, velR) &lt; 0)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <span class="keywordflow">return</span> lambdaMax;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160; </div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;          <span class="comment">// Save old estimates of hStar</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;          <span class="keywordtype">double</span> hStarL_old = hStarL;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;          <span class="keywordtype">double</span> hStarR_old = hStarR;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;          <span class="comment">// Compute new estimates on hStarL and hStarR</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;          <span class="comment">// NOTE (MQL): hStarL and hStarR must be computed using the old</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;          values hStarL = <a class="code" href="namespaceproteus.html#a7330c388dd299f1f57a761407b3f9803">hStarLFromQuadPhiFromAbove</a>(g, hStarL_old,</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          hStarR_old, hL, hR,</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                              velL, velR);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;          hStarR = <a class="code" href="namespaceproteus.html#aa4fb5dbd416856817199520f28e815b6">hStarRFromQuadPhiFromBelow</a>(g, hStarL_old, hStarR_old, hL,</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;          hR,</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                              velL, velR);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          <span class="comment">// Compute lambdaMax and lambdaMin</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;          nu11 = <a class="code" href="namespaceproteus.html#aafdd121958af52516e1f8564c737cbf3">nu1</a>(g, hStarR, hL, velL);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;          nu12 = <a class="code" href="namespaceproteus.html#aafdd121958af52516e1f8564c737cbf3">nu1</a>(g, hStarL, hL, velL);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;          nu31 = <a class="code" href="namespaceproteus.html#a75eb6ad7fbb7f589b2e8a6b836e0bae2">nu3</a>(g, hStarL, hR, velR);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;          nu32 = <a class="code" href="namespaceproteus.html#a75eb6ad7fbb7f589b2e8a6b836e0bae2">nu3</a>(g, hStarR, hR, velR);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;          lambdaMin = fmax(fmax(nu31, 0), fmax(-nu12, 0));</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;          lambdaMax = fmax(fmax(nu32, 0), fmax(-nu11, 0));</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          <span class="keywordflow">if</span> (aux_counter &gt; 1000) <span class="comment">// TMP</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;          {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;**** AUX COUNTER &gt; 1000... aborting!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;**** Initial guess hStar: &quot;</span> &lt;&lt; hStar0 &lt;&lt; std::endl;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            hStar = hStar0;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            lambda1 = <a class="code" href="namespaceproteus.html#aafdd121958af52516e1f8564c737cbf3">nu1</a>(g, hStar, hL, velL);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            lambda3 = <a class="code" href="namespaceproteus.html#a75eb6ad7fbb7f589b2e8a6b836e0bae2">nu3</a>(g, hStar, hR, velR);</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;**** Initial estimate of max wave speed: &quot;</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                      &lt;&lt; fmax(fabs(lambda1), fabs(lambda3)) &lt;&lt; std::endl;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            abort();</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;          }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          <span class="comment">// else</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;          <span class="comment">//{</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          <span class="comment">//  std::cout &lt;&lt; &quot;*****... AUX COUNTER: &quot; &lt;&lt; aux_counter &lt;&lt;</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;          std::endl;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;          <span class="comment">//  //TMP</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          <span class="comment">//}</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="comment">/* I don&#39;t think this does anything of importance. -EJT */</span></div>
<div class="line"><a name="l00664"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#abaeb7eba7acf21a37856e253f038797b">  664</a></span>&#160;  <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#abaeb7eba7acf21a37856e253f038797b">calculateCFL</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;elementDiameter, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;g,</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;h, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hu, <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;hv,</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">double</span> hEps, <span class="keywordtype">double</span> &amp;cfl) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordtype">double</span> cflx, cfly, <a class="code" href="_headers_8h.html#aa0903c8c48f55ad539ee4e47f2d020ba">c</a> = sqrt(fmax(g * hEps, g * h));</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="_headers_8h.html#a81073496b3df485c6b59c5823819310b">u</a> = 2 * h / (h * h + std::pow(fmax(h, hEps), 2)) * hu;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="_headers_8h.html#abb6e996fea4e5f276fdcec0c7d809274">v</a> = 2 * h / (h * h + std::pow(fmax(h, hEps), 2)) * hv;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_headers_8h.html#a81073496b3df485c6b59c5823819310b">u</a> &gt; 0.0)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      cflx = (<a class="code" href="_headers_8h.html#a81073496b3df485c6b59c5823819310b">u</a> + <a class="code" href="_headers_8h.html#aa0903c8c48f55ad539ee4e47f2d020ba">c</a>) / elementDiameter;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      cflx = fabs(<a class="code" href="_headers_8h.html#a81073496b3df485c6b59c5823819310b">u</a> - <a class="code" href="_headers_8h.html#aa0903c8c48f55ad539ee4e47f2d020ba">c</a>) / elementDiameter;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_headers_8h.html#abb6e996fea4e5f276fdcec0c7d809274">v</a> &gt; 0.0)</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      cfly = (<a class="code" href="_headers_8h.html#abb6e996fea4e5f276fdcec0c7d809274">v</a> + <a class="code" href="_headers_8h.html#aa0903c8c48f55ad539ee4e47f2d020ba">c</a>) / elementDiameter;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      cfly = fabs(<a class="code" href="_headers_8h.html#abb6e996fea4e5f276fdcec0c7d809274">v</a> - <a class="code" href="_headers_8h.html#aa0903c8c48f55ad539ee4e47f2d020ba">c</a>) / elementDiameter;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    cfl = sqrt(cflx * cflx + cfly * cfly); <span class="comment">// hack, conservative estimate</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="comment">// Don&#39;t use FCTstep</span></div>
<div class="line"><a name="l00684"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a56334e68256a3ddcc4174259a0b4f456">  684</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a56334e68256a3ddcc4174259a0b4f456">FCTStep</a>(<span class="keywordtype">double</span> dt,</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;               <span class="keywordtype">int</span> NNZ,     <span class="comment">// number on non-zero entries on sparsity pattern</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;               <span class="keywordtype">int</span> numDOFs, <span class="comment">// number of DOFs</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;               <span class="keywordtype">double</span> *lumped_mass_matrix, <span class="comment">// lumped mass matrix (as vector))</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;               <span class="keywordtype">double</span> *h_old,              <span class="comment">// DOFs of solution at last stage</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;               <span class="keywordtype">double</span> *hu_old, <span class="keywordtype">double</span> *hv_old, <span class="keywordtype">double</span> *heta_old, <span class="keywordtype">double</span> *hw_old,</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;               <span class="keywordtype">double</span> *b_dof,</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;               <span class="keywordtype">double</span> *high_order_hnp1, <span class="comment">// DOFs of high order solution at tnp1</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;               <span class="keywordtype">double</span> *high_order_hunp1, <span class="keywordtype">double</span> *high_order_hvnp1,</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;               <span class="keywordtype">double</span> *high_order_hetanp1, <span class="keywordtype">double</span> *high_order_hwnp1,</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;               <span class="keywordtype">double</span> *extendedSourceTerm_hu, <span class="keywordtype">double</span> *extendedSourceTerm_hv,</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;               <span class="keywordtype">double</span> *extendedSourceTerm_heta, <span class="keywordtype">double</span> *extendedSourceTerm_hw,</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;               <span class="keywordtype">double</span> *limited_hnp1, <span class="keywordtype">double</span> *limited_hunp1,</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;               <span class="keywordtype">double</span> *limited_hvnp1, <span class="keywordtype">double</span> *limited_hetanp1,</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;               <span class="keywordtype">double</span> *limited_hwnp1,</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;               <span class="keywordtype">int</span> *csrRowIndeces_DofLoops,    <span class="comment">// csr row indeces</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;               <span class="keywordtype">int</span> *csrColumnOffsets_DofLoops, <span class="comment">// csr column offsets</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;               <span class="keywordtype">double</span> *MassMatrix,             <span class="comment">// mass matrix</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;               <span class="keywordtype">double</span> *dH_minus_dL, <span class="keywordtype">double</span> *muH_minus_muL, <span class="keywordtype">double</span> hEps,</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;               <span class="keywordtype">double</span> *hReg, <span class="keywordtype">int</span> LUMPED_MASS_MATRIX, <span class="keywordtype">double</span> *dLow, <span class="keywordtype">double</span> *hBT,</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;               <span class="keywordtype">double</span> *huBT, <span class="keywordtype">double</span> *hvBT, <span class="keywordtype">double</span> *hetaBT, <span class="keywordtype">double</span> *hwBT) {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ab50314b4fa3cd11d2ff906d644950a03">hwLow</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">/* For reference, see section 6.3 of friction shallow water paper</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">    by Guermond, Quezada De Luna, Popov, Kees, Farthing */</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// FIRST LOOP in DOFs //</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> ij = 0;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFs; i++) {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="comment">// read some vectors</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="keywordtype">double</span> high_order_hnp1i = high_order_hnp1[i];</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="keywordtype">double</span> hi = h_old[i];</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="keywordtype">double</span> hui = hu_old[i];</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordtype">double</span> hvi = hv_old[i];</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      <span class="keywordtype">double</span> high_order_hetanp1i = high_order_hetanp1[i];</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordtype">double</span> hetai = heta_old[i];</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="keywordtype">double</span> hwi = hw_old[i];</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordtype">double</span> Zi = b_dof[i];</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="keywordtype">double</span> mi = lumped_mass_matrix[i];</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="keywordtype">double</span> hiMin = hi;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordtype">double</span> hiMax = hi;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordtype">double</span> Pnegi = 0., Pposi = 0.;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160; </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="comment">/* Actually it&#39;s probably better to put this all</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">      in a function with inputs to be able to limit any of the conserved</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">      variables - EJT */</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="comment">// For limiting heta</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <span class="keywordtype">double</span> hetai_Min = hetai;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="keywordtype">double</span> hetai_Max = hetai;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <span class="keywordtype">double</span> Pnegi_heta = 0., Pposi_heta = 0.;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="comment">// LOW ORDER SOLUTION without extended source term. Eqn 6.23</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] = hi;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[i] = hui;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[i] = hvi;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>[i] = hetai;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ab50314b4fa3cd11d2ff906d644950a03">hwLow</a>[i] = hwi;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="comment">// LOOP OVER THE SPARSITY PATTERN (j-LOOP)//</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> offset = csrRowIndeces_DofLoops[i];</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;           offset &lt; csrRowIndeces_DofLoops[i + 1]; offset++) {</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keywordtype">int</span> j = csrColumnOffsets_DofLoops[offset];</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="comment">// read some vectors</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="keywordtype">double</span> hj = h_old[j];</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordtype">double</span> hetaj = heta_old[j];</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keywordtype">double</span> Zj = b_dof[j];</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="comment">// COMPUTE STAR SOLUTION // hStar, huStar and hvStar</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordtype">double</span> hStarij = fmax(0., hi + Zi - fmax(Zi, Zj));</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="keywordtype">double</span> hStarji = fmax(0., hj + Zj - fmax(Zi, Zj));</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="comment">// i-th row of flux correction matrix</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordtype">double</span> ML_minus_MC = (LUMPED_MASS_MATRIX == 1</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                  ? 0.</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                  : (i == j ? 1. : 0.) * mi - MassMatrix[ij]);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix1 =</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            ML_minus_MC * (high_order_hnp1[j] - hj - (high_order_hnp1i - hi)) +</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (hStarji - hStarij) +</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            dt * muH_minus_muL[ij] * (hj - hi);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix_heta =</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            ML_minus_MC *</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                (high_order_hetanp1[j] - hetaj - (high_order_hetanp1i - hi)) +</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (hStarji - hStarij) +</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            dt * muH_minus_muL[ij] * (hetaj - hetai);</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160; </div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="comment">// COMPUTE P VECTORS //</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        Pnegi +=</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            FluxCorrectionMatrix1 * ((FluxCorrectionMatrix1 &lt; 0) ? 1. : 0.);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        Pposi +=</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            FluxCorrectionMatrix1 * ((FluxCorrectionMatrix1 &gt; 0) ? 1. : 0.);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        Pnegi_heta += FluxCorrectionMatrix_heta *</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                      ((FluxCorrectionMatrix_heta &lt; 0) ? 1. : 0.);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        Pposi_heta += FluxCorrectionMatrix_heta *</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                      ((FluxCorrectionMatrix_heta &gt; 0) ? 1. : 0.);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160; </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="comment">// COMPUTE LOCAL BOUNDS //</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        hiMin = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(hiMin, hBT[ij]);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        hiMax = <a class="code" href="group__analytical_solutions.html#gaffe776513b24d84b39af8ab0930fef7f">std::max</a>(hiMax, hBT[ij]);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        hetai_Min = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(hetai_Min, hetaBT[ij]);</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        hetai_Max = <a class="code" href="group__analytical_solutions.html#gaffe776513b24d84b39af8ab0930fef7f">std::max</a>(hetai_Max, hetaBT[ij]);</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="comment">// COMPUTE LOW ORDER SOLUTION (WITHOUT EXTENDED SOURCE) //</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="comment">// SEE EQUATION 6.23 FROM SW FRICTION PAPER -EJT //</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">if</span> (i != j) {</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] += hi * (-dt / mi * 2 * dLow[ij]) +</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                     dt / mi * (2 * dLow[ij] * hBT[ij]);</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[i] += hui * (-dt / mi * 2 * dLow[ij]) +</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                      dt / mi * (2 * dLow[ij] * huBT[ij]);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[i] += hvi * (-dt / mi * 2 * dLow[ij]) +</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                      dt / mi * (2 * dLow[ij] * hvBT[ij]);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>[i] += hetai * (-dt / mi * 2 * dLow[ij]) +</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                        dt / mi * (2 * dLow[ij] * hetaBT[ij]);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ab50314b4fa3cd11d2ff906d644950a03">hwLow</a>[i] += hwi * (-dt / mi * 2 * dLow[ij]) +</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                      dt / mi * (2 * dLow[ij] * hwBT[ij]);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="comment">// update ij</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        ij += 1;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <span class="comment">// clean up hLow from round off error</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] &lt; hEps)</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] = 0;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <span class="comment">// COMPUTE Q VECTORS //</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment"></span>      <span class="keywordflow">if</span> (<a class="code" href="_g_n___s_w2_d_c_v_8h.html#aa30b36303b632a14d8f23dd32b047922">GLOBAL_FCT</a> == 1)</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        hiMin = 0;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keywordtype">double</span> Qnegi = mi * (hiMin - <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i]);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      <span class="keywordtype">double</span> Qposi = mi * (hiMax - <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i]);</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="keywordtype">double</span> Qnegi_heta =</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;          mi * (hetai_Min - (<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>[i] - extendedSourceTerm_heta[i]));</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="keywordtype">double</span> Qposi_heta =</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;          mi * (hetai_Max - (<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>[i] - extendedSourceTerm_heta[i]));</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160; </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <span class="comment">// COMPUTE R VECTORS //</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment"></span>      <span class="keywordflow">if</span> (high_order_hnp1[i] &lt;= hReg[i]) <span class="comment">// hEps</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>[i] = 0.;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>[i] = 0.;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="comment">// for heta - EJT</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>[i] = 0.;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>[i] = 0.;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>[i] = ((Pnegi == 0) ? 1. : <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(1.0, Qnegi / Pnegi));</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>[i] = ((Pposi == 0) ? 1. : <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(1.0, Qposi / Pposi));</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="comment">// for heta</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>[i] =</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            ((Pnegi_heta == 0) ? 1. : <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(1.0, Qnegi_heta / Pnegi_heta));</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>[i] =</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            ((Pposi_heta == 0) ? 1. : <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(1.0, Qposi_heta / Pposi_heta));</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      }</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    } <span class="comment">// i DOFs</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">// COMPUTE LIMITERS //</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment"></span>    ij = 0;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFs; i++) {</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="comment">/* read some vectors */</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="comment">// high order</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      <span class="keywordtype">double</span> high_order_hnp1i = high_order_hnp1[i];</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <span class="keywordtype">double</span> high_order_hunp1i = high_order_hunp1[i];</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="keywordtype">double</span> high_order_hvnp1i = high_order_hvnp1[i];</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="keywordtype">double</span> high_order_hetanp1i = high_order_hetanp1[i];</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <span class="keywordtype">double</span> high_order_hwnp1i = high_order_hwnp1[i];</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="comment">// old</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordtype">double</span> hi = h_old[i];</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <span class="keywordtype">double</span> huni = hu_old[i];</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="keywordtype">double</span> hvni = hv_old[i];</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;      <span class="keywordtype">double</span> hetani = heta_old[i];</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      <span class="keywordtype">double</span> hwni = hw_old[i];</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      <span class="keywordtype">double</span> Zi = b_dof[i];</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <span class="keywordtype">double</span> mi = lumped_mass_matrix[i];</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="keywordtype">double</span> one_over_hiReg =</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          2 * hi / (hi * hi + std::pow(fmax(hi, hEps), 2)); <span class="comment">// hEps</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="keywordtype">double</span> ith_Limiter_times_FluxCorrectionMatrix1 = 0.;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      <span class="keywordtype">double</span> ith_Limiter_times_FluxCorrectionMatrix2 = 0.;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      <span class="keywordtype">double</span> ith_Limiter_times_FluxCorrectionMatrix3 = 0.;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <span class="keywordtype">double</span> ith_Limiter_times_FluxCorrectionMatrix4 = 0.;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      <span class="keywordtype">double</span> ith_Limiter_times_FluxCorrectionMatrix5 = 0.;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      <span class="comment">// LOOP OVER THE SPARSITY PATTERN (j-LOOP)//</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> offset = csrRowIndeces_DofLoops[i];</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;           offset &lt; csrRowIndeces_DofLoops[i + 1]; offset++) {</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="keywordtype">int</span> j = csrColumnOffsets_DofLoops[offset];</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="comment">// read some vectors</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordtype">double</span> hj = h_old[j];</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keywordtype">double</span> hunj = hu_old[j];</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="keywordtype">double</span> hvnj = hv_old[j];</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordtype">double</span> hetanj = heta_old[j];</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordtype">double</span> hwnj = hw_old[j];</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordtype">double</span> Zj = b_dof[j];</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="keywordtype">double</span> one_over_hjReg =</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            2 * hj / (hj * hj + std::pow(fmax(hj, hEps), 2)); <span class="comment">// hEps</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="comment">/*  COMPUTE STAR SOLUTIONS:</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">                hStar, huStar,  hvStar, hetaStar, and hwStar</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <span class="keywordtype">double</span> hStarij = fmax(0., hi + Zi - fmax(Zi, Zj));</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        <span class="keywordtype">double</span> huStarij = huni * hStarij * one_over_hiReg;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <span class="keywordtype">double</span> hvStarij = hvni * hStarij * one_over_hiReg;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordtype">double</span> hetaStarij = hetani * std::pow(hStarij * one_over_hiReg, 2);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="keywordtype">double</span> hwStarij = hwni * hStarij * one_over_hiReg;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordtype">double</span> hStarji = fmax(0., hj + Zj - fmax(Zi, Zj));</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordtype">double</span> huStarji = hunj * hStarji * one_over_hjReg;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordtype">double</span> hvStarji = hvnj * hStarji * one_over_hjReg;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="keywordtype">double</span> hetaStarji = hetanj * std::pow(hStarji * one_over_hjReg, 2);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordtype">double</span> hwStarji = hwnj * hStarji * one_over_hjReg;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="comment">// COMPUTE FLUX CORRECTION MATRICES</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordtype">double</span> ML_minus_MC = (LUMPED_MASS_MATRIX == 1</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                                  ? 0.</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                                  : (i == j ? 1. : 0.) * mi - MassMatrix[ij]);</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix1 =</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            ML_minus_MC * (high_order_hnp1[j] - hj - (high_order_hnp1i - hi)) +</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (hStarji - hStarij) +</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            dt * muH_minus_muL[ij] * (hj - hi);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix2 =</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            ML_minus_MC *</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                (high_order_hunp1[j] - hunj - (high_order_hunp1i - huni)) +</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (huStarji - huStarij) +</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            dt * muH_minus_muL[ij] * (hunj - huni);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix3 =</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            ML_minus_MC *</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                (high_order_hvnp1[j] - hvnj - (high_order_hvnp1i - hvni)) +</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (hvStarji - hvStarij) +</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            dt * muH_minus_muL[ij] * (hvnj - hvni);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix4 =</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            ML_minus_MC * (high_order_hetanp1[j] - hetanj -</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                           (high_order_hetanp1i - hetani)) +</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) *</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                (hetaStarji - hetaStarij) +</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            dt * muH_minus_muL[ij] * (hetanj - hetani);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160; </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix5 =</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            ML_minus_MC *</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                (high_order_hwnp1[j] - hwnj - (high_order_hwnp1i - hwni)) +</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (hwStarji - hwStarij) +</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            dt * muH_minus_muL[ij] * (hwnj - hwni);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <span class="comment">// COMPUTE LIMITER based on water height</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="keywordtype">double</span> Lij = 0.;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="keywordflow">if</span> (FluxCorrectionMatrix1 &gt;= 0)</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;          Lij = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>[i], <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>[j]);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;          Lij = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>[i], <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>[j]);</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="comment">// COMPUTE LIMITER based on heta -EJT</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="comment">// Note that we set lij = min(lij_h,lij_heta)</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordflow">if</span> (FluxCorrectionMatrix4 &gt;= 0)</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;          Lij = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(Lij, <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>[i], <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>[j]));</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;          Lij = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(Lij, <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>[i], <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>[j]));</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="comment">// take off all instances of GLOBAL_FCT -EJT</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_g_n___s_w2_d_c_v_8h.html#aa30b36303b632a14d8f23dd32b047922">GLOBAL_FCT</a> == 1)</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;          Lij = (FluxCorrectionMatrix1 &gt;= 0. ? <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(1., <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>[j])</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                                             : <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>[i], 1.));</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160; </div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="comment">// COMPUTE LIMITED FLUX //</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        ith_Limiter_times_FluxCorrectionMatrix1 += Lij * FluxCorrectionMatrix1;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        ith_Limiter_times_FluxCorrectionMatrix2 += Lij * FluxCorrectionMatrix2;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        ith_Limiter_times_FluxCorrectionMatrix3 += Lij * FluxCorrectionMatrix3;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        ith_Limiter_times_FluxCorrectionMatrix4 += Lij * FluxCorrectionMatrix4;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        ith_Limiter_times_FluxCorrectionMatrix5 += Lij * FluxCorrectionMatrix5;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="comment">// update ij</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        ij += 1;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      }</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160; </div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keywordtype">double</span> one_over_mi = 1.0 / lumped_mass_matrix[i];</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      limited_hnp1[i] =</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] + one_over_mi * ith_Limiter_times_FluxCorrectionMatrix1;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      limited_hunp1[i] =</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;          ((<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[i] -</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            dt / mi * extendedSourceTerm_hu[i]) <span class="comment">// low_order_hunp1+...</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;           + one_over_mi * ith_Limiter_times_FluxCorrectionMatrix2);</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      limited_hvnp1[i] =</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;          ((<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[i] -</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            dt / mi * extendedSourceTerm_hv[i]) <span class="comment">// low_order_hvnp1+...</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;           + one_over_mi * ith_Limiter_times_FluxCorrectionMatrix3);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      limited_hetanp1[i] =</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;          ((<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>[i] -</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            dt / mi * extendedSourceTerm_heta[i]) <span class="comment">// low_order_hetanp1+...</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;           + one_over_mi * ith_Limiter_times_FluxCorrectionMatrix4);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      limited_hwnp1[i] =</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;          ((<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ab50314b4fa3cd11d2ff906d644950a03">hwLow</a>[i] -</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            dt / mi * extendedSourceTerm_hw[i]) <span class="comment">// low_order_hwnp1+...</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;           + one_over_mi * ith_Limiter_times_FluxCorrectionMatrix5);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordflow">if</span> (limited_hnp1[i] &lt; -hEps &amp;&amp; dt &lt; 1.0) {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Limited water height is negative: &quot;</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;hLow: &quot;</span> &lt;&lt; <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;hHigh: &quot;</span> &lt;&lt; limited_hnp1[i] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; ... aborting!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        abort();</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="comment">// clean up uHigh from round off error</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="comment">// if (limited_hnp1[i] &lt; hEps)</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="comment">//   limited_hnp1[i] = 0;</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="comment">// double aux = fmax(limited_hnp1[i],hEps); // hEps</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="keywordtype">double</span> aux =</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            fmax(limited_hnp1[i], hReg[i]); <span class="comment">// hReg makes the code more robust</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        limited_hunp1[i] *= 2 * std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) /</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                            (std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) +</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                             std::pow(aux, <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>));</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        limited_hvnp1[i] *= 2 * std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) /</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                            (std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) +</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                             std::pow(aux, <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>));</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        limited_hetanp1[i] *= 2 * std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) /</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                              (std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) +</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                               std::pow(aux, <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>));</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        limited_hwnp1[i] *= 2 * std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) /</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                            (std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) +</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                             std::pow(aux, <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>));</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      }</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  }</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160; </div>
<div class="line"><a name="l01025"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#aed27e87c230d38bbc89fae1fdb531795"> 1025</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#aed27e87c230d38bbc89fae1fdb531795">convexLimiting</a>(</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="keywordtype">double</span> dt,</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="keywordtype">int</span> NNZ,     <span class="comment">// number on non-zero entries on sparsity pattern</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <span class="keywordtype">int</span> numDOFs, <span class="comment">// number of DOFs</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="keywordtype">double</span> *lumped_mass_matrix, <span class="comment">// lumped mass matrix (as vector))</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="keywordtype">double</span> *h_old,              <span class="comment">// DOFs of solution at last stage</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="keywordtype">double</span> *hu_old, <span class="keywordtype">double</span> *hv_old, <span class="keywordtype">double</span> *heta_old, <span class="keywordtype">double</span> *hw_old,</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keywordtype">double</span> *b_dof,</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="keywordtype">double</span> *high_order_hnp1, <span class="comment">// DOFs of high order solution at tnp1</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <span class="keywordtype">double</span> *high_order_hunp1, <span class="keywordtype">double</span> *high_order_hvnp1,</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="keywordtype">double</span> *high_order_hetanp1, <span class="keywordtype">double</span> *high_order_hwnp1,</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <span class="keywordtype">double</span> *extendedSourceTerm_hu, <span class="keywordtype">double</span> *extendedSourceTerm_hv,</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      <span class="keywordtype">double</span> *extendedSourceTerm_heta, <span class="keywordtype">double</span> *extendedSourceTerm_hw,</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <span class="keywordtype">double</span> *limited_hnp1, <span class="keywordtype">double</span> *limited_hunp1, <span class="keywordtype">double</span> *limited_hvnp1,</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="keywordtype">double</span> *limited_hetanp1, <span class="keywordtype">double</span> *limited_hwnp1,</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_DofLoops,    <span class="comment">// csr row indeces</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_DofLoops, <span class="comment">// csr column offsets</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="keywordtype">double</span> *MassMatrix,             <span class="comment">// mass matrix</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      <span class="keywordtype">double</span> *dH_minus_dL, <span class="keywordtype">double</span> *muH_minus_muL, <span class="keywordtype">double</span> hEps, <span class="keywordtype">double</span> *hReg,</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      <span class="keywordtype">int</span> LUMPED_MASS_MATRIX, <span class="keywordtype">double</span> *dLow, <span class="keywordtype">double</span> *hBT, <span class="keywordtype">double</span> *huBT,</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <span class="keywordtype">double</span> *hvBT, <span class="keywordtype">double</span> *hetaBT, <span class="keywordtype">double</span> *hwBT, <span class="keywordtype">double</span> *new_SourceTerm_hu,</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordtype">double</span> *new_SourceTerm_hv, <span class="keywordtype">double</span> *new_SourceTerm_heta,</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <span class="keywordtype">double</span> *new_SourceTerm_hw) {</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ab50314b4fa3cd11d2ff906d644950a03">hwLow</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <span class="comment">// For relaxation of bounds //</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    std::valarray&lt;double&gt; urelax;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    urelax.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    std::valarray&lt;double&gt; drelax;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    drelax.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160; </div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="comment">// for h</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    std::valarray&lt;double&gt; delta_Sqd_h;</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    delta_Sqd_h.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    std::valarray&lt;double&gt; bar_deltaSqd_h;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    bar_deltaSqd_h.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">// for heta</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    std::valarray&lt;double&gt; delta_Sqd_heta;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    delta_Sqd_heta.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    std::valarray&lt;double&gt; bar_deltaSqd_heta;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    bar_deltaSqd_heta.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="comment">// for kinetic energy</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    std::valarray&lt;double&gt; kin;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    kin.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    std::valarray&lt;double&gt; delta_Sqd_kin;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    delta_Sqd_kin.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    std::valarray&lt;double&gt; bar_deltaSqd_kin;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    bar_deltaSqd_kin.resize(numDOFs, 0.0);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160; </div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordtype">double</span> size_of_domain = 0.0;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">// loop to define size of domain and kinetic energy</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFs; i++) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      size_of_domain += lumped_mass_matrix[i];</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      kin[i] = 0.5 * (hu_old[i] * hu_old[i] + hv_old[i] * hv_old[i]);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      kin[i] *= 2.0 * h_old[i] /</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                (h_old[i] * h_old[i] + std::pow(fmax(h_old[i], hEps), 2));</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    }</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160; </div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">// First loop</span></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFs; i++) {</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      urelax[i] =</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;          1.0 +</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;          2.0 * std::pow(sqrt(sqrt(lumped_mass_matrix[i] / size_of_domain)), 3);</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      drelax[i] =</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;          1.0 -</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;          2.0 * std::pow(sqrt(sqrt(lumped_mass_matrix[i] / size_of_domain)), 3);</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> offset = csrRowIndeces_DofLoops[i];</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;           offset &lt; csrRowIndeces_DofLoops[i + 1]; offset++) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="keywordtype">int</span> j = csrColumnOffsets_DofLoops[offset];</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="keywordflow">if</span> (i != j) {</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;          delta_Sqd_h[i] += h_old[i] - h_old[j];</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;          delta_Sqd_heta[i] += heta_old[i] - heta_old[j];</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;          delta_Sqd_kin[i] += kin[i] - kin[j];</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        }</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      } <span class="comment">// j loop ends here</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    }   <span class="comment">// i loops ends here</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="comment">// Second loop</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFs; i++) {</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> offset = csrRowIndeces_DofLoops[i];</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;           offset &lt; csrRowIndeces_DofLoops[i + 1]; offset++) {</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <span class="keywordtype">int</span> j = csrColumnOffsets_DofLoops[offset];</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="keywordflow">if</span> (i != j) {</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;          bar_deltaSqd_h[i] += delta_Sqd_h[j] + delta_Sqd_h[i];</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;          bar_deltaSqd_heta[i] += delta_Sqd_heta[j] + delta_Sqd_heta[i];</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;          bar_deltaSqd_kin[i] += delta_Sqd_kin[j] + delta_Sqd_kin[i];</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        }</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      } <span class="comment">// j loop ends here</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    }   <span class="comment">// i loops ends here</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160; </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFs; i++) {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      bar_deltaSqd_h[i] =</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;          bar_deltaSqd_h[i] /</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;          (csrRowIndeces_DofLoops[i + 1] - csrRowIndeces_DofLoops[i]) / 2.0;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      bar_deltaSqd_heta[i] =</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;          bar_deltaSqd_heta[i] /</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;          (csrRowIndeces_DofLoops[i + 1] - csrRowIndeces_DofLoops[i]) / 2.0;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;      bar_deltaSqd_kin[i] =</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;          bar_deltaSqd_kin[i] /</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;          (csrRowIndeces_DofLoops[i + 1] - csrRowIndeces_DofLoops[i]) / 2.0;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    }</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160; </div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="comment">// FIRST Main LOOP in DOFs //</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment"></span>    <span class="keywordtype">int</span> ij = 0;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFs; i++) {</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="comment">// read some vectors</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="keywordtype">double</span> high_order_hnp1i = high_order_hnp1[i];</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="keywordtype">double</span> hi = h_old[i];</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="keywordtype">double</span> hui = hu_old[i];</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      <span class="keywordtype">double</span> hvi = hv_old[i];</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="keywordtype">double</span> high_order_hetanp1i = high_order_hetanp1[i];</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <span class="keywordtype">double</span> hetai = heta_old[i];</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="keywordtype">double</span> hwi = hw_old[i];</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <span class="keywordtype">double</span> Zi = b_dof[i];</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      <span class="keywordtype">double</span> mi = lumped_mass_matrix[i];</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <span class="keywordtype">double</span> one_over_hiReg =</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;          2 * hi / (hi * hi + std::pow(fmax(hi, hEps), 2)); <span class="comment">// hEps</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160; </div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <span class="comment">// For limiting h, initializing hMin and hMax</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <span class="keywordtype">double</span> hiMin = hi;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="keywordtype">double</span> hiMax = hi;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="keywordtype">double</span> Pnegi = 0., Pposi = 0.;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160; </div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <span class="comment">// For limiting heta, initializing heta_Min, heta_max</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      <span class="keywordtype">double</span> hetai_Min = hetai;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      <span class="keywordtype">double</span> hetai_Max = hetai;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      <span class="keywordtype">double</span> Pnegi_heta = 0., Pposi_heta = 0.;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160; </div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      <span class="comment">/* LOW ORDER SOLUTION */</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] = hi;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[i] = hui;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[i] = hvi;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>[i] = hetai;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ab50314b4fa3cd11d2ff906d644950a03">hwLow</a>[i] = hwi;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>[i] = 0;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      <span class="comment">// LOOP OVER THE SPARSITY PATTERN (j-LOOP)//</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> offset = csrRowIndeces_DofLoops[i];</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;           offset &lt; csrRowIndeces_DofLoops[i + 1]; offset++) {</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        <span class="keywordtype">int</span> j = csrColumnOffsets_DofLoops[offset];</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordtype">double</span> psi_ij = 0;</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <span class="keywordtype">double</span> one_over_hBT =</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            2.0 * hBT[ij] /</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            (hBT[ij] * hBT[ij] + std::pow(fmax(hBT[ij], hEps), 2));</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        psi_ij = one_over_hBT * (huBT[ij] * huBT[ij] + hvBT[ij] * hvBT[ij]) /</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                 2.0; <span class="comment">// Eqn (6.31)</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>[i] = fmax(psi_ij, <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>[i]);</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160; </div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <span class="comment">// read some vectors</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <span class="keywordtype">double</span> hj = h_old[j];</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <span class="keywordtype">double</span> one_over_hjReg =</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            2 * hj / (hj * hj + std::pow(fmax(hj, hEps), 2)); <span class="comment">// hEps</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        <span class="keywordtype">double</span> hetaj = heta_old[j];</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        <span class="keywordtype">double</span> Zj = b_dof[j];</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160; </div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="comment">// COMPUTE STAR SOLUTION // hStar, huStar and hvStar</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordtype">double</span> hStarij = fmax(0., hi + Zi - fmax(Zi, Zj));</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        <span class="keywordtype">double</span> hStarji = fmax(0., hj + Zj - fmax(Zi, Zj));</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="keywordtype">double</span> hetaStarji = hetaj * std::pow(hStarji * one_over_hjReg, 2);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        <span class="keywordtype">double</span> hetaStarij = hetai * std::pow(hStarij * one_over_hiReg, 2);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        <span class="comment">// i-th row of flux correction matrix</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <span class="keywordtype">double</span> ML_minus_MC = (LUMPED_MASS_MATRIX == 1</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                                  ? 0.</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                                  : (i == j ? 1. : 0.) * mi - MassMatrix[ij]);</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix1 =</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;            ML_minus_MC * (high_order_hnp1[j] - hj - (high_order_hnp1i - hi)) +</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (hStarji - hStarij) +</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            dt * muH_minus_muL[ij] * (hj - hi);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160; </div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix_heta =</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;            ML_minus_MC * (high_order_hetanp1[j] - hetaj -</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                           (high_order_hetanp1i - hetai)) +</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) *</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                (hetaStarji - hetaStarij) +</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            dt * muH_minus_muL[ij] * (hetaj - hetai);</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        <span class="comment">// COMPUTE P VECTORS //</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;        Pnegi +=</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            FluxCorrectionMatrix1 * ((FluxCorrectionMatrix1 &lt; 0) ? 1. : 0.);</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        Pposi +=</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            FluxCorrectionMatrix1 * ((FluxCorrectionMatrix1 &gt; 0) ? 1. : 0.);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160; </div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;        Pnegi_heta += FluxCorrectionMatrix_heta *</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                      ((FluxCorrectionMatrix_heta &lt; 0) ? 1. : 0.);</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        Pposi_heta += FluxCorrectionMatrix_heta *</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                      ((FluxCorrectionMatrix_heta &gt; 0) ? 1. : 0.);</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <span class="comment">// COMPUTE LOCAL BOUNDS //</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        hiMin = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(hiMin, hBT[ij]);</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        hiMax = <a class="code" href="group__analytical_solutions.html#gaffe776513b24d84b39af8ab0930fef7f">std::max</a>(hiMax, hBT[ij]);</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160; </div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        hetai_Min = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(hetai_Min, hetaBT[ij]);</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        hetai_Max = <a class="code" href="group__analytical_solutions.html#gaffe776513b24d84b39af8ab0930fef7f">std::max</a>(hetai_Max, hetaBT[ij]);</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="comment">// Then do relaxation of bounds here. If confused, see (4.12) of Euler</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        <span class="comment">// convex limiting paper. Turn this off for now</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        hiMin = <a class="code" href="group__analytical_solutions.html#gaffe776513b24d84b39af8ab0930fef7f">std::max</a>(drelax[i] * hiMin,</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                         hiMin - std::abs(bar_deltaSqd_h[i]) / 2.0);</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        hetai_Min = <a class="code" href="group__analytical_solutions.html#gaffe776513b24d84b39af8ab0930fef7f">std::max</a>(drelax[i] * hetai_Min,</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                             hetai_Min - std::abs(bar_deltaSqd_heta[i]) / 2.0);</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160; </div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        hiMax = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(urelax[i] * hiMax,</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                         hiMax + std::abs(bar_deltaSqd_h[i]) / 2.0);</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        hetai_Max = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(urelax[i] * hetai_Max,</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                             hetai_Max + std::abs(bar_deltaSqd_heta[i]) / 2.0);</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>[i] = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(urelax[i] * <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>[i],</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                           <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>[i] + std::abs(bar_deltaSqd_kin[i]) / 2.0);</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160; </div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        <span class="comment">/* COMPUTE LOW ORDER SOLUTION. See EQN 6.23 in</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">         * SW friction paper */</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        <span class="keywordflow">if</span> (i != j) {</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] += hi * (-dt / mi * 2 * dLow[ij]) +</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                     dt / mi * (2 * dLow[ij] * hBT[ij]);</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[i] += hui * (-dt / mi * 2 * dLow[ij]) +</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                      dt / mi * (2 * dLow[ij] * huBT[ij]);</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[i] += hvi * (-dt / mi * 2 * dLow[ij]) +</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                      dt / mi * (2 * dLow[ij] * hvBT[ij]);</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>[i] += hetai * (-dt / mi * 2 * dLow[ij]) +</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                        dt / mi * (2 * dLow[ij] * hetaBT[ij]);</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ab50314b4fa3cd11d2ff906d644950a03">hwLow</a>[i] += hwi * (-dt / mi * 2 * dLow[ij]) +</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                      dt / mi * (2 * dLow[ij] * hwBT[ij]);</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        }</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        <span class="comment">// UPDATE ij //</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        ij += 1;</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      } <span class="comment">// j loop ends here</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160; </div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <span class="comment">// clean up hLow from round off error</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] &lt; hEps)</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] = 0.0;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="comment">// COMPUTE Q VECTORS //</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment"></span>      <span class="keywordtype">double</span> Qnegi = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(mi * (hiMin - <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i]), 0.0);</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="keywordtype">double</span> Qposi = <a class="code" href="group__analytical_solutions.html#gaffe776513b24d84b39af8ab0930fef7f">std::max</a>(mi * (hiMax - <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i]), 0.0);</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      <span class="keywordtype">double</span> Qnegi_heta = <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(mi * (hetai_Min - <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>[i]), 0.0);</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      <span class="keywordtype">double</span> Qposi_heta = <a class="code" href="group__analytical_solutions.html#gaffe776513b24d84b39af8ab0930fef7f">std::max</a>(mi * (hetai_Max - <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>[i]), 0.0);</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160; </div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="comment">// COMPUTE R VECTORS //</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment"></span>      <span class="keywordflow">if</span> (high_order_hnp1[i] &lt;= hEps) <span class="comment">// hEps</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      {</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>[i] = 0.;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>[i] = 0.;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>[i] = 0.;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>[i] = 0.;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>[i] = ((Pnegi == 0) ? 1. : <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(1.0, Qnegi / Pnegi));</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>[i] = ((Pposi == 0) ? 1. : <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(1.0, Qposi / Pposi));</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>[i] =</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;            ((Pnegi_heta == 0) ? 1. : <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(1.0, Qnegi_heta / Pnegi_heta));</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>[i] =</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;            ((Pposi_heta == 0) ? 1. : <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(1.0, Qposi_heta / Pposi_heta));</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      }</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    } <span class="comment">// i DOFs</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; </div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="comment">// COMPUTE LIMITERS //</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment"></span>    ij = 0;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFs; i++) {</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      <span class="comment">// read some vectors</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      <span class="keywordtype">double</span> high_order_hnp1i = high_order_hnp1[i];</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      <span class="keywordtype">double</span> high_order_hunp1i = high_order_hunp1[i];</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      <span class="keywordtype">double</span> high_order_hvnp1i = high_order_hvnp1[i];</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      <span class="keywordtype">double</span> high_order_hetanp1i = high_order_hetanp1[i];</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <span class="keywordtype">double</span> high_order_hwnp1i = high_order_hwnp1[i];</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <span class="keywordtype">double</span> hi = h_old[i];</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      <span class="keywordtype">double</span> huni = hu_old[i];</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <span class="keywordtype">double</span> hvni = hv_old[i];</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      <span class="keywordtype">double</span> hetani = heta_old[i];</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      <span class="keywordtype">double</span> hwni = hw_old[i];</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      <span class="keywordtype">double</span> Zi = b_dof[i];</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <span class="keywordtype">double</span> mi = lumped_mass_matrix[i];</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      <span class="keywordtype">double</span> one_over_hiReg =</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;          2 * hi / (hi * hi + std::pow(fmax(hi, hEps), 2)); <span class="comment">// hEps</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160; </div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <span class="keywordtype">double</span> ith_Limiter_times_FluxCorrectionMatrix1 = 0.;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      <span class="keywordtype">double</span> ith_Limiter_times_FluxCorrectionMatrix2 = 0.;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      <span class="keywordtype">double</span> ith_Limiter_times_FluxCorrectionMatrix3 = 0.;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      <span class="keywordtype">double</span> ith_Limiter_times_FluxCorrectionMatrix4 = 0.;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;      <span class="keywordtype">double</span> ith_Limiter_times_FluxCorrectionMatrix5 = 0.;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160; </div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="keywordtype">double</span> ci =</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>[i] * <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] -</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;          0.5 * (<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[i] * <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[i] + <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[i] * <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[i]); <span class="comment">// for KE lim.</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      <span class="comment">// LOOP OVER THE SPARSITY PATTERN (j-LOOP)//</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> offset = csrRowIndeces_DofLoops[i];</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;           offset &lt; csrRowIndeces_DofLoops[i + 1]; offset++) {</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="keywordtype">int</span> j = csrColumnOffsets_DofLoops[offset];</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        <span class="comment">// read some vectors</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="keywordtype">double</span> hj = h_old[j];</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        <span class="keywordtype">double</span> hunj = hu_old[j];</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        <span class="keywordtype">double</span> hvnj = hv_old[j];</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        <span class="keywordtype">double</span> hetanj = heta_old[j];</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <span class="keywordtype">double</span> hwnj = hw_old[j];</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        <span class="keywordtype">double</span> Zj = b_dof[j];</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <span class="keywordtype">double</span> one_over_hjReg =</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;            2 * hj / (hj * hj + std::pow(fmax(hj, hEps), 2)); <span class="comment">// hEps</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        <span class="comment">// COMPUTE STAR SOLUTION // hStar, huStar, hvStar, hetaStar, and</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;        <span class="comment">// hwStar</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;        <span class="keywordtype">double</span> hStarij = fmax(0., hi + Zi - fmax(Zi, Zj));</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;        <span class="keywordtype">double</span> huStarij = huni * hStarij * one_over_hiReg;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        <span class="keywordtype">double</span> hvStarij = hvni * hStarij * one_over_hiReg;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        <span class="keywordtype">double</span> hetaStarij = hetani * std::pow(hStarij * one_over_hiReg, 2);</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <span class="keywordtype">double</span> hwStarij = hwni * std::pow(hStarij * one_over_hiReg, 2);</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160; </div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="keywordtype">double</span> hStarji = fmax(0., hj + Zj - fmax(Zi, Zj));</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="keywordtype">double</span> huStarji = hunj * hStarji * one_over_hjReg;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        <span class="keywordtype">double</span> hvStarji = hvnj * hStarji * one_over_hjReg;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="keywordtype">double</span> hetaStarji = hetanj * std::pow(hStarji * one_over_hjReg, 2);</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="keywordtype">double</span> hwStarji = hwnj * std::pow(hStarij * one_over_hjReg, 2);</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160; </div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        <span class="comment">// COMPUTE FLUX CORRECTION MATRICES</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <span class="keywordtype">double</span> ML_minus_MC = (LUMPED_MASS_MATRIX == 1</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                                  ? 0.</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                                  : (i == j ? 1. : 0.) * mi - MassMatrix[ij]);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix1 =</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;            ML_minus_MC * (high_order_hnp1[j] - hj - (high_order_hnp1i - hi)) +</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (hStarji - hStarij) +</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;            dt * muH_minus_muL[ij] * (hj - hi);</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160; </div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix2 =</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;            ML_minus_MC *</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                (high_order_hunp1[j] - hunj - (high_order_hunp1i - huni)) +</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (huStarji - huStarij) +</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;            dt * muH_minus_muL[ij] * (hunj - huni);</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160; </div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix3 =</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;            ML_minus_MC *</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                (high_order_hvnp1[j] - hvnj - (high_order_hvnp1i - hvni)) +</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (hvStarji - hvStarij) +</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;            dt * muH_minus_muL[ij] * (hvnj - hvni);</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix4 =</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            ML_minus_MC * (high_order_hetanp1[j] - hetanj -</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                           (high_order_hetanp1i - hetani)) +</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) *</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                (hetaStarji - hetaStarij) +</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;            dt * muH_minus_muL[ij] * (hetanj - hetani);</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160; </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        <span class="keywordtype">double</span> FluxCorrectionMatrix5 =</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;            ML_minus_MC *</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                (high_order_hwnp1[j] - hwnj - (high_order_hwnp1i - hwni)) +</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            dt * (dH_minus_dL[ij] - muH_minus_muL[ij]) * (hwStarji - hwStarij) +</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            dt * muH_minus_muL[ij] * (hwnj - hwni);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160; </div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <span class="comment">// compute limiter based on water height</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <span class="keywordtype">double</span> Lij = 1.;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        <span class="keywordflow">if</span> (FluxCorrectionMatrix1 &gt;= 0)</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;          Lij = fmin(Lij, <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>[j], <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>[i]));</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;          Lij = fmin(Lij, <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">Rneg</a>[i], <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">Rpos</a>[j]));</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160; </div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        <span class="comment">// COMPUTE LIMITER based on heta -EJT</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        <span class="comment">// Note that we set lij = min(lij_h,lij_heta)</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        <span class="keywordflow">if</span> (FluxCorrectionMatrix4 &gt;= 0)</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;          Lij = fmin(Lij, <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>[j], <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>[i]));</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;          Lij = fmin(Lij, <a class="code" href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">std::min</a>(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">Rneg_heta</a>[i], <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">Rpos_heta</a>[j]));</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160; </div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="keywordtype">double</span> lambdaj =</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;            csrRowIndeces_DofLoops[i + 1] - csrRowIndeces_DofLoops[i] - 1;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        <span class="keywordtype">double</span> Ph_ij = FluxCorrectionMatrix1 / mi / lambdaj;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        <span class="keywordtype">double</span> Phu_ij = FluxCorrectionMatrix2 / mi / lambdaj;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        <span class="keywordtype">double</span> Phv_ij = FluxCorrectionMatrix3 / mi / lambdaj;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160; </div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <span class="keywordtype">double</span> ai = -0.5 * (Phu_ij * Phu_ij + Phv_ij * Phv_ij);</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <span class="keywordtype">double</span> bi = <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>[i] * Ph_ij - (<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[i] * Phu_ij + <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[i] * Phv_ij);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160; </div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <span class="keywordtype">double</span> r1 = ai == 0</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                        ? (bi == 0 ? 1. : -ci / bi)</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                        : (-bi + std::sqrt(bi * bi - 4 * ai * ci)) / 2. / ai;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="keywordtype">double</span> r2 = ai == 0</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                        ? (bi == 0 ? 1. : -ci / bi)</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                        : (-bi - std::sqrt(bi * bi - 4 * ai * ci)) / 2. / ai;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <span class="keywordflow">if</span> (r1 &lt; 0 &amp;&amp; r2 &lt; 0) {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;          r1 = 1.;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;          r2 = 1.;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        }</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        <span class="keywordtype">double</span> ri = fabs(fmax(r1, r2));</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160; </div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="comment">// root of jth-DOF (To compute transpose component)</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        <span class="keywordtype">double</span> lambdai =</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;            csrRowIndeces_DofLoops[j + 1] - csrRowIndeces_DofLoops[j] - 1;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        <span class="keywordtype">double</span> mj = lumped_mass_matrix[j];</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="keywordtype">double</span> cj = <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>[j] * <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[j] -</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                    0.5 * (<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[j] * <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[j] + <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[j] * <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[j]);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        <span class="keywordtype">double</span> Ph_ji = -FluxCorrectionMatrix1 / mj / lambdai; <span class="comment">// Aij=-Aji</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        <span class="keywordtype">double</span> Phu_ji = -FluxCorrectionMatrix2 / mj / lambdai;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        <span class="keywordtype">double</span> Phv_ji = -FluxCorrectionMatrix3 / mj / lambdai;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        <span class="keywordtype">double</span> aj = -0.5 * (Phu_ji * Phu_ji + Phv_ji * Phv_ji);</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        <span class="keywordtype">double</span> bj = <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">Kmax</a>[j] * Ph_ji - (<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[j] * Phu_ji + <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[j] * Phv_ji);</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160; </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        r1 = aj == 0 ? (bj == 0 ? 1. : -cj / bj)</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                     : (-bj + std::sqrt(bj * bj - 4 * aj * cj)) / 2. / aj;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        r2 = aj == 0 ? (bj == 0 ? 1. : -cj / bj)</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                     : (-bj - std::sqrt(bj * bj - 4 * aj * cj)) / 2. / aj;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <span class="keywordflow">if</span> (r1 &lt; 0 &amp;&amp; r2 &lt; 0) {</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;          r1 = 1.;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;          r2 = 1.;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        }</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        <span class="keywordtype">double</span> rj = fabs(fmax(r1, r2));</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160; </div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        <span class="comment">// COMPUTE LIMITER //</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        Lij = fmin(fmin(ri, Lij), fmin(rj, Lij)); <span class="comment">// Lij=Lji</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160; </div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        <span class="comment">// COMPUTE LIMITED FLUX //</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        ith_Limiter_times_FluxCorrectionMatrix1 += Lij * FluxCorrectionMatrix1;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        ith_Limiter_times_FluxCorrectionMatrix2 += Lij * FluxCorrectionMatrix2;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        ith_Limiter_times_FluxCorrectionMatrix3 += Lij * FluxCorrectionMatrix3;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        ith_Limiter_times_FluxCorrectionMatrix4 += Lij * FluxCorrectionMatrix4;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        ith_Limiter_times_FluxCorrectionMatrix5 += Lij * FluxCorrectionMatrix5;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160; </div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <span class="comment">// update ij</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        ij += 1;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      <span class="keywordtype">double</span> one_over_mi = 1.0 / lumped_mass_matrix[i];</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      limited_hnp1[i] =</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] + one_over_mi * ith_Limiter_times_FluxCorrectionMatrix1;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;      limited_hunp1[i] =</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;          ((<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">huLow</a>[i] + dt / mi * new_SourceTerm_hu[i]) +</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;           one_over_mi * ith_Limiter_times_FluxCorrectionMatrix2);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      limited_hvnp1[i] =</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;          ((<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">hvLow</a>[i] + dt / mi * new_SourceTerm_hv[i]) +</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;           one_over_mi * ith_Limiter_times_FluxCorrectionMatrix3);</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      limited_hetanp1[i] =</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;          ((<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">hetaLow</a>[i] - dt / mi * extendedSourceTerm_heta[i]) +</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;           one_over_mi * ith_Limiter_times_FluxCorrectionMatrix4);</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      limited_hwnp1[i] =</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;          ((<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ab50314b4fa3cd11d2ff906d644950a03">hwLow</a>[i] - dt / mi * extendedSourceTerm_hw[i]) +</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;           one_over_mi * ith_Limiter_times_FluxCorrectionMatrix5);</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160; </div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <span class="keywordflow">if</span> (limited_hnp1[i] &lt; -hEps &amp;&amp; dt &lt; 1.0) {</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Limited water height is negative: &quot;</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;hLow: &quot;</span> &lt;&lt; <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">hLow</a>[i] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;hHigh: &quot;</span> &lt;&lt; limited_hnp1[i] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;hEps:  &quot;</span> &lt;&lt; hEps &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; ... aborting!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        abort();</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <span class="comment">// clean up uHigh from round off error</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <span class="keywordflow">if</span> (limited_hnp1[i] &lt; hEps)</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;          limited_hnp1[i] = 0.0;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        <span class="comment">// // double aux = fmax(limited_hnp1[i], hEps); // hEps</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <span class="keywordtype">double</span> aux =</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            fmax(limited_hnp1[i], hEps); <span class="comment">// hReg makes the code more robust</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        limited_hunp1[i] *= 2 * std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) /</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                            (std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) +</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                             std::pow(aux, <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>));</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        limited_hvnp1[i] *= 2 * std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) /</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                            (std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) +</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                             std::pow(aux, <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>));</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        limited_hetanp1[i] *= 2 * std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) /</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                              (std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) +</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                               std::pow(aux, <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>));</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        limited_hwnp1[i] *= 2 * std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) /</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;                            (std::pow(limited_hnp1[i], <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>) +</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                             std::pow(aux, <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a>));</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;      }</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    }</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  }</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160; </div>
<div class="line"><a name="l01507"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afea0a969d6336488123fbd8330694e75"> 1507</a></span>&#160;  <span class="keywordtype">double</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afea0a969d6336488123fbd8330694e75">calculateEdgeBasedCFL</a>(</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;      <span class="keywordtype">double</span> g,</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;      <span class="keywordtype">int</span> numDOFsPerEqn,          <span class="comment">// number of DOFs</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      <span class="keywordtype">double</span> *lumped_mass_matrix, <span class="comment">// lumped mass matrix (as vector))</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      <span class="keywordtype">double</span> *h_dof_old,          <span class="comment">// DOFs of solution at last stage</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      <span class="keywordtype">double</span> *hu_dof_old, <span class="keywordtype">double</span> *hv_dof_old, <span class="keywordtype">double</span> *heta_dof_old,</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      <span class="keywordtype">double</span> *b_dof,</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_DofLoops,    <span class="comment">// csr row indeces</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_DofLoops, <span class="comment">// csr column offsets</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      <span class="keywordtype">double</span> hEps, <span class="keywordtype">double</span> *hReg, <span class="keywordtype">double</span> *Cx, <span class="keywordtype">double</span> *Cy, <span class="keywordtype">double</span> *CTx,</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      <span class="keywordtype">double</span> *CTy, <span class="keywordtype">double</span> *dLow, <span class="keywordtype">double</span> run_cfl, <span class="keywordtype">double</span> *edge_based_cfl,</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      <span class="keywordtype">int</span> debug) {</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160; </div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="comment">/* note that for the CFL condition, we use only the values of dij and</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment">     * don&#39;t do the dij = Max(dij,muij) thing */</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160; </div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    std::valarray&lt;double&gt; <a class="code" href="_headers_8h.html#acf2aa06bc881a993584c334b2b7c6e03">psi</a>(numDOFsPerEqn);</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="keywordtype">double</span> max_edge_based_cfl = 0.;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="keywordtype">int</span> ij = 0;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFsPerEqn; i++) {</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      <span class="comment">// solution at time tn for the ith DOF</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;      <span class="keywordtype">double</span> hi = h_dof_old[i];</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;      <span class="keywordtype">double</span> hui = hu_dof_old[i];</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;      <span class="keywordtype">double</span> hvi = hv_dof_old[i];</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;      <span class="keywordtype">double</span> hetai = heta_dof_old[i];</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;      <span class="keywordtype">double</span> mi = lumped_mass_matrix[i];</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;      <span class="keywordtype">double</span> dLowii = 0.;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160; </div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> offset = csrRowIndeces_DofLoops[i];</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;           offset &lt; csrRowIndeces_DofLoops[i + 1]; offset++) {</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        <span class="comment">// loop in j (sparsity pattern)</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        <span class="comment">// solution at time tn for the jth DOF</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        <span class="keywordtype">int</span> j = csrColumnOffsets_DofLoops[offset];</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        <span class="keywordtype">double</span> hj = h_dof_old[j];</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        <span class="keywordtype">double</span> huj = hu_dof_old[j];</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        <span class="keywordtype">double</span> hvj = hv_dof_old[j];</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;        <span class="keywordtype">double</span> hetaj = heta_dof_old[j];</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        <span class="keywordtype">double</span> mj = lumped_mass_matrix[j];</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160; </div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <span class="keywordflow">if</span> (i != j) {</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;          <span class="comment">// DISSIPATIVE MATRIX //</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment"></span>          <span class="keywordtype">double</span> cij_norm = sqrt(Cx[ij] * Cx[ij] + Cy[ij] * Cy[ij]);</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;          <span class="keywordtype">double</span> cji_norm = sqrt(CTx[ij] * CTx[ij] + CTy[ij] * CTy[ij]);</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;          <span class="keywordtype">double</span> nxij = Cx[ij] / cij_norm, nyij = Cy[ij] / cij_norm;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;          <span class="keywordtype">double</span> nxji = CTx[ij] / cji_norm, nyji = CTy[ij] / cji_norm;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160; </div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;          dLow[ij] =</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;              fmax(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a6cf917d2db4b144bf075f553cbdfa4b0">maxWaveSpeedSharpInitialGuess</a>(g, nxij, nyij, hi, hui, hvi,</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                                                 hetai, mi, hj, huj, hvj, hetaj,</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                                                 mj, hEps, hEps, debug) *</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                       cij_norm, <span class="comment">// hEps</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                   <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a6cf917d2db4b144bf075f553cbdfa4b0">maxWaveSpeedSharpInitialGuess</a>(g, nxji, nyji, hj, huj, hvj,</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                                                 hetaj, mj, hi, hui, hvi, hetai,</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                                                 mi, hEps, hEps, debug) *</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                       cji_norm); <span class="comment">// hEps</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;          dLowii -= dLow[ij];</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160; </div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        } <span class="keywordflow">else</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;          dLow[ij] = 0.;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        <span class="comment">// update ij</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        ij += 1;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      }</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      <span class="comment">// CALCULATE EDGE BASED CFL //</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="comment"></span>      <span class="comment">// mi = lumped_mass_matrix[i];</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;      edge_based_cfl[i] = 1.0 * fabs(dLowii) / mi;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      max_edge_based_cfl = fmax(max_edge_based_cfl, edge_based_cfl[i]);</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    }</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160; </div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <span class="keywordflow">return</span> max_edge_based_cfl;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  } <span class="comment">// End calculateEdgeBasedCFL</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160; </div>
<div class="line"><a name="l01582"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#aa0a53e618b89dc3e930acf7078c381a2"> 1582</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#aa0a53e618b89dc3e930acf7078c381a2">calculateResidual</a>( <span class="comment">// last EDGE BASED version</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_ref, <span class="keywordtype">double</span> *mesh_grad_trial_ref, <span class="keywordtype">double</span> *mesh_dof,</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      <span class="keywordtype">double</span> *mesh_velocity_dof, <span class="keywordtype">double</span> MOVING_DOMAIN, <span class="keywordtype">int</span> *mesh_l2g,</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;      <span class="keywordtype">double</span> *dV_ref, <span class="keywordtype">double</span> *h_trial_ref, <span class="keywordtype">double</span> *h_grad_trial_ref,</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="keywordtype">double</span> *h_test_ref, <span class="keywordtype">double</span> *h_grad_test_ref, <span class="keywordtype">double</span> *vel_trial_ref,</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      <span class="keywordtype">double</span> *vel_grad_trial_ref, <span class="keywordtype">double</span> *vel_test_ref,</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;      <span class="keywordtype">double</span> *vel_grad_test_ref,</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <span class="comment">// element boundary</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_trace_ref, <span class="keywordtype">double</span> *mesh_grad_trial_trace_ref,</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      <span class="keywordtype">double</span> *dS_ref, <span class="keywordtype">double</span> *h_trial_trace_ref, <span class="keywordtype">double</span> *h_grad_trial_trace_ref,</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;      <span class="keywordtype">double</span> *h_test_trace_ref, <span class="keywordtype">double</span> *h_grad_test_trace_ref,</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;      <span class="keywordtype">double</span> *vel_trial_trace_ref, <span class="keywordtype">double</span> *vel_grad_trial_trace_ref,</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;      <span class="keywordtype">double</span> *vel_test_trace_ref, <span class="keywordtype">double</span> *vel_grad_test_trace_ref,</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      <span class="keywordtype">double</span> *normal_ref, <span class="keywordtype">double</span> *boundaryJac_ref,</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;      <span class="comment">// physics</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      <span class="keywordtype">double</span> *elementDiameter, <span class="keywordtype">int</span> nElements_global, <span class="keywordtype">double</span> useRBLES,</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;      <span class="keywordtype">double</span> useMetrics, <span class="keywordtype">double</span> alphaBDF, <span class="keywordtype">double</span> nu, <span class="keywordtype">double</span> g, <span class="keywordtype">int</span> *h_l2g,</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      <span class="keywordtype">int</span> *vel_l2g, <span class="keywordtype">double</span> *h_dof_old, <span class="keywordtype">double</span> *hu_dof_old, <span class="keywordtype">double</span> *hv_dof_old,</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      <span class="keywordtype">double</span> *heta_dof_old, <span class="keywordtype">double</span> *hw_dof_old, <span class="keywordtype">double</span> *b_dof, <span class="keywordtype">double</span> *h_dof,</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;      <span class="keywordtype">double</span> *hu_dof, <span class="keywordtype">double</span> *hv_dof, <span class="keywordtype">double</span> *heta_dof, <span class="keywordtype">double</span> *hw_dof,</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="keywordtype">double</span> *h_dof_sge, <span class="keywordtype">double</span> *hu_dof_sge, <span class="keywordtype">double</span> *hv_dof_sge,</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      <span class="keywordtype">double</span> *heta_dof_sge, <span class="keywordtype">double</span> *hw_dof_sge, <span class="keywordtype">double</span> *q_mass_acc,</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <span class="keywordtype">double</span> *q_mom_hu_acc, <span class="keywordtype">double</span> *q_mom_hv_acc, <span class="keywordtype">double</span> *q_mass_adv,</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      <span class="keywordtype">double</span> *q_mass_acc_beta_bdf, <span class="keywordtype">double</span> *q_mom_hu_acc_beta_bdf,</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keywordtype">double</span> *q_mom_hv_acc_beta_bdf, <span class="keywordtype">double</span> *q_cfl, <span class="keywordtype">int</span> *sdInfo_hu_hu_rowptr,</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hu_hu_colind, <span class="keywordtype">int</span> *sdInfo_hu_hv_rowptr,</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hu_hv_colind, <span class="keywordtype">int</span> *sdInfo_hv_hv_rowptr,</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hv_colind, <span class="keywordtype">int</span> *sdInfo_hv_hu_rowptr,</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hu_colind, <span class="keywordtype">int</span> offset_h, <span class="keywordtype">int</span> offset_hu, <span class="keywordtype">int</span> offset_hv,</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      <span class="keywordtype">int</span> offset_heta, <span class="keywordtype">int</span> offset_hw, <span class="keywordtype">int</span> stride_h, <span class="keywordtype">int</span> stride_hu,</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      <span class="keywordtype">int</span> stride_hv, <span class="keywordtype">int</span> stride_heta, <span class="keywordtype">int</span> stride_hw, <span class="keywordtype">double</span> *globalResidual,</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      <span class="keywordtype">int</span> nExteriorElementBoundaries_global,</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      <span class="keywordtype">int</span> *exteriorElementBoundariesArray, <span class="keywordtype">int</span> *elementBoundaryElementsArray,</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      <span class="keywordtype">int</span> *elementBoundaryLocalElementBoundariesArray, <span class="keywordtype">int</span> *isDOFBoundary_h,</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;      <span class="keywordtype">int</span> *isDOFBoundary_hu, <span class="keywordtype">int</span> *isDOFBoundary_hv,</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_h, <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hu,</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hv, <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hu,</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hv, <span class="keywordtype">double</span> *ebqe_bc_h_ext,</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mass_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hu_adv_ext,</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hv_adv_ext, <span class="keywordtype">double</span> *ebqe_bc_hu_ext,</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_hu_diff_ext, <span class="keywordtype">double</span> *ebqe_penalty_ext,</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_hv_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_hv_diff_ext,</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;      <span class="keywordtype">double</span> *q_velocity, <span class="keywordtype">double</span> *ebqe_velocity, <span class="keywordtype">double</span> *flux,</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;      <span class="keywordtype">double</span> *elementResidual_h_save,</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      <span class="comment">// C matrices</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      <span class="keywordtype">double</span> *Cx, <span class="keywordtype">double</span> *Cy, <span class="keywordtype">double</span> *CTx, <span class="keywordtype">double</span> *CTy,</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;      <span class="comment">// PARAMETERS FOR EDGE BASED STABILIZATION</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      <span class="keywordtype">int</span> numDOFsPerEqn, <span class="keywordtype">int</span> NNZ, <span class="keywordtype">int</span> *csrRowIndeces_DofLoops,</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_DofLoops,</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      <span class="comment">// LUMPED MASS MATRIX</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      <span class="keywordtype">double</span> *lumped_mass_matrix, <span class="keywordtype">double</span> cfl_run, <span class="keywordtype">double</span> hEps, <span class="keywordtype">double</span> *hReg,</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      <span class="comment">// SAVE SOLUTION (mql)</span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <span class="keywordtype">double</span> *hnp1_at_quad_point, <span class="keywordtype">double</span> *hunp1_at_quad_point,</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      <span class="keywordtype">double</span> *hvnp1_at_quad_point, <span class="keywordtype">double</span> *hetanp1_at_quad_point,</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      <span class="keywordtype">double</span> *hwnp1_at_quad_point,</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;      <span class="comment">// TO COMPUTE LOW ORDER</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      <span class="keywordtype">double</span> *extendedSourceTerm_hu, <span class="keywordtype">double</span> *extendedSourceTerm_hv,</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      <span class="keywordtype">double</span> *extendedSourceTerm_heta, <span class="keywordtype">double</span> *extendedSourceTerm_hw,</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;      <span class="comment">// FOR FCT</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      <span class="keywordtype">double</span> *dH_minus_dL, <span class="keywordtype">double</span> *muH_minus_muL, <span class="keywordtype">double</span> <a class="code" href="_n_c_l_s3_p_8h.html#ac3a8009eac7340083df50a7d681f77bc">cE</a>,</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      <span class="keywordtype">int</span> LUMPED_MASS_MATRIX, <span class="keywordtype">double</span> dt, <span class="keywordtype">int</span> LINEAR_FRICTION, <span class="keywordtype">double</span> mannings,</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      <span class="comment">// Quant of interests</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;      <span class="keywordtype">double</span> *quantDOFs, <span class="keywordtype">int</span> SECOND_CALL_CALCULATE_RESIDUAL,</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      <span class="comment">// NORMAL COMPONENTS</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      <span class="keywordtype">int</span> COMPUTE_NORMALS, <span class="keywordtype">double</span> *normalx, <span class="keywordtype">double</span> *normaly, <span class="keywordtype">double</span> *dLow,</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      <span class="comment">// LOCAL LIMITING</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      <span class="keywordtype">double</span> *hBT, <span class="keywordtype">double</span> *huBT, <span class="keywordtype">double</span> *hvBT, <span class="keywordtype">double</span> *hetaBT, <span class="keywordtype">double</span> *hwBT,</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;      <span class="keywordtype">int</span> lstage, <span class="keywordtype">double</span> *new_SourceTerm_hu, <span class="keywordtype">double</span> *new_SourceTerm_hv,</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      <span class="keywordtype">double</span> *new_SourceTerm_heta, <span class="keywordtype">double</span> *new_SourceTerm_hw) {</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160; </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="comment">// FOR FRICTION//</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <span class="keywordtype">double</span> n2 = std::pow(mannings, 2.);</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="keywordtype">double</span> gamma = 4. / 3;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="comment">// mql. This parameter relaxes the cfl restriction.</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="comment">// It is now conservative. I might change it after the local bounds are</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="comment">// implemented</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="keywordtype">double</span> xi = 10.;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160; </div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    <span class="comment">// ********** CELL LOOPS ********** //</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment"></span>    <span class="comment">// To compute:</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="comment">//      * Time derivative term</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    <span class="comment">//      * Cell based CFL</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="comment">//      * Velocity and soln at quad points (for other models)</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> eN = 0; eN &lt; nElements_global; eN++) {</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      <span class="comment">// declare local storage for element residual and initialize</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      <span class="keyword">register</span> <span class="keywordtype">double</span> elementResidual_h[nDOF_test_element],</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;          elementResidual_hu[nDOF_test_element],</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;          elementResidual_hv[nDOF_test_element],</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;          elementResidual_heta[nDOF_test_element],</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;          elementResidual_hw[nDOF_test_element];</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160; </div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDOF_test_element; i++) {</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        elementResidual_h[i] = 0.0;</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        elementResidual_hu[i] = 0.0;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        elementResidual_hv[i] = 0.0;</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        elementResidual_heta[i] = 0.0;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        elementResidual_hw[i] = 0.0;</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      }</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      <span class="comment">// loop over quadrature points and compute integrands</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; nQuadraturePoints_element; k++) {</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        <span class="comment">// compute indices and declare local storage</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        <span class="keyword">register</span> <span class="keywordtype">int</span> eN_k = eN * nQuadraturePoints_element + k,</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                     eN_k_nSpace = eN_k * nSpace,</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                     eN_nDOF_trial_element = eN * nDOF_trial_element;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        <span class="keyword">register</span> <span class="keywordtype">double</span> h = 0.0, hu = 0.0, hv = 0.0, heta = 0.0,</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                        hw = 0.0, <span class="comment">// solution at current time</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;            h_old = 0.0, hu_old = 0.0, hv_old = 0.0, heta_old = 0.0,</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                        hw_old = 0.0, <span class="comment">// solution at lstage</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;            jac[nSpace * nSpace], jacDet, jacInv[nSpace * nSpace],</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                        h_test_dV[nDOF_trial_element], dV, x, y, xt, yt;</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;        <span class="comment">// get jacobian, etc for mapping reference element</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.calculateMapping_element(eN, k, mesh_dof, mesh_l2g, mesh_trial_ref,</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                                    mesh_grad_trial_ref, jac, jacDet, jacInv, x,</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                                    y);</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        <span class="comment">// get the physical integration weight</span></div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        dV = fabs(jacDet) * dV_ref[k];</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        <span class="comment">// get the solution at current time</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.valFromDOF(h_dof, &amp;h_l2g[eN_nDOF_trial_element],</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                      &amp;h_trial_ref[k * nDOF_trial_element], h);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.valFromDOF(hu_dof, &amp;vel_l2g[eN_nDOF_trial_element],</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                      &amp;vel_trial_ref[k * nDOF_trial_element], hu);</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.valFromDOF(hv_dof, &amp;vel_l2g[eN_nDOF_trial_element],</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                      &amp;vel_trial_ref[k * nDOF_trial_element], hv);</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.valFromDOF(heta_dof, &amp;vel_l2g[eN_nDOF_trial_element],</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                      &amp;vel_trial_ref[k * nDOF_trial_element], heta);</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.valFromDOF(hw_dof, &amp;vel_l2g[eN_nDOF_trial_element],</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                      &amp;vel_trial_ref[k * nDOF_trial_element], hw);</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;        <span class="comment">// get the solution at the lstage</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.valFromDOF(h_dof_old, &amp;h_l2g[eN_nDOF_trial_element],</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                      &amp;h_trial_ref[k * nDOF_trial_element], h_old);</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.valFromDOF(hu_dof_old, &amp;vel_l2g[eN_nDOF_trial_element],</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                      &amp;vel_trial_ref[k * nDOF_trial_element], hu_old);</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.valFromDOF(hv_dof_old, &amp;vel_l2g[eN_nDOF_trial_element],</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;                      &amp;vel_trial_ref[k * nDOF_trial_element], hv_old);</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.valFromDOF(heta_dof_old, &amp;vel_l2g[eN_nDOF_trial_element],</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                      &amp;vel_trial_ref[k * nDOF_trial_element], heta_old);</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.valFromDOF(hw_dof_old, &amp;vel_l2g[eN_nDOF_trial_element],</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                      &amp;vel_trial_ref[k * nDOF_trial_element], hw_old);</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        <span class="comment">// calculate cell based CFL to keep a reference</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#abaeb7eba7acf21a37856e253f038797b">calculateCFL</a>(elementDiameter[eN], g, h_old, hu_old, hv_old, hEps,</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                     q_cfl[eN_k]);</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <span class="comment">// precalculate test function products with integration weights</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nDOF_trial_element; j++)</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;          h_test_dV[j] = h_test_ref[k * nDOF_trial_element + j] * dV;</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160; </div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="comment">// SAVE VELOCITY // at quadrature points for other models to use</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        q_velocity[eN_k_nSpace + 0] =</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            2 * h / (h * h + std::pow(fmax(h, hEps), 2)) * hu;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        q_velocity[eN_k_nSpace + 1] =</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;            2 * h / (h * h + std::pow(fmax(h, hEps), 2)) * hv;</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        hnp1_at_quad_point[eN_k] = h;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        hunp1_at_quad_point[eN_k] = hu;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        hvnp1_at_quad_point[eN_k] = hv;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        hetanp1_at_quad_point[eN_k] = heta;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        hwnp1_at_quad_point[eN_k] = hw;</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160; </div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDOF_test_element; i++) {</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;          <span class="comment">// compute time derivative part of global residual. NOTE: no lumping</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;          elementResidual_h[i] += (h - h_old) * h_test_dV[i];</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;          elementResidual_hu[i] += (hu - hu_old) * h_test_dV[i];</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;          elementResidual_hv[i] += (hv - hv_old) * h_test_dV[i];</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;          elementResidual_heta[i] += (heta - heta_old) * h_test_dV[i];</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;          elementResidual_hw[i] += (hw - hw_old) * h_test_dV[i];</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;        }</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;      }</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      <span class="comment">// distribute</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDOF_test_element; i++) {</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        <span class="keyword">register</span> <span class="keywordtype">int</span> eN_i = eN * nDOF_test_element + i;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        <span class="keywordtype">int</span> h_gi = h_l2g[eN_i];     <span class="comment">// global i-th index for h</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        <span class="keywordtype">int</span> vel_gi = vel_l2g[eN_i]; <span class="comment">// global i-th index for velocities</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160; </div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <span class="comment">// distribute time derivative to global residual</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        globalResidual[offset_h + stride_h * h_gi] += elementResidual_h[i];</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        globalResidual[offset_hu + stride_hu * vel_gi] += elementResidual_hu[i];</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        globalResidual[offset_hv + stride_hv * vel_gi] += elementResidual_hv[i];</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        globalResidual[offset_heta + stride_heta * vel_gi] +=</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;            elementResidual_heta[i];</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        globalResidual[offset_hw + stride_hw * vel_gi] += elementResidual_hw[i];</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      }</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    }</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="comment">// ********** END OF CELL LOOPS ********** //</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160; </div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordflow">if</span> (SECOND_CALL_CALCULATE_RESIDUAL == 0) <span class="comment">// This is to save some time</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    {</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;      <span class="comment">// ********** FIRST LOOP ON DOFs ********** //</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;      <span class="comment">// To compute:</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;      <span class="comment">//     * Entropy at i-th node</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;      std::valarray&lt;double&gt; eta(numDOFsPerEqn);</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFsPerEqn; i++) {</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        <span class="comment">// COMPUTE ENTROPY. NOTE: WE CONSIDER A FLAT BOTTOM</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        <span class="keywordtype">double</span> hi = h_dof_old[i];</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <span class="keywordtype">double</span> one_over_hiReg =</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            2 * hi / (hi * hi + std::pow(fmax(hi, hEps), 2)); <span class="comment">// hEps</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        eta[i] =</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;            <a class="code" href="namespaceproteus.html#a168fa7179bef9c8bff1dc8fbdf4737ca">ENTROPY</a>(g, hi, hu_dof_old[i], hv_dof_old[i], 0., one_over_hiReg);</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      }</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160; </div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      <span class="comment">// ********** END OF FIRST LOOP ON DOFs ********** //</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160; </div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      <span class="comment">// ********** SECOND LOOP ON DOFs ********** //</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment"></span>      <span class="comment">// To compute:</span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;      <span class="comment">//     * Hyperbolic part of the flux</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      <span class="comment">//     * Extended source term (eqn 6.19)</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      <span class="comment">//     * Smoothness indicator</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;      <span class="comment">//     * global entropy residual</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160; </div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;      <span class="keywordtype">int</span> ij = 0;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;      std::valarray&lt;double&gt; hyp_flux_h(numDOFsPerEqn),</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;          hyp_flux_hu(numDOFsPerEqn), hyp_flux_hv(numDOFsPerEqn),</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;          hyp_flux_heta(numDOFsPerEqn), hyp_flux_hw(numDOFsPerEqn),</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;          global_entropy_residual(numDOFsPerEqn), <a class="code" href="_headers_8h.html#acf2aa06bc881a993584c334b2b7c6e03">psi</a>(numDOFsPerEqn),</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;          etaMax(numDOFsPerEqn), etaMin(numDOFsPerEqn);</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160; </div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFsPerEqn; i++) {</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160; </div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="comment">// solution at time tn for the ith DOF</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        <span class="keywordtype">double</span> hi = h_dof_old[i];</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;        <span class="keywordtype">double</span> hui = hu_dof_old[i];</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        <span class="keywordtype">double</span> hvi = hv_dof_old[i];</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;        <span class="keywordtype">double</span> hetai = heta_dof_old[i];</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        <span class="keywordtype">double</span> hwi = hw_dof_old[i];</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        <span class="keywordtype">double</span> Zi = b_dof[i];</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        <span class="comment">// Define some things using above</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;        <span class="keywordtype">double</span> one_over_hiReg =</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;            2 * hi / (hi * hi + std::pow(fmax(hi, hEps), 2)); <span class="comment">// hEps</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        <span class="keywordtype">double</span> ui = hui * one_over_hiReg;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;        <span class="keywordtype">double</span> vi = hvi * one_over_hiReg;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        <span class="keywordtype">double</span> etai = hetai * one_over_hiReg;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        <span class="keywordtype">double</span> mi = lumped_mass_matrix[i];</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        <span class="keywordtype">double</span> meshSizei = std::sqrt(mi);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160; </div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        <span class="comment">// For eta min and max</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        etaMax[i] = fabs(eta[i]);</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        etaMin[i] = fabs(eta[i]);</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160; </div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        <span class="comment">/* COMPUTE EXTENDED SOURCE TERMS:</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment">         * Friction terms</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment">         * Source for heta equation</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">         * Source for hw equation</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">         * NOTE: Be careful with sign of source terms.</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160; </div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        <span class="comment">// Friction</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;        <span class="keywordflow">if</span> (LINEAR_FRICTION == 1) {</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;          extendedSourceTerm_hu[i] = mannings * hui * mi;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;          extendedSourceTerm_hv[i] = mannings * hvi * mi;</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;          <span class="comment">// For use in the convex limiting function -EJT</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;          <span class="comment">// actually didn&#39;t need to do this but it helps with signs</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;          new_SourceTerm_hu[i] = -mannings * hui * mi;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;          new_SourceTerm_hv[i] = -mannings * hvi * mi;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;          <span class="keywordtype">double</span> veli_norm = std::sqrt(ui * ui + vi * vi);</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;          <span class="keywordtype">double</span> hi_to_the_gamma = std::pow(fmax(hi, hEps), gamma);</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;          <span class="keywordtype">double</span> friction_aux =</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;              veli_norm == 0.</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                  ? 0.</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                  : (2 * g * n2 * veli_norm * mi /</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                     (hi_to_the_gamma +</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                      fmax(hi_to_the_gamma, xi * g * n2 * dt * veli_norm)));</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;          extendedSourceTerm_hu[i] = friction_aux * hui;</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;          extendedSourceTerm_hv[i] = friction_aux * hvi;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;          <span class="comment">// For use in the convex limiting function -EJT</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;          new_SourceTerm_hu[i] = -friction_aux * hui;</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;          new_SourceTerm_hv[i] = -friction_aux * hvi;</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        }</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160; </div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        <span class="comment">// Define some things for heta and hw sources</span></div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        <span class="keywordtype">double</span> ratio_i = (2.0 * hetai) / (etai * etai + hi * hi + hEps);</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        <span class="keywordtype">double</span> diff_over_h_i = (hetai - hi * hi) * one_over_hiReg;</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        <span class="keywordtype">double</span> hSqd_GammaPi = 6.0 * (hetai - hi * hi);</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a10b9177dd08eb7e17dd16dba2a85fc3a">IF_BOTH_GAMMA_BRANCHES</a>) {</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;          <span class="keywordflow">if</span> (hetai &gt; std::pow(hi, 2.0)) {</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;            hSqd_GammaPi = 6.0 * etai * diff_over_h_i;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;          }</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        }</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160; </div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;        <span class="comment">// heta source</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        extendedSourceTerm_heta[i] = -hwi * mi * ratio_i;</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        new_SourceTerm_heta[i] = hwi * mi * ratio_i;</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160; </div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        <span class="comment">// hw source</span></div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;        extendedSourceTerm_hw[i] =</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;            (<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> * g / meshSizei) * hSqd_GammaPi * mi * ratio_i;</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;        new_SourceTerm_hw[i] =</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;            -(<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> * g / meshSizei) * hSqd_GammaPi * mi * ratio_i;</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160; </div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        <span class="comment">/* HYPERBOLIC FLUXES */</span></div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;        hyp_flux_h[i] = 0;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        hyp_flux_hu[i] = 0;</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        hyp_flux_hv[i] = 0;</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;        hyp_flux_heta[i] = 0;</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;        hyp_flux_hw[i] = 0;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160; </div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        <span class="comment">// FOR ENTROPY RESIDUAL //</span></div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;        <span class="keywordtype">double</span> ith_flux_term1 = 0., ith_flux_term2 = 0., ith_flux_term3 = 0.;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        <span class="keywordtype">double</span> ith_flux_term4 = 0., ith_flux_term5 = 0.;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        <span class="keywordtype">double</span> entropy_flux = 0.;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160; </div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        <span class="comment">// FOR SMOOTHNESS INDICATOR //</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        <span class="keywordtype">double</span> alphai; <span class="comment">// smoothness indicator of solution</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <span class="keywordtype">double</span> alpha_numerator = 0;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        <span class="keywordtype">double</span> alpha_denominator = 0;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        <span class="keywordtype">double</span> alpha_zero = 0.75;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;        <span class="keywordtype">double</span> alpha_factor = 1.0 / (1.0 - alpha_zero);</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160; </div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        <span class="comment">// loop in j (sparsity pattern)</span></div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> offset = csrRowIndeces_DofLoops[i];</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;             offset &lt; csrRowIndeces_DofLoops[i + 1]; offset++) {</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160; </div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;          <span class="keywordtype">int</span> j = csrColumnOffsets_DofLoops[offset];</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;          <span class="comment">// solution at time tn for the jth DOF</span></div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;          <span class="keywordtype">double</span> hj = h_dof_old[j];</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;          <span class="keywordtype">double</span> huj = hu_dof_old[j];</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;          <span class="keywordtype">double</span> hvj = hv_dof_old[j];</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;          <span class="keywordtype">double</span> hetaj = heta_dof_old[j];</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;          <span class="keywordtype">double</span> hwj = hw_dof_old[j];</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;          <span class="keywordtype">double</span> Zj = b_dof[j];</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160; </div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;          <span class="comment">// Then define some things here using above</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;          <span class="keywordtype">double</span> one_over_hjReg =</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;              2.0 * hj / (hj * hj + std::pow(fmax(hj, hEps), 2)); <span class="comment">// hEps</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;          <span class="keywordtype">double</span> uj = huj * one_over_hjReg;</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;          <span class="keywordtype">double</span> vj = hvj * one_over_hjReg;</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;          <span class="keywordtype">double</span> etaj = hetaj * one_over_hjReg;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;          <span class="keywordtype">double</span> meshSizej =</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;              std::sqrt(lumped_mass_matrix[j]); <span class="comment">// local mesh size in 2d</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160; </div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;          <span class="comment">// pTilde at jth node gets defined here</span></div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;          <span class="keywordtype">double</span> diff_over_h_j = (hetaj - hj * hj) * one_over_hjReg;</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;          <span class="keywordtype">double</span> pTildej = -(<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> * g / (3.0 * meshSizej)) * 6.0 * hj *</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                           (hetaj - hj * hj);</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160; </div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a10b9177dd08eb7e17dd16dba2a85fc3a">IF_BOTH_GAMMA_BRANCHES</a>) {</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;            <span class="keywordflow">if</span> (hetaj &gt; std::pow(hj, 2.0)) {</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;              pTildej = -(<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> * g / (3.0 * meshSizej)) * 2.0 *</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;                        diff_over_h_j * (etaj * etaj + etaj * hj + hj * hj);</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;            }</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;          }</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160; </div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;          <span class="comment">// auxiliary functions to compute fluxes</span></div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;          <span class="keywordtype">double</span> aux_h =</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;              (uj * hj - ui * hi) * Cx[ij] + (vj * hj - vi * hi) * Cy[ij];</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;          <span class="keywordtype">double</span> aux_hu =</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;              (uj * huj - ui * hui) * Cx[ij] + (vj * huj - vi * hui) * Cy[ij];</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;          <span class="keywordtype">double</span> aux_hv =</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;              (uj * hvj - ui * hvi) * Cx[ij] + (vj * hvj - vi * hvi) * Cy[ij];</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;          <span class="keywordtype">double</span> aux_heta = (uj * hetaj - ui * hetai) * Cx[ij] +</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;                            (vj * hetaj - vi * hetai) * Cy[ij];</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;          <span class="keywordtype">double</span> aux_hw =</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;              (uj * hwj - ui * hwi) * Cx[ij] + (vj * hwj - vi * hwi) * Cy[ij];</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160; </div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;          <span class="comment">/* HYPERBOLIC FLUX */</span></div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;          hyp_flux_h[i] += aux_h;</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;          hyp_flux_hu[i] += aux_hu + pTildej * Cx[ij];</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;          hyp_flux_hv[i] += aux_hv + pTildej * Cy[ij];</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;          hyp_flux_heta[i] += aux_heta;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;          hyp_flux_hw[i] += aux_hw;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160; </div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;          <span class="comment">// EXTENDED SOURCE, USING 6.13 //</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;          extendedSourceTerm_hu[i] += g * hi * (hj + Zj) * Cx[ij];</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;          extendedSourceTerm_hv[i] += g * hi * (hj + Zj) * Cy[ij];</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160; </div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;          new_SourceTerm_hu[i] +=</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;              g * (-hi * (Zj - Zi) + 0.5 * std::pow(hj - hi, 2)) * Cx[ij];</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;          new_SourceTerm_hv[i] +=</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;              g * (-hi * (Zj - Zi) + 0.5 * std::pow(hj - hi, 2)) * Cy[ij];</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160; </div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;          <span class="comment">// flux for entropy</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;          ith_flux_term1 += aux_h;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;          ith_flux_term2 += aux_hu + g * hi * (hj + 0.) * Cx[ij]; <span class="comment">// NOTE: Zj=0</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;          ith_flux_term3 += aux_hv + g * hi * (hj + 0.) * Cy[ij]; <span class="comment">// NOTE: Zj=0</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160; </div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;          <span class="comment">// NOTE: WE CONSIDER FLAT BOTTOM</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;          entropy_flux +=</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;              (Cx[ij] * <a class="code" href="namespaceproteus.html#a1eb3932cf3ec78d9e5e0a63256d5378a">ENTROPY_FLUX1</a>(g, hj, huj, hvj, 0., one_over_hjReg) +</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;               Cy[ij] * <a class="code" href="namespaceproteus.html#ac5017200ca551e2c3c646a25c6619391">ENTROPY_FLUX2</a>(g, hj, huj, hvj, 0., one_over_hjReg));</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160; </div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;          <span class="comment">// COMPUTE ETA MIN AND ETA MAX //</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;          etaMax[i] = fmax(etaMax[i], fabs(eta[j]));</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;          etaMin[i] = fmin(etaMin[i], fabs(eta[j]));</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160; </div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;          <span class="comment">// FOR SMOOTHNESS INDICATOR //</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;          alpha_numerator += hj - hi;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;          alpha_denominator += fabs(hj - hi);</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160; </div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;          <span class="comment">// update ij</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;          ij += 1;</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        } <span class="comment">// end j loop</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160; </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        <span class="comment">// Change rescaling to match TAMU code -EJT, 12/9/2019</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        <span class="comment">// Here we divide by eps = 1E-5 so that small recale = 1/2 g eps</span></div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;        <span class="comment">// H_{0,max}^2</span></div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        <span class="keywordtype">double</span> small_rescale = g * hEps * hEps / 1E-5;</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        <span class="keywordtype">double</span> rescale = fmax(fabs(etaMax[i] - etaMin[i]) / 2., small_rescale);</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160; </div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        <span class="comment">// COMPUTE ENTROPY RESIDUAL //</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;        <span class="keywordtype">double</span> one_over_entNormFactori = 1.0 / rescale;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        <span class="comment">// double one_over_entNormFactori = 2. / (etaMax[i] - etaMin[i] +</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        <span class="comment">// 1E-15);</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160; </div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        <span class="keywordtype">double</span> eta_prime1 = <a class="code" href="namespaceproteus.html#aa7382e6e38581baca5f477ee2d1a4ed4">DENTROPY_DH</a>(g, hi, hui, hvi, 0.,</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;                                        one_over_hiReg); <span class="comment">// NOTE: FLAT BOTTOM</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        <span class="keywordtype">double</span> eta_prime2 = <a class="code" href="namespaceproteus.html#a5eb23919a33f36a2faf26440020d0a70">DENTROPY_DHU</a>(g, hi, hui, hvi, 0., one_over_hiReg);</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        <span class="keywordtype">double</span> eta_prime3 = <a class="code" href="namespaceproteus.html#a9db7dbbd169fd6f6b5a8d999bcdf9db1">DENTROPY_DHV</a>(g, hi, hui, hvi, 0., one_over_hiReg);</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        global_entropy_residual[i] =</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;            one_over_entNormFactori *</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;            fabs(entropy_flux -</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                 (ith_flux_term1 * eta_prime1 + ith_flux_term2 * eta_prime2 +</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                  ith_flux_term3 * eta_prime3));</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160; </div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        <span class="comment">// COMPUTE SMOOTHNESS INDICATOR //</span></div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        <span class="keywordflow">if</span> (hi &lt;= hEps) {</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;          alphai = 1.0;</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;          <a class="code" href="_headers_8h.html#acf2aa06bc881a993584c334b2b7c6e03">psi</a>[i] = 1.0;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;          global_entropy_residual[i] = 1E10;</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;          <span class="comment">// Force alphai=0 in constant states</span></div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;          <span class="keywordflow">if</span> (fabs(alpha_numerator) &lt;= hEps) {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;            alphai = 0.;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;            alphai =</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                (fabs(alpha_numerator) - hEps) / fabs(alpha_denominator - hEps);</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;          }</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;          alphai = fmax(alphai - alpha_zero, 0.0) * alpha_factor;</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a3452ab29367216c56ee2ef46257c22be">POWER_SMOOTHNESS_INDICATOR</a> == 0)</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;            <a class="code" href="_headers_8h.html#acf2aa06bc881a993584c334b2b7c6e03">psi</a>[i] = 1.0;</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;            <a class="code" href="_headers_8h.html#acf2aa06bc881a993584c334b2b7c6e03">psi</a>[i] = std::pow(</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                alphai, <a class="code" href="_g_n___s_w2_d_c_v_8h.html#a3452ab29367216c56ee2ef46257c22be">POWER_SMOOTHNESS_INDICATOR</a>); <span class="comment">// NOTE: alpha^4 for mGN</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        }</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;      }</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;      <span class="comment">// ********** END OF 2nd LOOP ON DOFS ********** //</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160; </div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;      <span class="comment">// ********** MAIN LOOP ON DOFs **********</span></div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      <span class="comment">// To compute:</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;      <span class="comment">//      * dissipative terms</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      <span class="comment">//      * bar states</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      ij = 0;</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numDOFsPerEqn; i++) {</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160; </div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        <span class="keywordtype">double</span> hi = h_dof_old[i];</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;        <span class="keywordtype">double</span> hui = hu_dof_old[i];</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        <span class="keywordtype">double</span> hvi = hv_dof_old[i];</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        <span class="keywordtype">double</span> hetai = heta_dof_old[i];</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;        <span class="keywordtype">double</span> hwi = hw_dof_old[i];</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;        <span class="keywordtype">double</span> Zi = b_dof[i];</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;        <span class="keywordtype">double</span> mi = lumped_mass_matrix[i];</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160; </div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        <span class="keywordtype">double</span> one_over_hiReg =</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;            2 * hi / (hi * hi + std::pow(fmax(hi, hEps), 2));</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        <span class="keywordtype">double</span> ui = hui * one_over_hiReg;</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;        <span class="keywordtype">double</span> vi = hvi * one_over_hiReg;</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        <span class="keywordtype">double</span> etai = hetai * one_over_hiReg;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        <span class="keywordtype">double</span> meshSizei = std::sqrt(mi); <span class="comment">// local mesh size in 2d</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160; </div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;        <span class="comment">// We define pTilde at ith node here</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        <span class="keywordtype">double</span> diff_over_h_i = (hetai - hi * hi) * one_over_hiReg;</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        <span class="keywordtype">double</span> pTildei = -(<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> * g / (3.0 * meshSizei)) * 6.0 * hi *</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;                         (hetai - hi * hi);</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160; </div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a10b9177dd08eb7e17dd16dba2a85fc3a">IF_BOTH_GAMMA_BRANCHES</a>) {</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;          <span class="keywordflow">if</span> (hetai &gt; std::pow(hi, 2.0)) {</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;            pTildei = -(<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> * g / (3.0 * meshSizei)) * 2.0 *</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;                      diff_over_h_i * (etai * etai + etai * hi + hi * hi);</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;          }</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;        }</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160; </div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;        <span class="comment">// Define full pressure at ith node for definition of bar states below</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="keywordtype">double</span> pressure_i = 0.5 * g * hi * hi + pTildei;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160; </div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        <span class="comment">// HIGH ORDER DISSIPATIVE TERMS, for Aij matrix</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        <span class="keywordtype">double</span> ith_dHij_minus_muHij_times_hStarStates = 0.,</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;               ith_dHij_minus_muHij_times_huStarStates = 0.,</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;               ith_dHij_minus_muHij_times_hvStarStates = 0.,</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;               ith_dHij_minus_muHij_times_hetaStarStates = 0.,</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;               ith_dHij_minus_muHij_times_hwStarStates = 0.,</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;               ith_muHij_times_hStates = 0., ith_muHij_times_huStates = 0.,</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;               ith_muHij_times_hvStates = 0., ith_muHij_times_hetaStates = 0.,</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;               ith_muHij_times_hwStates = 0.;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160; </div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        <span class="comment">// loop over the sparsity pattern of the i-th DOF</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> offset = csrRowIndeces_DofLoops[i];</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;             offset &lt; csrRowIndeces_DofLoops[i + 1]; offset++) {</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160; </div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;          <span class="keywordtype">int</span> j = csrColumnOffsets_DofLoops[offset];</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160; </div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;          <span class="keywordtype">double</span> hj = h_dof_old[j];</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;          <span class="keywordtype">double</span> huj = hu_dof_old[j];</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;          <span class="keywordtype">double</span> hvj = hv_dof_old[j];</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;          <span class="keywordtype">double</span> hetaj = heta_dof_old[j];</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;          <span class="keywordtype">double</span> hwj = hw_dof_old[j];</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;          <span class="keywordtype">double</span> Zj = b_dof[j];</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160; </div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;          <span class="keywordtype">double</span> one_over_hjReg =</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;              2.0 * hj / (hj * hj + std::pow(fmax(hj, hEps), 2));</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;          <span class="keywordtype">double</span> uj = huj * one_over_hjReg;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;          <span class="keywordtype">double</span> vj = hvj * one_over_hjReg;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;          <span class="keywordtype">double</span> etaj = hetaj * one_over_hjReg;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;          <span class="keywordtype">double</span> mj = lumped_mass_matrix[j];</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;          <span class="keywordtype">double</span> meshSizej = std::sqrt(mj); <span class="comment">// local mesh size in 2d</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160; </div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;          <span class="comment">// Here we define pTilde at jth node</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;          <span class="keywordtype">double</span> diff_over_h_j = (hetaj - hj * hj) * one_over_hjReg;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;          <span class="keywordtype">double</span> pTildej = -(<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> * g / (3.0 * meshSizej)) * 6.0 * hj *</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                           (hetaj - hj * hj);</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160; </div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a10b9177dd08eb7e17dd16dba2a85fc3a">IF_BOTH_GAMMA_BRANCHES</a>) {</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;            <span class="keywordflow">if</span> (hetaj &gt; std::pow(hj, 2.0)) {</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;              pTildej = -(<a class="code" href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a> * g / (3.0 * meshSizej)) * 2.0 *</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                        diff_over_h_j * (etaj * etaj + etaj * hj + hj * hj);</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;            }</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;          }</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160; </div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;          <span class="comment">// define pressure at jth node</span></div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;          <span class="keywordtype">double</span> pressure_j = 0.5 * g * hj * hj + pTildej;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160; </div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;          <span class="comment">// COMPUTE STAR SOLUTION // hStar, huStar, hvStar, hetaStar, hwStar</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;          <span class="keywordtype">double</span> hStarij = fmax(0., hi + Zi - fmax(Zi, Zj));</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;          <span class="keywordtype">double</span> huStarij = hui * hStarij * one_over_hiReg;</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;          <span class="keywordtype">double</span> hvStarij = hvi * hStarij * one_over_hiReg;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;          <span class="keywordtype">double</span> hetaStarij = hetai * std::pow(hStarij * one_over_hiReg, 2);</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;          <span class="keywordtype">double</span> hwStarij = hwi * std::pow(hStarij * one_over_hiReg, 2);</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160; </div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;          <span class="keywordtype">double</span> hStarji = fmax(0., hj + Zj - fmax(Zi, Zj));</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;          <span class="keywordtype">double</span> huStarji = huj * hStarji * one_over_hjReg;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;          <span class="keywordtype">double</span> hvStarji = hvj * hStarji * one_over_hjReg;</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;          <span class="keywordtype">double</span> hetaStarji = hetaj * std::pow(hStarji * one_over_hjReg, 2);</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;          <span class="keywordtype">double</span> hwStarji = hwj * std::pow(hStarji * one_over_hjReg, 2);</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160; </div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;          <span class="comment">// Dissipative well balancing term</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;          <span class="keywordtype">double</span> muLowij = 0., muLij = 0., muHij = 0.;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;          <span class="keywordtype">double</span> dLowij = 0., dLij = 0., dHij = 0.;</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;          <span class="keywordflow">if</span> (i != j) <span class="comment">// This is not necessary. See formula for</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                      <span class="comment">// ith_dissipative_terms</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;          {</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;            <span class="comment">// DISSIPATIVE MATRIX //</span></div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="comment"></span>            <span class="keywordflow">if</span> (lstage == 0)</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;              dLowij = dLow[ij];</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;              <span class="keywordtype">double</span> cij_norm = sqrt(Cx[ij] * Cx[ij] + Cy[ij] * Cy[ij]);</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;              <span class="keywordtype">double</span> cji_norm = sqrt(CTx[ij] * CTx[ij] + CTy[ij] * CTy[ij]);</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;              <span class="keywordtype">double</span> nxij = Cx[ij] / cij_norm, nyij = Cy[ij] / cij_norm;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;              <span class="keywordtype">double</span> nxji = CTx[ij] / cji_norm, nyji = CTy[ij] / cji_norm;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;              dLowij = fmax(<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a6cf917d2db4b144bf075f553cbdfa4b0">maxWaveSpeedSharpInitialGuess</a>(</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;                                g, nxij, nyij, hi, hui, hvi, hetai, mi, hj, huj,</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;                                hvj, hetaj, mj, hEps, hEps, <span class="keyword">false</span>) *</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                                cij_norm,</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                            <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a6cf917d2db4b144bf075f553cbdfa4b0">maxWaveSpeedSharpInitialGuess</a>(</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                                g, nxji, nyji, hj, huj, hvj, hetaj, mj, hi, hui,</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                                hvi, hetai, mi, hEps, hEps, <span class="keyword">false</span>) *</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;                                cji_norm);</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;            }</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160; </div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;            <span class="comment">// WELL BALANCING DISSIPATIVE MATRIX //</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="comment"></span>            muLowij = fmax(fmax(0., -(ui * Cx[ij] + vi * Cy[ij])),</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                           fmax(0., (uj * Cx[ij] + vj * Cy[ij])));</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160; </div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;            <span class="comment">// Define dLij as low order dijs</span></div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;            muLij = muLowij;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;            dLij = fmax(dLowij, muLij);</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160; </div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;            <span class="comment">// Then save dLow for limiting step, maybe a bit confusing</span></div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;            dLow[ij] = fmax(dLij, muLij);</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160; </div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;            <span class="comment">// COMPUTE BAR STATES //</span></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;<span class="comment"></span>            <span class="keywordtype">double</span> hBar_ij = 0, hTilde_ij = 0, huBar_ij = 0, huTilde_ij = 0,</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                   hvBar_ij = 0, hvTilde_ij = 0, hetaBar_ij = 0,</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                   hetaTilde_ij = 0, hwBar_ij = 0, hwTilde_ij = 0;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160; </div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;            <span class="keywordflow">if</span> (dLij != 0) {</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;              <span class="comment">// h component</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;              hBar_ij = -1. / (2 * dLij) *</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                            ((uj * hj - ui * hi) * Cx[ij] +</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                             (vj * hj - vi * hi) * Cy[ij]) +</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;                        0.5 * (hj + hi);</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;              hTilde_ij = (dLij - muLij) / (2 * dLij) *</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                          ((hStarji - hj) - (hStarij - hi));</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;              <span class="comment">// hu component</span></div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;              huBar_ij = -1. / (2 * dLij) *</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                             ((uj * huj - ui * hui + pressure_j - pressure_i) *</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                                  Cx[ij] +</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                              (vj * huj - vi * hui) * Cy[ij]) +</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                         0.5 * (huj + hui);</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;              huTilde_ij = (dLij - muLij) / (2 * dLij) *</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                           ((huStarji - huj) - (huStarij - hui));</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;              <span class="comment">// hv component</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;              hvBar_ij = -1. / (2 * dLij) *</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;                             ((uj * hvj - ui * hvi) * Cx[ij] +</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;                              (vj * hvj - vi * hvi + pressure_j - pressure_i) *</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;                                  Cy[ij]) +</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;                         0.5 * (hvj + hvi);</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;              hvTilde_ij = (dLij - muLij) / (2 * dLij) *</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;                           ((hvStarji - hvj) - (hvStarij - hvi));</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;              <span class="comment">// heta component</span></div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;              hetaBar_ij = -1. / (2 * dLij) *</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;                               ((uj * hetaj - ui * hetai) * Cx[ij] +</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                                (vj * hetaj - vi * hetai) * Cy[ij]) +</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;                           0.5 * (hetaj + hetai);</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;              hetaTilde_ij = (dLij - muLij) / (2 * dLij) *</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;                             ((hetaStarji - hetaj) - (hetaStarij - hetai));</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;              <span class="comment">// hw component</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;              hwBar_ij = -1. / (2 * dLij) *</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                             ((uj * hwj - ui * hwi) * Cx[ij] +</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;                              (vj * hwj - vi * hwi) * Cy[ij]) +</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                         0.5 * (hwj + hwi);</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;              hwTilde_ij = (dLij - muLij) / (2 * dLij) *</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                           ((hwStarji - hwj) - (hwStarij - hwi));</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;            }</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;            <span class="comment">// Here we define uBar + uTilde</span></div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;            hBT[ij] = hBar_ij + hTilde_ij;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;            huBT[ij] = huBar_ij + huTilde_ij;</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;            hvBT[ij] = hvBar_ij + hvTilde_ij;</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;            hetaBT[ij] = hetaBar_ij + hetaTilde_ij;</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;            hwBT[ij] = hwBar_ij + hwTilde_ij;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160; </div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;            <span class="comment">// ENTROPY VISCOSITY //</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;<span class="comment"></span>            <span class="keywordtype">double</span> dEVij = <a class="code" href="_n_c_l_s3_p_8h.html#ac3a8009eac7340083df50a7d681f77bc">cE</a> * fmax(global_entropy_residual[i],</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                                     global_entropy_residual[j]);</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;            dHij = fmin(dLowij, dEVij);</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;            muHij = fmin(muLowij, dEVij);</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160; </div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;            <span class="comment">// Assume no EV for now and just use the alpha limiting for</span></div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;            <span class="comment">// higher order method. -EJT</span></div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;            <span class="comment">// dHij = fmax(psi[i], psi[j]) * dLij;</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;            <span class="comment">// muHij = fmax(psi[i], psi[j]) * muLij;</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160; </div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;            <span class="comment">// compute dij_minus_muij times star solution terms</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;            <span class="comment">// see: eqn (6.13)</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;            ith_dHij_minus_muHij_times_hStarStates +=</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                (dHij - muHij) * (hStarji - hStarij);</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;            ith_dHij_minus_muHij_times_huStarStates +=</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                (dHij - muHij) * (huStarji - huStarij);</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;            ith_dHij_minus_muHij_times_hvStarStates +=</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                (dHij - muHij) * (hvStarji - hvStarij);</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;            ith_dHij_minus_muHij_times_hetaStarStates +=</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                (dHij - muHij) * (hetaStarji - hetaStarij);</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;            ith_dHij_minus_muHij_times_hwStarStates +=</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                (dHij - muHij) * (hwStarji - hwStarij);</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160; </div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;            <span class="comment">// compute muij times solution terms</span></div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;            ith_muHij_times_hStates += muHij * (hj - hi);</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;            ith_muHij_times_huStates += muHij * (huj - hui);</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;            ith_muHij_times_hvStates += muHij * (hvj - hvi);</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;            ith_muHij_times_hetaStates += muHij * (hetaj - hetai);</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;            ith_muHij_times_hwStates += muHij * (hwj - hwi);</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160; </div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;            <span class="comment">// compute dH_minus_dL</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;            dH_minus_dL[ij] = dHij - dLij;</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;            muH_minus_muL[ij] = muHij - muLij;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;          } <span class="keywordflow">else</span> <span class="comment">// i==j</span></div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;          {</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;            dH_minus_dL[ij] = 0.;   <span class="comment">// Not true but the prod of this times</span></div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                                    <span class="comment">// Uj-Ui will be zero</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;            muH_minus_muL[ij] = 0.; <span class="comment">// Not true but the prod of this times</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                                    <span class="comment">// Uj-Ui will be zero</span></div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;          }</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160; </div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;          <span class="comment">// update ij</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;          ij += 1;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160; </div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        } <span class="comment">/*j loop ends here*/</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160; </div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        <span class="comment">/* Define global residual */</span></div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        <span class="keywordflow">if</span> (LUMPED_MASS_MATRIX == 1) {</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;          globalResidual[offset_h + stride_h * i] =</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;              hi - dt / mi *</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                       (hyp_flux_h[i] - ith_dHij_minus_muHij_times_hStarStates -</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                        ith_muHij_times_hStates);</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;          globalResidual[offset_hu + stride_hu * i] =</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;              hui - dt / mi *</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                        ((hyp_flux_hu[i] + extendedSourceTerm_hu[i]) -</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                         ith_dHij_minus_muHij_times_huStarStates -</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                         ith_muHij_times_huStates);</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;          globalResidual[offset_hv + stride_hv * i] =</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;              hvi - dt / mi *</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                        ((hyp_flux_hv[i] + extendedSourceTerm_hv[i]) -</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                         ith_dHij_minus_muHij_times_hvStarStates -</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                         ith_muHij_times_hvStates);</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;          globalResidual[offset_heta + stride_heta * i] =</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;              hetai - dt / mi *</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                          ((hyp_flux_heta[i] + extendedSourceTerm_heta[i]) -</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                           ith_dHij_minus_muHij_times_hetaStarStates -</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                           ith_muHij_times_hetaStates);</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;          globalResidual[offset_hw + stride_hw * i] =</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;              hwi - dt / mi *</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;                        ((hyp_flux_hw[i] + extendedSourceTerm_hw[i]) -</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                         ith_dHij_minus_muHij_times_hwStarStates -</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;                         ith_muHij_times_hwStates);</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160; </div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;          <span class="comment">// clean up potential negative water height due to machine</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;          <span class="comment">// precision</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;          <span class="comment">// if (globalResidual[offset_h + stride_h * i] &gt;= -hEps &amp;&amp;</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;          <span class="comment">//     globalResidual[offset_h + stride_h * i] &lt; hEps) {</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;          <span class="comment">//   globalResidual[offset_h + stride_h * i] = 0.0;</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;          <span class="comment">//   globalResidual[offset_heta + stride_heta * i] = 0.0;</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;          <span class="comment">// }</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160; </div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;          <span class="comment">// Distribute residual</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;          <span class="comment">// NOTE: MASS MATRIX IS CONSISTENT</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;          globalResidual[offset_h + stride_h * i] +=</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;              dt * (hyp_flux_h[i] - ith_dHij_minus_muHij_times_hStarStates -</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                    ith_muHij_times_hStates);</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;          globalResidual[offset_hu + stride_hu * i] +=</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;              dt * (hyp_flux_hu[i] + extendedSourceTerm_hu[i] -</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;                    ith_dHij_minus_muHij_times_huStarStates -</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                    ith_muHij_times_huStates);</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;          globalResidual[offset_hv + stride_hv * i] +=</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;              dt * (hyp_flux_hv[i] + extendedSourceTerm_hv[i] -</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;                    ith_dHij_minus_muHij_times_hvStarStates -</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                    ith_muHij_times_hvStates);</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;          globalResidual[offset_heta + stride_heta * i] +=</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;              dt * (hyp_flux_heta[i] + extendedSourceTerm_heta[i] -</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                    ith_dHij_minus_muHij_times_hetaStarStates -</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                    ith_muHij_times_hetaStates);</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;          globalResidual[offset_hw + stride_hw * i] +=</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;              dt * (hyp_flux_hw[i] + extendedSourceTerm_hw[i] -</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                    ith_dHij_minus_muHij_times_hwStarStates -</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;                    ith_muHij_times_hwStates);</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        }</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;      }</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      <span class="comment">// ********** END OF LOOP IN DOFs ********** //</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    }</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160; </div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    <span class="comment">// ********** COMPUTE NORMALS ********** //</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    <span class="keywordflow">if</span> (COMPUTE_NORMALS == 1) {</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;      <span class="comment">// This is to identify the normals and create a vector of normal</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;      <span class="comment">// components</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ebNE = 0; ebNE &lt; nExteriorElementBoundaries_global; ebNE++) {</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        <span class="keyword">register</span> <span class="keywordtype">int</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;            ebN = exteriorElementBoundariesArray[ebNE],</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;            eN = elementBoundaryElementsArray[ebN * 2 + 0],</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;            ebN_local = elementBoundaryLocalElementBoundariesArray[ebN * 2 + 0];</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;        <span class="keyword">register</span> <span class="keywordtype">double</span> normal[3];</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;        {             <span class="comment">// &quot;Loop&quot; in quad points</span></div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;          <span class="keywordtype">int</span> kb = 0; <span class="comment">// NOTE: I need to consider just one quad point since</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                      <span class="comment">// the element is not curved so the normal is constant</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                      <span class="comment">// per element</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;          <span class="keyword">register</span> <span class="keywordtype">int</span> ebN_local_kb =</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;              ebN_local * nQuadraturePoints_elementBoundary + kb;</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;          <span class="keyword">register</span> <span class="keywordtype">double</span> jac_ext[nSpace * nSpace], jacDet_ext,</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;              jacInv_ext[nSpace * nSpace], boundaryJac[nSpace * (nSpace - 1)],</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;              metricTensor[(nSpace - 1) * (nSpace - 1)], metricTensorDetSqrt,</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;              x_ext, y_ext;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;          <span class="comment">/* compute information about mapping from reference element to</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="comment">           * physical element */</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;          <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.calculateMapping_elementBoundary(</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;              eN, ebN_local, kb, ebN_local_kb, mesh_dof, mesh_l2g,</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;              mesh_trial_trace_ref, mesh_grad_trial_trace_ref, boundaryJac_ref,</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;              jac_ext, jacDet_ext, jacInv_ext, boundaryJac, metricTensor,</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;              metricTensorDetSqrt, normal_ref, normal, x_ext, y_ext);</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;        }</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;        <span class="comment">// distribute the normal vectors</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDOF_test_element; i++) {</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;          <span class="keywordtype">int</span> eN_i = eN * nDOF_test_element + i;</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;          <span class="keywordtype">int</span> gi = h_l2g[eN_i];</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;          normalx[gi] += 0.5 * normal[0] * (i == ebN_local ? 0. : 1.);</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;          normaly[gi] += 0.5 * normal[1] * (i == ebN_local ? 0. : 1.);</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;        }</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;      }</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;      <span class="comment">// normalize</span></div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> gi = 0; gi &lt; numDOFsPerEqn; gi++) {</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;        <span class="keywordtype">double</span> norm_factor =</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;            sqrt(std::pow(normalx[gi], 2) + std::pow(normaly[gi], 2));</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;        <span class="keywordflow">if</span> (norm_factor != 0) {</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;          normalx[gi] /= norm_factor;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;          normaly[gi] /= norm_factor;</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;        }</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      }</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    }</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    <span class="comment">// ********** END OF COMPUTING NORMALS ********** //</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  } <span class="comment">// namespace proteus</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160; </div>
<div class="line"><a name="l02376"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a0c51babf87fb6d6c3d6572191440eed4"> 2376</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a0c51babf87fb6d6c3d6572191440eed4">calculateMassMatrix</a>( <span class="comment">// element</span></div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_ref, <span class="keywordtype">double</span> *mesh_grad_trial_ref, <span class="keywordtype">double</span> *mesh_dof,</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      <span class="keywordtype">double</span> *mesh_velocity_dof, <span class="keywordtype">double</span> MOVING_DOMAIN, <span class="keywordtype">int</span> *mesh_l2g,</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;      <span class="keywordtype">double</span> *dV_ref, <span class="keywordtype">double</span> *h_trial_ref, <span class="keywordtype">double</span> *h_grad_trial_ref,</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;      <span class="keywordtype">double</span> *h_test_ref, <span class="keywordtype">double</span> *h_grad_test_ref, <span class="keywordtype">double</span> *vel_trial_ref,</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;      <span class="keywordtype">double</span> *vel_grad_trial_ref, <span class="keywordtype">double</span> *vel_test_ref,</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;      <span class="keywordtype">double</span> *vel_grad_test_ref,</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;      <span class="comment">// element boundary</span></div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_trace_ref, <span class="keywordtype">double</span> *mesh_grad_trial_trace_ref,</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;      <span class="keywordtype">double</span> *dS_ref, <span class="keywordtype">double</span> *h_trial_trace_ref, <span class="keywordtype">double</span> *h_grad_trial_trace_ref,</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;      <span class="keywordtype">double</span> *h_test_trace_ref, <span class="keywordtype">double</span> *h_grad_test_trace_ref,</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;      <span class="keywordtype">double</span> *vel_trial_trace_ref, <span class="keywordtype">double</span> *vel_grad_trial_trace_ref,</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;      <span class="keywordtype">double</span> *vel_test_trace_ref, <span class="keywordtype">double</span> *vel_grad_test_trace_ref,</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;      <span class="keywordtype">double</span> *normal_ref, <span class="keywordtype">double</span> *boundaryJac_ref,</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      <span class="comment">// physics</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;      <span class="keywordtype">double</span> *elementDiameter, <span class="keywordtype">int</span> nElements_global, <span class="keywordtype">double</span> useRBLES,</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;      <span class="keywordtype">double</span> useMetrics, <span class="keywordtype">double</span> alphaBDF, <span class="keywordtype">double</span> nu, <span class="keywordtype">double</span> g, <span class="keywordtype">int</span> *h_l2g,</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;      <span class="keywordtype">int</span> *vel_l2g, <span class="keywordtype">double</span> *b_dof, <span class="keywordtype">double</span> *h_dof, <span class="keywordtype">double</span> *hu_dof,</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;      <span class="keywordtype">double</span> *hv_dof, <span class="keywordtype">double</span> *heta_dof, <span class="keywordtype">double</span> *hw_dof, <span class="keywordtype">double</span> *h_dof_sge,</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      <span class="keywordtype">double</span> *hu_dof_sge, <span class="keywordtype">double</span> *hv_dof_sge, <span class="keywordtype">double</span> *heta_dof_sge,</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      <span class="keywordtype">double</span> *hw_dof_sge, <span class="keywordtype">double</span> *q_mass_acc_beta_bdf,</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;      <span class="keywordtype">double</span> *q_mom_hu_acc_beta_bdf, <span class="keywordtype">double</span> *q_mom_hv_acc_beta_bdf,</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      <span class="keywordtype">double</span> *q_cfl, <span class="keywordtype">int</span> *sdInfo_hu_hu_rowptr, <span class="keywordtype">int</span> *sdInfo_hu_hu_colind,</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hu_hv_rowptr, <span class="keywordtype">int</span> *sdInfo_hu_hv_colind,</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hv_rowptr, <span class="keywordtype">int</span> *sdInfo_hv_hv_colind,</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hu_rowptr, <span class="keywordtype">int</span> *sdInfo_hv_hu_colind,</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;      <span class="comment">// h</span></div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_h, <span class="keywordtype">int</span> *csrColumnOffsets_h_h,</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hu, <span class="keywordtype">int</span> *csrColumnOffsets_h_hu,</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hv, <span class="keywordtype">int</span> *csrColumnOffsets_h_hv,</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_heta, <span class="keywordtype">int</span> *csrColumnOffsets_h_heta,</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hw, <span class="keywordtype">int</span> *csrColumnOffsets_h_hw,</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;      <span class="comment">// hu</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_h, <span class="keywordtype">int</span> *csrColumnOffsets_hu_h,</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hu,</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hv,</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hu_heta,</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hw,</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;      <span class="comment">// hv</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_h, <span class="keywordtype">int</span> *csrColumnOffsets_hv_h,</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hu,</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hv,</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hv_heta,</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hw,</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      <span class="comment">// heta</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_h, <span class="keywordtype">int</span> *csrColumnOffsets_heta_h,</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hu, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hu,</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hv, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hv,</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_heta, <span class="keywordtype">int</span> *csrColumnOffsets_heta_heta,</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hw, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hw,</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;      <span class="comment">// hw</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_h, <span class="keywordtype">int</span> *csrColumnOffsets_hw_h,</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hu,</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hv,</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hw_heta,</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hw,</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      <span class="keywordtype">double</span> *globalJacobian, <span class="keywordtype">int</span> nExteriorElementBoundaries_global,</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      <span class="keywordtype">int</span> *exteriorElementBoundariesArray, <span class="keywordtype">int</span> *elementBoundaryElementsArray,</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;      <span class="keywordtype">int</span> *elementBoundaryLocalElementBoundariesArray, <span class="keywordtype">int</span> *isDOFBoundary_h,</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;      <span class="keywordtype">int</span> *isDOFBoundary_hu, <span class="keywordtype">int</span> *isDOFBoundary_hv,</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_h, <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hu,</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hv, <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hu,</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;      <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hv, <span class="keywordtype">double</span> *ebqe_bc_h_ext,</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mass_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hu_adv_ext,</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hv_adv_ext, <span class="keywordtype">double</span> *ebqe_bc_hu_ext,</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_hu_diff_ext, <span class="keywordtype">double</span> *ebqe_penalty_ext,</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_hv_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_hv_diff_ext,</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_h, <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_hu,</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_hv, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_h,</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_hu, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_hv,</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_h, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_hu,</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_hv, <span class="keywordtype">double</span> dt) {</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;    <span class="comment">// loop over elements to compute volume integrals and load them into the</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    <span class="comment">// element Jacobians and global Jacobian</span></div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> eN = 0; eN &lt; nElements_global; eN++) {</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      <span class="keyword">register</span> <span class="keywordtype">double</span> elementJacobian_h_h[nDOF_test_element]</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                                         [nDOF_trial_element],</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;          elementJacobian_hu_hu[nDOF_test_element][nDOF_trial_element],</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;          elementJacobian_hv_hv[nDOF_test_element][nDOF_trial_element],</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;          elementJacobian_heta_heta[nDOF_test_element][nDOF_trial_element],</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;          elementJacobian_hw_hw[nDOF_test_element][nDOF_trial_element];</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDOF_test_element; i++)</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nDOF_trial_element; j++) {</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;          elementJacobian_h_h[i][j] = 0.0;</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;          elementJacobian_hu_hu[i][j] = 0.0;</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;          elementJacobian_hv_hv[i][j] = 0.0;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;          elementJacobian_heta_heta[i][j] = 0.0;</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;          elementJacobian_hw_hw[i][j] = 0.0;</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;        }</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; nQuadraturePoints_element; k++) {</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;        <span class="keywordtype">int</span> eN_k = eN * nQuadraturePoints_element +</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                   k, <span class="comment">// index to a scalar at a quadrature point</span></div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;            eN_k_nSpace = eN_k * nSpace,</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;            eN_nDOF_trial_element =</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                eN * nDOF_trial_element; <span class="comment">// index to a vector at a</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;                                         <span class="comment">// quadrature point</span></div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160; </div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        <span class="comment">// declare local storage</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        <span class="keyword">register</span> <span class="keywordtype">double</span> jac[nSpace * nSpace], jacDet, jacInv[nSpace * nSpace],</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;            dV, h_test_dV[nDOF_test_element], vel_test_dV[nDOF_test_element], x,</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;            y, xt, yt;</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;        <span class="comment">// get jacobian, etc for mapping reference element</span></div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.calculateMapping_element(eN, k, mesh_dof, mesh_l2g, mesh_trial_ref,</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                                    mesh_grad_trial_ref, jac, jacDet, jacInv, x,</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                                    y);</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        <span class="comment">// get the physical integration weight</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;        dV = fabs(jacDet) * dV_ref[k];</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;        <span class="comment">// precalculate test function products with integration weights</span></div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nDOF_trial_element; j++) {</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;          h_test_dV[j] = h_test_ref[k * nDOF_trial_element + j] * dV;</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;          vel_test_dV[j] = vel_test_ref[k * nDOF_trial_element + j] * dV;</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;        }</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDOF_test_element; i++) {</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;          <span class="keyword">register</span> <span class="keywordtype">int</span> i_nSpace = i * nSpace;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nDOF_trial_element; j++) {</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;            <span class="keyword">register</span> <span class="keywordtype">int</span> j_nSpace = j * nSpace;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;            elementJacobian_h_h[i][j] +=</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                h_trial_ref[k * nDOF_trial_element + j] * h_test_dV[i];</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;            elementJacobian_hu_hu[i][j] +=</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                vel_trial_ref[k * nDOF_trial_element + j] * vel_test_dV[i];</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;            elementJacobian_hv_hv[i][j] +=</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                vel_trial_ref[k * nDOF_trial_element + j] * vel_test_dV[i];</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;            elementJacobian_heta_heta[i][j] +=</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;                vel_trial_ref[k * nDOF_trial_element + j] * vel_test_dV[i];</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;            elementJacobian_hw_hw[i][j] +=</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;                vel_trial_ref[k * nDOF_trial_element + j] * vel_test_dV[i];</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;          } <span class="comment">// j</span></div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;        }   <span class="comment">// i</span></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;      }     <span class="comment">// k</span></div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;      <span class="comment">// load into element Jacobian into global Jacobian</span></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDOF_test_element; i++) {</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;        <span class="keyword">register</span> <span class="keywordtype">int</span> eN_i = eN * nDOF_test_element + i;</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nDOF_trial_element; j++) {</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;          <span class="keyword">register</span> <span class="keywordtype">int</span> eN_i_j = eN_i * nDOF_trial_element + j;</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;          globalJacobian[csrRowIndeces_h_h[eN_i] +</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                         csrColumnOffsets_h_h[eN_i_j]] +=</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;              elementJacobian_h_h[i][j];</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;          globalJacobian[csrRowIndeces_hu_hu[eN_i] +</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;                         csrColumnOffsets_hu_hu[eN_i_j]] +=</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;              elementJacobian_hu_hu[i][j];</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;          globalJacobian[csrRowIndeces_hv_hv[eN_i] +</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                         csrColumnOffsets_hv_hv[eN_i_j]] +=</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;              elementJacobian_hv_hv[i][j];</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;          globalJacobian[csrRowIndeces_heta_heta[eN_i] +</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;                         csrColumnOffsets_heta_heta[eN_i_j]] +=</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;              elementJacobian_heta_heta[i][j];</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;          globalJacobian[csrRowIndeces_hw_hw[eN_i] +</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;                         csrColumnOffsets_hw_hw[eN_i_j]] +=</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;              elementJacobian_hw_hw[i][j];</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        } <span class="comment">// j</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      }   <span class="comment">// i</span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;    }     <span class="comment">// elements</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;  }</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160; </div>
<div class="line"><a name="l02535"></a><span class="lineno"><a class="line" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a9a5b6f98c97dc946c45efb8e1bd4f7d3"> 2535</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#a9a5b6f98c97dc946c45efb8e1bd4f7d3">calculateLumpedMassMatrix</a>( <span class="comment">// element</span></div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_ref, <span class="keywordtype">double</span> *mesh_grad_trial_ref, <span class="keywordtype">double</span> *mesh_dof,</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;      <span class="keywordtype">double</span> *mesh_velocity_dof, <span class="keywordtype">double</span> MOVING_DOMAIN, <span class="keywordtype">int</span> *mesh_l2g,</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;      <span class="keywordtype">double</span> *dV_ref, <span class="keywordtype">double</span> *h_trial_ref, <span class="keywordtype">double</span> *h_grad_trial_ref,</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      <span class="keywordtype">double</span> *h_test_ref, <span class="keywordtype">double</span> *h_grad_test_ref, <span class="keywordtype">double</span> *vel_trial_ref,</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;      <span class="keywordtype">double</span> *vel_grad_trial_ref, <span class="keywordtype">double</span> *vel_test_ref,</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;      <span class="keywordtype">double</span> *vel_grad_test_ref,</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;      <span class="comment">// element boundary</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;      <span class="keywordtype">double</span> *mesh_trial_trace_ref, <span class="keywordtype">double</span> *mesh_grad_trial_trace_ref,</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;      <span class="keywordtype">double</span> *dS_ref, <span class="keywordtype">double</span> *h_trial_trace_ref, <span class="keywordtype">double</span> *h_grad_trial_trace_ref,</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      <span class="keywordtype">double</span> *h_test_trace_ref, <span class="keywordtype">double</span> *h_grad_test_trace_ref,</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;      <span class="keywordtype">double</span> *vel_trial_trace_ref, <span class="keywordtype">double</span> *vel_grad_trial_trace_ref,</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;      <span class="keywordtype">double</span> *vel_test_trace_ref, <span class="keywordtype">double</span> *vel_grad_test_trace_ref,</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;      <span class="keywordtype">double</span> *normal_ref, <span class="keywordtype">double</span> *boundaryJac_ref,</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      <span class="comment">// physics</span></div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      <span class="keywordtype">double</span> *elementDiameter, <span class="keywordtype">int</span> nElements_global, <span class="keywordtype">double</span> useRBLES,</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;      <span class="keywordtype">double</span> useMetrics, <span class="keywordtype">double</span> alphaBDF, <span class="keywordtype">double</span> nu, <span class="keywordtype">double</span> g, <span class="keywordtype">int</span> *h_l2g,</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;      <span class="keywordtype">int</span> *vel_l2g, <span class="keywordtype">double</span> *b_dof, <span class="keywordtype">double</span> *h_dof, <span class="keywordtype">double</span> *hu_dof,</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;      <span class="keywordtype">double</span> *hv_dof, <span class="keywordtype">double</span> *h_dof_sge, <span class="keywordtype">double</span> *hu_dof_sge, <span class="keywordtype">double</span> *hv_dof_sge,</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;      <span class="keywordtype">double</span> *q_mass_acc_beta_bdf, <span class="keywordtype">double</span> *q_mom_hu_acc_beta_bdf,</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      <span class="keywordtype">double</span> *q_mom_hv_acc_beta_bdf, <span class="keywordtype">double</span> *q_cfl, <span class="keywordtype">int</span> *sdInfo_hu_hu_rowptr,</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hu_hu_colind, <span class="keywordtype">int</span> *sdInfo_hu_hv_rowptr,</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hu_hv_colind, <span class="keywordtype">int</span> *sdInfo_hv_hv_rowptr,</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hv_colind, <span class="keywordtype">int</span> *sdInfo_hv_hu_rowptr,</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;      <span class="keywordtype">int</span> *sdInfo_hv_hu_colind,</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;      <span class="comment">// h</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_h, <span class="keywordtype">int</span> *csrColumnOffsets_h_h,</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hu, <span class="keywordtype">int</span> *csrColumnOffsets_h_hu,</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hv, <span class="keywordtype">int</span> *csrColumnOffsets_h_hv,</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_heta, <span class="keywordtype">int</span> *csrColumnOffsets_h_heta,</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_h_hw, <span class="keywordtype">int</span> *csrColumnOffsets_h_hw,</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;      <span class="comment">// hu</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_h, <span class="keywordtype">int</span> *csrColumnOffsets_hu_h,</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hu,</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hv,</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hu_heta,</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hu_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hu_hw,</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;      <span class="comment">// hv</span></div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_h, <span class="keywordtype">int</span> *csrColumnOffsets_hv_h,</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hu,</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hv,</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hv_heta,</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hv_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hv_hw,</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;      <span class="comment">// heta</span></div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_h, <span class="keywordtype">int</span> *csrColumnOffsets_heta_h,</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hu, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hu,</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hv, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hv,</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_heta, <span class="keywordtype">int</span> *csrColumnOffsets_heta_heta,</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_heta_hw, <span class="keywordtype">int</span> *csrColumnOffsets_heta_hw,</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;      <span class="comment">// hw</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_h, <span class="keywordtype">int</span> *csrColumnOffsets_hw_h,</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hu, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hu,</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hv, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hv,</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_heta, <span class="keywordtype">int</span> *csrColumnOffsets_hw_heta,</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;      <span class="keywordtype">int</span> *csrRowIndeces_hw_hw, <span class="keywordtype">int</span> *csrColumnOffsets_hw_hw,</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;      <span class="keywordtype">double</span> *globalJacobian, <span class="keywordtype">int</span> nExteriorElementBoundaries_global,</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;      <span class="keywordtype">int</span> *exteriorElementBoundariesArray, <span class="keywordtype">int</span> *elementBoundaryElementsArray,</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;      <span class="keywordtype">int</span> *elementBoundaryLocalElementBoundariesArray, <span class="keywordtype">int</span> *isDOFBoundary_h,</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;      <span class="keywordtype">int</span> *isDOFBoundary_hu, <span class="keywordtype">int</span> *isDOFBoundary_hv,</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_h, <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hu,</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;      <span class="keywordtype">int</span> *isAdvectiveFluxBoundary_hv, <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hu,</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;      <span class="keywordtype">int</span> *isDiffusiveFluxBoundary_hv, <span class="keywordtype">double</span> *ebqe_bc_h_ext,</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mass_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hu_adv_ext,</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_mom_hv_adv_ext, <span class="keywordtype">double</span> *ebqe_bc_hu_ext,</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_flux_hu_diff_ext, <span class="keywordtype">double</span> *ebqe_penalty_ext,</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;      <span class="keywordtype">double</span> *ebqe_bc_hv_ext, <span class="keywordtype">double</span> *ebqe_bc_flux_hv_diff_ext,</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_h, <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_hu,</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_h_hv, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_h,</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_hu, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hu_hv,</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_h, <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_hu,</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;      <span class="keywordtype">int</span> *csrColumnOffsets_eb_hv_hv, <span class="keywordtype">double</span> dt) {</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;    <span class="comment">// loop over elements to compute volume integrals and load them into the</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    <span class="comment">// element Jacobians and global Jacobian</span></div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> eN = 0; eN &lt; nElements_global; eN++) {</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;      <span class="keyword">register</span> <span class="keywordtype">double</span> elementJacobian_h_h[nDOF_test_element]</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;                                         [nDOF_trial_element],</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;          elementJacobian_hu_hu[nDOF_test_element][nDOF_trial_element],</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;          elementJacobian_hv_hv[nDOF_test_element][nDOF_trial_element],</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;          elementJacobian_heta_heta[nDOF_test_element][nDOF_trial_element],</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;          elementJacobian_hw_hw[nDOF_test_element][nDOF_trial_element];</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDOF_test_element; i++)</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nDOF_trial_element; j++) {</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;          elementJacobian_h_h[i][j] = 0.0;</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;          elementJacobian_hu_hu[i][j] = 0.0;</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;          elementJacobian_hv_hv[i][j] = 0.0;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;          elementJacobian_heta_heta[i][j] = 0.0;</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;          elementJacobian_heta_heta[i][j] = 0.0;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;        }</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; nQuadraturePoints_element; k++) {</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;        <span class="keywordtype">int</span> eN_k = eN * nQuadraturePoints_element +</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;                   k, <span class="comment">// index to a scalar at a quadrature point</span></div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;            eN_k_nSpace = eN_k * nSpace,</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;            eN_nDOF_trial_element =</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;                eN * nDOF_trial_element; <span class="comment">// index to a vector at a</span></div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;                                         <span class="comment">// quadrature point</span></div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160; </div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <span class="comment">// declare local storage</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;        <span class="keyword">register</span> <span class="keywordtype">double</span> jac[nSpace * nSpace], jacDet, jacInv[nSpace * nSpace],</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;            dV, h_test_dV[nDOF_test_element], vel_test_dV[nDOF_test_element], x,</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;            y, xt, yt;</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;        <span class="comment">// get jacobian, etc for mapping reference element</span></div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;        <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">ck</a>.calculateMapping_element(eN, k, mesh_dof, mesh_l2g, mesh_trial_ref,</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                                    mesh_grad_trial_ref, jac, jacDet, jacInv, x,</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                                    y);</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;        <span class="comment">// get the physical integration weight</span></div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;        dV = fabs(jacDet) * dV_ref[k];</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;        <span class="comment">// precalculate test function products with integration weights</span></div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nDOF_trial_element; j++) {</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;          h_test_dV[j] = h_test_ref[k * nDOF_trial_element + j] * dV;</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;          vel_test_dV[j] = vel_test_ref[k * nDOF_trial_element + j] * dV;</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;        }</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160; </div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDOF_test_element; i++) {</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;          <span class="keyword">register</span> <span class="keywordtype">int</span> i_nSpace = i * nSpace;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nDOF_trial_element; j++) {</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;            <span class="keyword">register</span> <span class="keywordtype">int</span> j_nSpace = j * nSpace;</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;            elementJacobian_h_h[i][j] += (i == j ? 1.0 : 0.0) * h_test_dV[i];</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;            elementJacobian_hu_hu[i][j] +=</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;                (i == j ? 1.0 : 0.0) * vel_test_dV[i];</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;            elementJacobian_hv_hv[i][j] +=</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;                (i == j ? 1.0 : 0.0) * vel_test_dV[i];</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;            elementJacobian_heta_heta[i][j] +=</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;                (i == j ? 1.0 : 0.0) * vel_test_dV[i];</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;            elementJacobian_hw_hw[i][j] +=</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;                (i == j ? 1.0 : 0.0) * vel_test_dV[i];</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;          } <span class="comment">// j</span></div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;        }   <span class="comment">// i</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;      }     <span class="comment">// k</span></div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;      <span class="comment">// load into element Jacobian into global Jacobian</span></div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      <span class="comment">//</span></div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nDOF_test_element; i++) {</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;        <span class="keyword">register</span> <span class="keywordtype">int</span> eN_i = eN * nDOF_test_element + i;</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; nDOF_trial_element; j++) {</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;          <span class="keyword">register</span> <span class="keywordtype">int</span> eN_i_j = eN_i * nDOF_trial_element + j;</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;          globalJacobian[csrRowIndeces_h_h[eN_i] +</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                         csrColumnOffsets_h_h[eN_i_j]] +=</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;              elementJacobian_h_h[i][j];</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;          globalJacobian[csrRowIndeces_hu_hu[eN_i] +</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                         csrColumnOffsets_hu_hu[eN_i_j]] +=</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;              elementJacobian_hu_hu[i][j];</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;          globalJacobian[csrRowIndeces_hv_hv[eN_i] +</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;                         csrColumnOffsets_hv_hv[eN_i_j]] +=</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;              elementJacobian_hv_hv[i][j];</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;          globalJacobian[csrRowIndeces_heta_heta[eN_i] +</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;                         csrColumnOffsets_heta_heta[eN_i_j]] +=</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;              elementJacobian_heta_heta[i][j];</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;          globalJacobian[csrRowIndeces_hw_hw[eN_i] +</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;                         csrColumnOffsets_hw_hw[eN_i_j]] +=</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;              elementJacobian_hw_hw[i][j];</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        } <span class="comment">// j</span></div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;      }   <span class="comment">// i</span></div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;    }     <span class="comment">// elements</span></div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;  }</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;}; <span class="comment">// GN_SW2DCV</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160; </div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="keyword">inline</span> GN_SW2DCV_base *</div>
<div class="line"><a name="l02695"></a><span class="lineno"><a class="line" href="namespaceproteus.html#afa880cfc0ac7afc1b91a741c22125bee"> 2695</a></span>&#160;<a class="code" href="namespaceproteus.html#afa880cfc0ac7afc1b91a741c22125bee">newGN_SW2DCV</a>(<span class="keywordtype">int</span> nSpaceIn, <span class="keywordtype">int</span> nQuadraturePoints_elementIn,</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;             <span class="keywordtype">int</span> nDOF_mesh_trial_elementIn, <span class="keywordtype">int</span> nDOF_trial_elementIn,</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;             <span class="keywordtype">int</span> nDOF_test_elementIn, <span class="keywordtype">int</span> nQuadraturePoints_elementBoundaryIn,</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;             <span class="keywordtype">int</span> CompKernelFlag) {</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespaceproteus.html#aa081c1fed534df492023f0a486d093c6">proteus::chooseAndAllocateDiscretization2D</a>&lt;<a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v__base.html">GN_SW2DCV_base</a>, <a class="code" href="classproteus_1_1_g_n___s_w2_d_c_v.html">GN_SW2DCV</a>,</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;                                                    <a class="code" href="class_comp_kernel.html">CompKernel</a>&gt;(</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;      nSpaceIn, nQuadraturePoints_elementIn, nDOF_mesh_trial_elementIn,</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;      nDOF_trial_elementIn, nDOF_test_elementIn,</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;      nQuadraturePoints_elementBoundaryIn, CompKernelFlag);</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;}</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;} <span class="comment">// namespace proteus</span></div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160; </div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="preprocessor">#endif</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_a56334e68256a3ddcc4174259a0b4f456"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#a56334e68256a3ddcc4174259a0b4f456">proteus::GN_SW2DCV::FCTStep</a></div><div class="ttdeci">void FCTStep(double dt, int NNZ, int numDOFs, double *lumped_mass_matrix, double *h_old, double *hu_old, double *hv_old, double *heta_old, double *hw_old, double *b_dof, double *high_order_hnp1, double *high_order_hunp1, double *high_order_hvnp1, double *high_order_hetanp1, double *high_order_hwnp1, double *extendedSourceTerm_hu, double *extendedSourceTerm_hv, double *extendedSourceTerm_heta, double *extendedSourceTerm_hw, double *limited_hnp1, double *limited_hunp1, double *limited_hvnp1, double *limited_hetanp1, double *limited_hwnp1, int *csrRowIndeces_DofLoops, int *csrColumnOffsets_DofLoops, double *MassMatrix, double *dH_minus_dL, double *muH_minus_muL, double hEps, double *hReg, int LUMPED_MASS_MATRIX, double *dLow, double *hBT, double *huBT, double *hvBT, double *hetaBT, double *hwBT)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00684">GN_SW2DCV.h:684</a></div></div>
<div class="ttc" id="anamespaceproteus_html_aea851b1d02fbb510e83331beade83dbc"><div class="ttname"><a href="namespaceproteus.html#aea851b1d02fbb510e83331beade83dbc">proteus::fp</a></div><div class="ttdeci">double fp(const double &amp;g, const double &amp;h, const double &amp;hZ)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00098">GN_SW2DCV.h:98</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_ab50314b4fa3cd11d2ff906d644950a03"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ab50314b4fa3cd11d2ff906d644950a03">proteus::GN_SW2DCV_base::hwLow</a></div><div class="ttdeci">std::valarray&lt; double &gt; hwLow</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00164">GN_SW2DCV.h:164</a></div></div>
<div class="ttc" id="a_g_n___s_w2_d_c_v_8h_html_aa30b36303b632a14d8f23dd32b047922"><div class="ttname"><a href="_g_n___s_w2_d_c_v_8h.html#aa30b36303b632a14d8f23dd32b047922">GLOBAL_FCT</a></div><div class="ttdeci">#define GLOBAL_FCT</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00017">GN_SW2DCV.h:17</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html">proteus::GN_SW2DCV_base</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00161">GN_SW2DCV.h:161</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_a0c51babf87fb6d6c3d6572191440eed4"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#a0c51babf87fb6d6c3d6572191440eed4">proteus::GN_SW2DCV::calculateMassMatrix</a></div><div class="ttdeci">void calculateMassMatrix(double *mesh_trial_ref, double *mesh_grad_trial_ref, double *mesh_dof, double *mesh_velocity_dof, double MOVING_DOMAIN, int *mesh_l2g, double *dV_ref, double *h_trial_ref, double *h_grad_trial_ref, double *h_test_ref, double *h_grad_test_ref, double *vel_trial_ref, double *vel_grad_trial_ref, double *vel_test_ref, double *vel_grad_test_ref, double *mesh_trial_trace_ref, double *mesh_grad_trial_trace_ref, double *dS_ref, double *h_trial_trace_ref, double *h_grad_trial_trace_ref, double *h_test_trace_ref, double *h_grad_test_trace_ref, double *vel_trial_trace_ref, double *vel_grad_trial_trace_ref, double *vel_test_trace_ref, double *vel_grad_test_trace_ref, double *normal_ref, double *boundaryJac_ref, double *elementDiameter, int nElements_global, double useRBLES, double useMetrics, double alphaBDF, double nu, double g, int *h_l2g, int *vel_l2g, double *b_dof, double *h_dof, double *hu_dof, double *hv_dof, double *heta_dof, double *hw_dof, double *h_dof_sge, double *hu_dof_sge, double *hv_dof_sge, double *heta_dof_sge, double *hw_dof_sge, double *q_mass_acc_beta_bdf, double *q_mom_hu_acc_beta_bdf, double *q_mom_hv_acc_beta_bdf, double *q_cfl, int *sdInfo_hu_hu_rowptr, int *sdInfo_hu_hu_colind, int *sdInfo_hu_hv_rowptr, int *sdInfo_hu_hv_colind, int *sdInfo_hv_hv_rowptr, int *sdInfo_hv_hv_colind, int *sdInfo_hv_hu_rowptr, int *sdInfo_hv_hu_colind, int *csrRowIndeces_h_h, int *csrColumnOffsets_h_h, int *csrRowIndeces_h_hu, int *csrColumnOffsets_h_hu, int *csrRowIndeces_h_hv, int *csrColumnOffsets_h_hv, int *csrRowIndeces_h_heta, int *csrColumnOffsets_h_heta, int *csrRowIndeces_h_hw, int *csrColumnOffsets_h_hw, int *csrRowIndeces_hu_h, int *csrColumnOffsets_hu_h, int *csrRowIndeces_hu_hu, int *csrColumnOffsets_hu_hu, int *csrRowIndeces_hu_hv, int *csrColumnOffsets_hu_hv, int *csrRowIndeces_hu_heta, int *csrColumnOffsets_hu_heta, int *csrRowIndeces_hu_hw, int *csrColumnOffsets_hu_hw, int *csrRowIndeces_hv_h, int *csrColumnOffsets_hv_h, int *csrRowIndeces_hv_hu, int *csrColumnOffsets_hv_hu, int *csrRowIndeces_hv_hv, int *csrColumnOffsets_hv_hv, int *csrRowIndeces_hv_heta, int *csrColumnOffsets_hv_heta, int *csrRowIndeces_hv_hw, int *csrColumnOffsets_hv_hw, int *csrRowIndeces_heta_h, int *csrColumnOffsets_heta_h, int *csrRowIndeces_heta_hu, int *csrColumnOffsets_heta_hu, int *csrRowIndeces_heta_hv, int *csrColumnOffsets_heta_hv, int *csrRowIndeces_heta_heta, int *csrColumnOffsets_heta_heta, int *csrRowIndeces_heta_hw, int *csrColumnOffsets_heta_hw, int *csrRowIndeces_hw_h, int *csrColumnOffsets_hw_h, int *csrRowIndeces_hw_hu, int *csrColumnOffsets_hw_hu, int *csrRowIndeces_hw_hv, int *csrColumnOffsets_hw_hv, int *csrRowIndeces_hw_heta, int *csrColumnOffsets_hw_heta, int *csrRowIndeces_hw_hw, int *csrColumnOffsets_hw_hw, double *globalJacobian, int nExteriorElementBoundaries_global, int *exteriorElementBoundariesArray, int *elementBoundaryElementsArray, int *elementBoundaryLocalElementBoundariesArray, int *isDOFBoundary_h, int *isDOFBoundary_hu, int *isDOFBoundary_hv, int *isAdvectiveFluxBoundary_h, int *isAdvectiveFluxBoundary_hu, int *isAdvectiveFluxBoundary_hv, int *isDiffusiveFluxBoundary_hu, int *isDiffusiveFluxBoundary_hv, double *ebqe_bc_h_ext, double *ebqe_bc_flux_mass_ext, double *ebqe_bc_flux_mom_hu_adv_ext, double *ebqe_bc_flux_mom_hv_adv_ext, double *ebqe_bc_hu_ext, double *ebqe_bc_flux_hu_diff_ext, double *ebqe_penalty_ext, double *ebqe_bc_hv_ext, double *ebqe_bc_flux_hv_diff_ext, int *csrColumnOffsets_eb_h_h, int *csrColumnOffsets_eb_h_hu, int *csrColumnOffsets_eb_h_hv, int *csrColumnOffsets_eb_hu_h, int *csrColumnOffsets_eb_hu_hu, int *csrColumnOffsets_eb_hu_hv, int *csrColumnOffsets_eb_hv_h, int *csrColumnOffsets_eb_hv_hu, int *csrColumnOffsets_eb_hv_hv, double dt)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l02376">GN_SW2DCV.h:2376</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html">proteus::GN_SW2DCV</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00442">GN_SW2DCV.h:442</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a5eb23919a33f36a2faf26440020d0a70"><div class="ttname"><a href="namespaceproteus.html#a5eb23919a33f36a2faf26440020d0a70">proteus::DENTROPY_DHU</a></div><div class="ttdeci">double DENTROPY_DHU(const double &amp;g, const double &amp;h, const double &amp;hu, const double &amp;hv, const double &amp;z, const double &amp;one_over_hReg)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00065">GN_SW2DCV.h:65</a></div></div>
<div class="ttc" id="anamespaceproteus_html_aafdd121958af52516e1f8564c737cbf3"><div class="ttname"><a href="namespaceproteus.html#aafdd121958af52516e1f8564c737cbf3">proteus::nu1</a></div><div class="ttdeci">double nu1(const double &amp;g, const double &amp;hStar, const double &amp;hL, const double &amp;uL)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00108">GN_SW2DCV.h:108</a></div></div>
<div class="ttc" id="anamespaceproteus_html_aa7382e6e38581baca5f477ee2d1a4ed4"><div class="ttname"><a href="namespaceproteus.html#aa7382e6e38581baca5f477ee2d1a4ed4">proteus::DENTROPY_DH</a></div><div class="ttdeci">double DENTROPY_DH(const double &amp;g, const double &amp;h, const double &amp;hu, const double &amp;hv, const double &amp;z, const double &amp;one_over_hReg)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00060">GN_SW2DCV.h:60</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_a6cf917d2db4b144bf075f553cbdfa4b0"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#a6cf917d2db4b144bf075f553cbdfa4b0">proteus::GN_SW2DCV::maxWaveSpeedSharpInitialGuess</a></div><div class="ttdeci">double maxWaveSpeedSharpInitialGuess(double g, double nx, double ny, double hL, double huL, double hvL, double hetaL, double lumpedL, double hR, double huR, double hvR, double hetaR, double lumpedR, double hEpsL, double hEpsR, bool debugging)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00456">GN_SW2DCV.h:456</a></div></div>
<div class="ttc" id="a_g_n___s_w2_d_c_v_8h_html_a10b9177dd08eb7e17dd16dba2a85fc3a"><div class="ttname"><a href="_g_n___s_w2_d_c_v_8h.html#a10b9177dd08eb7e17dd16dba2a85fc3a">IF_BOTH_GAMMA_BRANCHES</a></div><div class="ttdeci">#define IF_BOTH_GAMMA_BRANCHES</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00022">GN_SW2DCV.h:22</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a8ebe05e69da454ff3b5aa0f5bb3380ed"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8ebe05e69da454ff3b5aa0f5bb3380ed">proteus::GN_SW2DCV_base::Kmax</a></div><div class="ttdeci">std::valarray&lt; double &gt; Kmax</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00164">GN_SW2DCV.h:164</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_afdf2d43350bcdab191ab3bb4a732f878"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#afdf2d43350bcdab191ab3bb4a732f878">proteus::GN_SW2DCV::ck</a></div><div class="ttdeci">CompKernelType ck</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00445">GN_SW2DCV.h:445</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a7e1ecdf9f3e951f87bceb7cfca83da43"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7e1ecdf9f3e951f87bceb7cfca83da43">proteus::GN_SW2DCV_base::huLow</a></div><div class="ttdeci">std::valarray&lt; double &gt; huLow</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00163">GN_SW2DCV.h:163</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a46345003835ebf7457943566b7755817"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a46345003835ebf7457943566b7755817">proteus::GN_SW2DCV_base::Rneg_heta</a></div><div class="ttdeci">std::valarray&lt; double &gt; Rneg_heta</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00163">GN_SW2DCV.h:163</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a5057a84e11f2ba39c1a4c4c722fcafab"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5057a84e11f2ba39c1a4c4c722fcafab">proteus::GN_SW2DCV_base::Rpos</a></div><div class="ttdeci">std::valarray&lt; double &gt; Rpos</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00163">GN_SW2DCV.h:163</a></div></div>
<div class="ttc" id="a_model_factory_8h_html"><div class="ttname"><a href="_model_factory_8h.html">ModelFactory.h</a></div></div>
<div class="ttc" id="a_comp_kernel_8h_html"><div class="ttname"><a href="_comp_kernel_8h.html">CompKernel.h</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a7667307f5ed3630618f22cc94c48d7af"><div class="ttname"><a href="namespaceproteus.html#a7667307f5ed3630618f22cc94c48d7af">proteus::phiDDiff1</a></div><div class="ttdeci">double phiDDiff1(const double &amp;g, const double &amp;h1k, const double &amp;h2k, const double &amp;hL, const double &amp;hR, const double &amp;uL, const double &amp;uR)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00124">GN_SW2DCV.h:124</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_afea0a969d6336488123fbd8330694e75"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#afea0a969d6336488123fbd8330694e75">proteus::GN_SW2DCV::calculateEdgeBasedCFL</a></div><div class="ttdeci">double calculateEdgeBasedCFL(double g, int numDOFsPerEqn, double *lumped_mass_matrix, double *h_dof_old, double *hu_dof_old, double *hv_dof_old, double *heta_dof_old, double *b_dof, int *csrRowIndeces_DofLoops, int *csrColumnOffsets_DofLoops, double hEps, double *hReg, double *Cx, double *Cy, double *CTx, double *CTy, double *dLow, double run_cfl, double *edge_based_cfl, int debug)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l01507">GN_SW2DCV.h:1507</a></div></div>
<div class="ttc" id="anamespaceproteus_html_ab14e2f847e0f10815ee8f083bfae1b0e"><div class="ttname"><a href="namespaceproteus.html#ab14e2f847e0f10815ee8f083bfae1b0e">proteus::GN_nu3</a></div><div class="ttdeci">double GN_nu3(const double &amp;g, const double &amp;hR, const double &amp;uR, const double &amp;etaR, const double &amp;meshSizeR)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00040">GN_SW2DCV.h:40</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a5eca81c279c34b9097f4b2982e8d327f"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a5eca81c279c34b9097f4b2982e8d327f">proteus::GN_SW2DCV_base::Rpos_heta</a></div><div class="ttdeci">std::valarray&lt; double &gt; Rpos_heta</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00163">GN_SW2DCV.h:163</a></div></div>
<div class="ttc" id="a_g_n___s_w2_d_c_v_8h_html_a0efbfaf22559b0d4d372bc67870a96bc"><div class="ttname"><a href="_g_n___s_w2_d_c_v_8h.html#a0efbfaf22559b0d4d372bc67870a96bc">VEL_FIX_POWER</a></div><div class="ttdeci">#define VEL_FIX_POWER</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00019">GN_SW2DCV.h:19</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a24e3549b98c861e0a822612a088a0d82"><div class="ttname"><a href="namespaceproteus.html#a24e3549b98c861e0a822612a088a0d82">proteus::phiDiff</a></div><div class="ttdeci">double phiDiff(const double &amp;g, const double &amp;h1k, const double &amp;h2k, const double &amp;hL, const double &amp;hR, const double &amp;uL, const double &amp;uR)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00118">GN_SW2DCV.h:118</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a1eb3932cf3ec78d9e5e0a63256d5378a"><div class="ttname"><a href="namespaceproteus.html#a1eb3932cf3ec78d9e5e0a63256d5378a">proteus::ENTROPY_FLUX1</a></div><div class="ttdeci">double ENTROPY_FLUX1(const double &amp;g, const double &amp;h, const double &amp;hu, const double &amp;hv, const double &amp;z, const double &amp;one_over_hReg)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00075">GN_SW2DCV.h:75</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_a95f449fbd959cfa2f867bc3362169d24"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#a95f449fbd959cfa2f867bc3362169d24">proteus::GN_SW2DCV::nDOF_test_X_trial_element</a></div><div class="ttdeci">const int nDOF_test_X_trial_element</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00444">GN_SW2DCV.h:444</a></div></div>
<div class="ttc" id="ajf_8h_html_ac6afabdc09a49a433ee19d8a9486056d"><div class="ttname"><a href="jf_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a></div><div class="ttdeci">#define min(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="jf_8h_source.html#l00071">jf.h:71</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a75eb6ad7fbb7f589b2e8a6b836e0bae2"><div class="ttname"><a href="namespaceproteus.html#a75eb6ad7fbb7f589b2e8a6b836e0bae2">proteus::nu3</a></div><div class="ttdeci">double nu3(const double &amp;g, const double &amp;hStar, const double &amp;hR, const double &amp;uR)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00113">GN_SW2DCV.h:113</a></div></div>
<div class="ttc" id="a_headers_8h_html_abb6e996fea4e5f276fdcec0c7d809274"><div class="ttname"><a href="_headers_8h.html#abb6e996fea4e5f276fdcec0c7d809274">v</a></div><div class="ttdeci">Double v</div><div class="ttdef"><b>Definition:</b> <a href="_headers_8h_source.html#l00095">Headers.h:95</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a77009295d486912b7757c95258ed6c1f"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a77009295d486912b7757c95258ed6c1f">proteus::GN_SW2DCV_base::calculateLumpedMassMatrix</a></div><div class="ttdeci">virtual void calculateLumpedMassMatrix(double *mesh_trial_ref, double *mesh_grad_trial_ref, double *mesh_dof, double *mesh_velocity_dof, double MOVING_DOMAIN, int *mesh_l2g, double *dV_ref, double *h_trial_ref, double *h_grad_trial_ref, double *h_test_ref, double *h_grad_test_ref, double *vel_trial_ref, double *vel_grad_trial_ref, double *vel_test_ref, double *vel_grad_test_ref, double *mesh_trial_trace_ref, double *mesh_grad_trial_trace_ref, double *dS_ref, double *h_trial_trace_ref, double *h_grad_trial_trace_ref, double *h_test_trace_ref, double *h_grad_test_trace_ref, double *vel_trial_trace_ref, double *vel_grad_trial_trace_ref, double *vel_test_trace_ref, double *vel_grad_test_trace_ref, double *normal_ref, double *boundaryJac_ref, double *elementDiameter, int nElements_global, double useRBLES, double useMetrics, double alphaBDF, double nu, double g, int *h_l2g, int *vel_l2g, double *b_dof, double *h_dof, double *hu_dof, double *hv_dof, double *h_dof_sge, double *hu_dof_sge, double *hv_dof_sge, double *q_mass_acc_beta_bdf, double *q_mom_hu_acc_beta_bdf, double *q_mom_hv_acc_beta_bdf, double *q_cfl, int *sdInfo_hu_hu_rowptr, int *sdInfo_hu_hu_colind, int *sdInfo_hu_hv_rowptr, int *sdInfo_hu_hv_colind, int *sdInfo_hv_hv_rowptr, int *sdInfo_hv_hv_colind, int *sdInfo_hv_hu_rowptr, int *sdInfo_hv_hu_colind, int *csrRowIndeces_h_h, int *csrColumnOffsets_h_h, int *csrRowIndeces_h_hu, int *csrColumnOffsets_h_hu, int *csrRowIndeces_h_hv, int *csrColumnOffsets_h_hv, int *csrRowIndeces_h_heta, int *csrColumnOffsets_h_heta, int *csrRowIndeces_h_hw, int *csrColumnOffsets_h_hw, int *csrRowIndeces_hu_h, int *csrColumnOffsets_hu_h, int *csrRowIndeces_hu_hu, int *csrColumnOffsets_hu_hu, int *csrRowIndeces_hu_hv, int *csrColumnOffsets_hu_hv, int *csrRowIndeces_hu_heta, int *csrColumnOffsets_hu_heta, int *csrRowIndeces_hu_hw, int *csrColumnOffsets_hu_hw, int *csrRowIndeces_hv_h, int *csrColumnOffsets_hv_h, int *csrRowIndeces_hv_hu, int *csrColumnOffsets_hv_hu, int *csrRowIndeces_hv_hv, int *csrColumnOffsets_hv_hv, int *csrRowIndeces_hv_heta, int *csrColumnOffsets_hv_heta, int *csrRowIndeces_hv_hw, int *csrColumnOffsets_hv_hw, int *csrRowIndeces_heta_h, int *csrColumnOffsets_heta_h, int *csrRowIndeces_heta_hu, int *csrColumnOffsets_heta_hu, int *csrRowIndeces_heta_hv, int *csrColumnOffsets_heta_hv, int *csrRowIndeces_heta_heta, int *csrColumnOffsets_heta_heta, int *csrRowIndeces_heta_hw, int *csrColumnOffsets_heta_hw, int *csrRowIndeces_hw_h, int *csrColumnOffsets_hw_h, int *csrRowIndeces_hw_hu, int *csrColumnOffsets_hw_hu, int *csrRowIndeces_hw_hv, int *csrColumnOffsets_hw_hv, int *csrRowIndeces_hw_heta, int *csrColumnOffsets_hw_heta, int *csrRowIndeces_hw_hw, int *csrColumnOffsets_hw_hw, double *globalJacobian, int nExteriorElementBoundaries_global, int *exteriorElementBoundariesArray, int *elementBoundaryElementsArray, int *elementBoundaryLocalElementBoundariesArray, int *isDOFBoundary_h, int *isDOFBoundary_hu, int *isDOFBoundary_hv, int *isAdvectiveFluxBoundary_h, int *isAdvectiveFluxBoundary_hu, int *isAdvectiveFluxBoundary_hv, int *isDiffusiveFluxBoundary_hu, int *isDiffusiveFluxBoundary_hv, double *ebqe_bc_h_ext, double *ebqe_bc_flux_mass_ext, double *ebqe_bc_flux_mom_hu_adv_ext, double *ebqe_bc_flux_mom_hv_adv_ext, double *ebqe_bc_hu_ext, double *ebqe_bc_flux_hu_diff_ext, double *ebqe_penalty_ext, double *ebqe_bc_hv_ext, double *ebqe_bc_flux_hv_diff_ext, int *csrColumnOffsets_eb_h_h, int *csrColumnOffsets_eb_h_hu, int *csrColumnOffsets_eb_h_hv, int *csrColumnOffsets_eb_hu_h, int *csrColumnOffsets_eb_hu_hu, int *csrColumnOffsets_eb_hu_hv, int *csrColumnOffsets_eb_hv_h, int *csrColumnOffsets_eb_hv_hu, int *csrColumnOffsets_eb_hv_hv, double dt)=0</div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_a9a5b6f98c97dc946c45efb8e1bd4f7d3"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#a9a5b6f98c97dc946c45efb8e1bd4f7d3">proteus::GN_SW2DCV::calculateLumpedMassMatrix</a></div><div class="ttdeci">void calculateLumpedMassMatrix(double *mesh_trial_ref, double *mesh_grad_trial_ref, double *mesh_dof, double *mesh_velocity_dof, double MOVING_DOMAIN, int *mesh_l2g, double *dV_ref, double *h_trial_ref, double *h_grad_trial_ref, double *h_test_ref, double *h_grad_test_ref, double *vel_trial_ref, double *vel_grad_trial_ref, double *vel_test_ref, double *vel_grad_test_ref, double *mesh_trial_trace_ref, double *mesh_grad_trial_trace_ref, double *dS_ref, double *h_trial_trace_ref, double *h_grad_trial_trace_ref, double *h_test_trace_ref, double *h_grad_test_trace_ref, double *vel_trial_trace_ref, double *vel_grad_trial_trace_ref, double *vel_test_trace_ref, double *vel_grad_test_trace_ref, double *normal_ref, double *boundaryJac_ref, double *elementDiameter, int nElements_global, double useRBLES, double useMetrics, double alphaBDF, double nu, double g, int *h_l2g, int *vel_l2g, double *b_dof, double *h_dof, double *hu_dof, double *hv_dof, double *h_dof_sge, double *hu_dof_sge, double *hv_dof_sge, double *q_mass_acc_beta_bdf, double *q_mom_hu_acc_beta_bdf, double *q_mom_hv_acc_beta_bdf, double *q_cfl, int *sdInfo_hu_hu_rowptr, int *sdInfo_hu_hu_colind, int *sdInfo_hu_hv_rowptr, int *sdInfo_hu_hv_colind, int *sdInfo_hv_hv_rowptr, int *sdInfo_hv_hv_colind, int *sdInfo_hv_hu_rowptr, int *sdInfo_hv_hu_colind, int *csrRowIndeces_h_h, int *csrColumnOffsets_h_h, int *csrRowIndeces_h_hu, int *csrColumnOffsets_h_hu, int *csrRowIndeces_h_hv, int *csrColumnOffsets_h_hv, int *csrRowIndeces_h_heta, int *csrColumnOffsets_h_heta, int *csrRowIndeces_h_hw, int *csrColumnOffsets_h_hw, int *csrRowIndeces_hu_h, int *csrColumnOffsets_hu_h, int *csrRowIndeces_hu_hu, int *csrColumnOffsets_hu_hu, int *csrRowIndeces_hu_hv, int *csrColumnOffsets_hu_hv, int *csrRowIndeces_hu_heta, int *csrColumnOffsets_hu_heta, int *csrRowIndeces_hu_hw, int *csrColumnOffsets_hu_hw, int *csrRowIndeces_hv_h, int *csrColumnOffsets_hv_h, int *csrRowIndeces_hv_hu, int *csrColumnOffsets_hv_hu, int *csrRowIndeces_hv_hv, int *csrColumnOffsets_hv_hv, int *csrRowIndeces_hv_heta, int *csrColumnOffsets_hv_heta, int *csrRowIndeces_hv_hw, int *csrColumnOffsets_hv_hw, int *csrRowIndeces_heta_h, int *csrColumnOffsets_heta_h, int *csrRowIndeces_heta_hu, int *csrColumnOffsets_heta_hu, int *csrRowIndeces_heta_hv, int *csrColumnOffsets_heta_hv, int *csrRowIndeces_heta_heta, int *csrColumnOffsets_heta_heta, int *csrRowIndeces_heta_hw, int *csrColumnOffsets_heta_hw, int *csrRowIndeces_hw_h, int *csrColumnOffsets_hw_h, int *csrRowIndeces_hw_hu, int *csrColumnOffsets_hw_hu, int *csrRowIndeces_hw_hv, int *csrColumnOffsets_hw_hv, int *csrRowIndeces_hw_heta, int *csrColumnOffsets_hw_heta, int *csrRowIndeces_hw_hw, int *csrColumnOffsets_hw_hw, double *globalJacobian, int nExteriorElementBoundaries_global, int *exteriorElementBoundariesArray, int *elementBoundaryElementsArray, int *elementBoundaryLocalElementBoundariesArray, int *isDOFBoundary_h, int *isDOFBoundary_hu, int *isDOFBoundary_hv, int *isAdvectiveFluxBoundary_h, int *isAdvectiveFluxBoundary_hu, int *isAdvectiveFluxBoundary_hv, int *isDiffusiveFluxBoundary_hu, int *isDiffusiveFluxBoundary_hv, double *ebqe_bc_h_ext, double *ebqe_bc_flux_mass_ext, double *ebqe_bc_flux_mom_hu_adv_ext, double *ebqe_bc_flux_mom_hv_adv_ext, double *ebqe_bc_hu_ext, double *ebqe_bc_flux_hu_diff_ext, double *ebqe_penalty_ext, double *ebqe_bc_hv_ext, double *ebqe_bc_flux_hv_diff_ext, int *csrColumnOffsets_eb_h_h, int *csrColumnOffsets_eb_h_hu, int *csrColumnOffsets_eb_h_hv, int *csrColumnOffsets_eb_hu_h, int *csrColumnOffsets_eb_hu_hu, int *csrColumnOffsets_eb_hu_hv, int *csrColumnOffsets_eb_hv_h, int *csrColumnOffsets_eb_hv_hu, int *csrColumnOffsets_eb_hv_hv, double dt)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l02535">GN_SW2DCV.h:2535</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a168fa7179bef9c8bff1dc8fbdf4737ca"><div class="ttname"><a href="namespaceproteus.html#a168fa7179bef9c8bff1dc8fbdf4737ca">proteus::ENTROPY</a></div><div class="ttdeci">double ENTROPY(const double &amp;g, const double &amp;h, const double &amp;hu, const double &amp;hv, const double &amp;z, const double &amp;one_over_hReg)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00054">GN_SW2DCV.h:54</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a2883fc0e26145438f8d6d901e5af539c"><div class="ttname"><a href="namespaceproteus.html#a2883fc0e26145438f8d6d901e5af539c">proteus::phiDDiff2</a></div><div class="ttdeci">double phiDDiff2(const double &amp;g, const double &amp;h1k, const double &amp;h2k, const double &amp;hL, const double &amp;hR, const double &amp;uL, const double &amp;uR)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00130">GN_SW2DCV.h:130</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_abaeb7eba7acf21a37856e253f038797b"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#abaeb7eba7acf21a37856e253f038797b">proteus::GN_SW2DCV::calculateCFL</a></div><div class="ttdeci">void calculateCFL(const double &amp;elementDiameter, const double &amp;g, const double &amp;h, const double &amp;hu, const double &amp;hv, const double hEps, double &amp;cfl)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00664">GN_SW2DCV.h:664</a></div></div>
<div class="ttc" id="a_headers_8h_html_a9d199fcfc162b9ad09d4c9426e713a74"><div class="ttname"><a href="_headers_8h.html#a9d199fcfc162b9ad09d4c9426e713a74">z</a></div><div class="ttdeci">Double * z</div><div class="ttdef"><b>Definition:</b> <a href="_headers_8h_source.html#l00049">Headers.h:49</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_aed27e87c230d38bbc89fae1fdb531795"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#aed27e87c230d38bbc89fae1fdb531795">proteus::GN_SW2DCV::convexLimiting</a></div><div class="ttdeci">void convexLimiting(double dt, int NNZ, int numDOFs, double *lumped_mass_matrix, double *h_old, double *hu_old, double *hv_old, double *heta_old, double *hw_old, double *b_dof, double *high_order_hnp1, double *high_order_hunp1, double *high_order_hvnp1, double *high_order_hetanp1, double *high_order_hwnp1, double *extendedSourceTerm_hu, double *extendedSourceTerm_hv, double *extendedSourceTerm_heta, double *extendedSourceTerm_hw, double *limited_hnp1, double *limited_hunp1, double *limited_hvnp1, double *limited_hetanp1, double *limited_hwnp1, int *csrRowIndeces_DofLoops, int *csrColumnOffsets_DofLoops, double *MassMatrix, double *dH_minus_dL, double *muH_minus_muL, double hEps, double *hReg, int LUMPED_MASS_MATRIX, double *dLow, double *hBT, double *huBT, double *hvBT, double *hetaBT, double *hwBT, double *new_SourceTerm_hu, double *new_SourceTerm_hv, double *new_SourceTerm_heta, double *new_SourceTerm_hw)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l01025">GN_SW2DCV.h:1025</a></div></div>
<div class="ttc" id="anamespaceproteus_html_adc5e96637123993f3be93306da696177"><div class="ttname"><a href="namespaceproteus.html#adc5e96637123993f3be93306da696177">proteus::GN_nu1</a></div><div class="ttdeci">double GN_nu1(const double &amp;g, const double &amp;hL, const double &amp;uL, const double &amp;etaL, const double &amp;meshSizeL)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00028">GN_SW2DCV.h:28</a></div></div>
<div class="ttc" id="a_headers_8h_html_a81073496b3df485c6b59c5823819310b"><div class="ttname"><a href="_headers_8h.html#a81073496b3df485c6b59c5823819310b">u</a></div><div class="ttdeci">Double u</div><div class="ttdef"><b>Definition:</b> <a href="_headers_8h_source.html#l00089">Headers.h:89</a></div></div>
<div class="ttc" id="a_headers_8h_html_aa0903c8c48f55ad539ee4e47f2d020ba"><div class="ttname"><a href="_headers_8h.html#aa0903c8c48f55ad539ee4e47f2d020ba">c</a></div><div class="ttdeci">Double c</div><div class="ttdef"><b>Definition:</b> <a href="_headers_8h_source.html#l00054">Headers.h:54</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a17bf106c5df3b1331ed2a18392384813"><div class="ttname"><a href="namespaceproteus.html#a17bf106c5df3b1331ed2a18392384813">proteus::phi</a></div><div class="ttdeci">double phi(const double &amp;g, const double &amp;h, const double &amp;hL, const double &amp;hR, const double &amp;uL, const double &amp;uR)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00094">GN_SW2DCV.h:94</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a7330c388dd299f1f57a761407b3f9803"><div class="ttname"><a href="namespaceproteus.html#a7330c388dd299f1f57a761407b3f9803">proteus::hStarLFromQuadPhiFromAbove</a></div><div class="ttdeci">double hStarLFromQuadPhiFromAbove(const double &amp;g, const double &amp;hStarL, const double &amp;hStarR, const double &amp;hL, const double &amp;hR, const double &amp;uL, const double &amp;uR)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00136">GN_SW2DCV.h:136</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a2446072986341eb3e593aca6beaf8b09"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a2446072986341eb3e593aca6beaf8b09">proteus::GN_SW2DCV_base::hetaLow</a></div><div class="ttdeci">std::valarray&lt; double &gt; hetaLow</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00164">GN_SW2DCV.h:164</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_af6240d87277608a214507e7580087dee"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#af6240d87277608a214507e7580087dee">proteus::GN_SW2DCV_base::calculateMassMatrix</a></div><div class="ttdeci">virtual void calculateMassMatrix(double *mesh_trial_ref, double *mesh_grad_trial_ref, double *mesh_dof, double *mesh_velocity_dof, double MOVING_DOMAIN, int *mesh_l2g, double *dV_ref, double *h_trial_ref, double *h_grad_trial_ref, double *h_test_ref, double *h_grad_test_ref, double *vel_trial_ref, double *vel_grad_trial_ref, double *vel_test_ref, double *vel_grad_test_ref, double *mesh_trial_trace_ref, double *mesh_grad_trial_trace_ref, double *dS_ref, double *h_trial_trace_ref, double *h_grad_trial_trace_ref, double *h_test_trace_ref, double *h_grad_test_trace_ref, double *vel_trial_trace_ref, double *vel_grad_trial_trace_ref, double *vel_test_trace_ref, double *vel_grad_test_trace_ref, double *normal_ref, double *boundaryJac_ref, double *elementDiameter, int nElements_global, double useRBLES, double useMetrics, double alphaBDF, double nu, double g, int *h_l2g, int *vel_l2g, double *b_dof, double *h_dof, double *hu_dof, double *hv_dof, double *heta_dof, double *hw_dof, double *h_dof_sge, double *hu_dof_sge, double *hv_dof_sge, double *heta_dof_sge, double *hw_dof_sge, double *q_mass_acc_beta_bdf, double *q_mom_hu_acc_beta_bdf, double *q_mom_hv_acc_beta_bdf, double *q_cfl, int *sdInfo_hu_hu_rowptr, int *sdInfo_hu_hu_colind, int *sdInfo_hu_hv_rowptr, int *sdInfo_hu_hv_colind, int *sdInfo_hv_hv_rowptr, int *sdInfo_hv_hv_colind, int *sdInfo_hv_hu_rowptr, int *sdInfo_hv_hu_colind, int *csrRowIndeces_h_h, int *csrColumnOffsets_h_h, int *csrRowIndeces_h_hu, int *csrColumnOffsets_h_hu, int *csrRowIndeces_h_hv, int *csrColumnOffsets_h_hv, int *csrRowIndeces_h_heta, int *csrColumnOffsets_h_heta, int *csrRowIndeces_h_hw, int *csrColumnOffsets_h_hw, int *csrRowIndeces_hu_h, int *csrColumnOffsets_hu_h, int *csrRowIndeces_hu_hu, int *csrColumnOffsets_hu_hu, int *csrRowIndeces_hu_hv, int *csrColumnOffsets_hu_hv, int *csrRowIndeces_hu_heta, int *csrColumnOffsets_hu_heta, int *csrRowIndeces_hu_hw, int *csrColumnOffsets_hu_hw, int *csrRowIndeces_hv_h, int *csrColumnOffsets_hv_h, int *csrRowIndeces_hv_hu, int *csrColumnOffsets_hv_hu, int *csrRowIndeces_hv_hv, int *csrColumnOffsets_hv_hv, int *csrRowIndeces_hv_heta, int *csrColumnOffsets_hv_heta, int *csrRowIndeces_hv_hw, int *csrColumnOffsets_hv_hw, int *csrRowIndeces_heta_h, int *csrColumnOffsets_heta_h, int *csrRowIndeces_heta_hu, int *csrColumnOffsets_heta_hu, int *csrRowIndeces_heta_hv, int *csrColumnOffsets_heta_hv, int *csrRowIndeces_heta_heta, int *csrColumnOffsets_heta_heta, int *csrRowIndeces_heta_hw, int *csrColumnOffsets_heta_hw, int *csrRowIndeces_hw_h, int *csrColumnOffsets_hw_h, int *csrRowIndeces_hw_hu, int *csrColumnOffsets_hw_hu, int *csrRowIndeces_hw_hv, int *csrColumnOffsets_hw_hv, int *csrRowIndeces_hw_heta, int *csrColumnOffsets_hw_heta, int *csrRowIndeces_hw_hw, int *csrColumnOffsets_hw_hw, double *globalJacobian, int nExteriorElementBoundaries_global, int *exteriorElementBoundariesArray, int *elementBoundaryElementsArray, int *elementBoundaryLocalElementBoundariesArray, int *isDOFBoundary_h, int *isDOFBoundary_hu, int *isDOFBoundary_hv, int *isAdvectiveFluxBoundary_h, int *isAdvectiveFluxBoundary_hu, int *isAdvectiveFluxBoundary_hv, int *isDiffusiveFluxBoundary_hu, int *isDiffusiveFluxBoundary_hv, double *ebqe_bc_h_ext, double *ebqe_bc_flux_mass_ext, double *ebqe_bc_flux_mom_hu_adv_ext, double *ebqe_bc_flux_mom_hv_adv_ext, double *ebqe_bc_hu_ext, double *ebqe_bc_flux_hu_diff_ext, double *ebqe_penalty_ext, double *ebqe_bc_hv_ext, double *ebqe_bc_flux_hv_diff_ext, int *csrColumnOffsets_eb_h_h, int *csrColumnOffsets_eb_h_hu, int *csrColumnOffsets_eb_h_hv, int *csrColumnOffsets_eb_hu_h, int *csrColumnOffsets_eb_hu_hu, int *csrColumnOffsets_eb_hu_hv, int *csrColumnOffsets_eb_hv_h, int *csrColumnOffsets_eb_hv_hu, int *csrColumnOffsets_eb_hv_hv, double dt)=0</div></div>
<div class="ttc" id="anamespaceproteus_html_afa880cfc0ac7afc1b91a741c22125bee"><div class="ttname"><a href="namespaceproteus.html#afa880cfc0ac7afc1b91a741c22125bee">proteus::newGN_SW2DCV</a></div><div class="ttdeci">GN_SW2DCV_base * newGN_SW2DCV(int nSpaceIn, int nQuadraturePoints_elementIn, int nDOF_mesh_trial_elementIn, int nDOF_trial_elementIn, int nDOF_test_elementIn, int nQuadraturePoints_elementBoundaryIn, int CompKernelFlag)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l02695">GN_SW2DCV.h:2695</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a475fb9d85bb327fe4849011189f20e62"><div class="ttname"><a href="namespaceproteus.html#a475fb9d85bb327fe4849011189f20e62">proteus::phip</a></div><div class="ttdeci">double phip(const double &amp;g, const double &amp;h, const double &amp;hL, const double &amp;hR)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00104">GN_SW2DCV.h:104</a></div></div>
<div class="ttc" id="aclass_comp_kernel_html"><div class="ttname"><a href="class_comp_kernel.html">CompKernel</a></div><div class="ttdef"><b>Definition:</b> <a href="_comp_kernel_8h_source.html#l00990">CompKernel.h:990</a></div></div>
<div class="ttc" id="anamespaceproteus_html_aa081c1fed534df492023f0a486d093c6"><div class="ttname"><a href="namespaceproteus.html#aa081c1fed534df492023f0a486d093c6">proteus::chooseAndAllocateDiscretization2D</a></div><div class="ttdeci">Model_Base * chooseAndAllocateDiscretization2D(int nSpaceIn, int nQuadraturePoints_elementIn, int nDOF_mesh_trial_elementIn, int nDOF_trial_elementIn, int nDOF_test_elementIn, int nDOF_v_trial_elementIn, int nDOF_v_test_elementIn, int nQuadraturePoints_elementBoundaryIn, int CompKernelFlag)</div><div class="ttdef"><b>Definition:</b> <a href="_mixed_model_factory_8h_source.html#l00308">MixedModelFactory.h:308</a></div></div>
<div class="ttc" id="a_g_n___s_w2_d_c_v_8h_html_a3452ab29367216c56ee2ef46257c22be"><div class="ttname"><a href="_g_n___s_w2_d_c_v_8h.html#a3452ab29367216c56ee2ef46257c22be">POWER_SMOOTHNESS_INDICATOR</a></div><div class="ttdeci">#define POWER_SMOOTHNESS_INDICATOR</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00018">GN_SW2DCV.h:18</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_ac6e00955095da826c07d5a65e419776c"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ac6e00955095da826c07d5a65e419776c">proteus::GN_SW2DCV_base::~GN_SW2DCV_base</a></div><div class="ttdeci">virtual ~GN_SW2DCV_base()</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00165">GN_SW2DCV.h:165</a></div></div>
<div class="ttc" id="anamespaceproteus_html"><div class="ttname"><a href="namespaceproteus.html">proteus</a></div><div class="ttdef"><b>Definition:</b> <a href="_a_d_r_8h_source.html#l00008">ADR.h:8</a></div></div>
<div class="ttc" id="anamespaceproteus_html_aa4fb5dbd416856817199520f28e815b6"><div class="ttname"><a href="namespaceproteus.html#aa4fb5dbd416856817199520f28e815b6">proteus::hStarRFromQuadPhiFromBelow</a></div><div class="ttdeci">double hStarRFromQuadPhiFromBelow(const double &amp;g, const double &amp;hStarL, const double &amp;hStarR, const double &amp;hL, const double &amp;hR, const double &amp;uL, const double &amp;uR)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00147">GN_SW2DCV.h:147</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a386032927cbf93a2e5f59548981f7fde"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a386032927cbf93a2e5f59548981f7fde">proteus::GN_SW2DCV_base::Rneg</a></div><div class="ttdeci">std::valarray&lt; double &gt; Rneg</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00163">GN_SW2DCV.h:163</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_ad8491c72b07674f0b84a021454406b36"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ad8491c72b07674f0b84a021454406b36">proteus::GN_SW2DCV_base::calculateResidual</a></div><div class="ttdeci">virtual void calculateResidual(double *mesh_trial_ref, double *mesh_grad_trial_ref, double *mesh_dof, double *mesh_velocity_dof, double MOVING_DOMAIN, int *mesh_l2g, double *dV_ref, double *h_trial_ref, double *h_grad_trial_ref, double *h_test_ref, double *h_grad_test_ref, double *vel_trial_ref, double *vel_grad_trial_ref, double *vel_test_ref, double *vel_grad_test_ref, double *mesh_trial_trace_ref, double *mesh_grad_trial_trace_ref, double *dS_ref, double *h_trial_trace_ref, double *h_grad_trial_trace_ref, double *h_test_trace_ref, double *h_grad_test_trace_ref, double *vel_trial_trace_ref, double *vel_grad_trial_trace_ref, double *vel_test_trace_ref, double *vel_grad_test_trace_ref, double *normal_ref, double *boundaryJac_ref, double *elementDiameter, int nElements_global, double useRBLES, double useMetrics, double alphaBDF, double nu, double g, int *h_l2g, int *vel_l2g, double *h_dof_old, double *hu_dof_old, double *hv_dof_old, double *heta_dof_old, double *hw_dof_old, double *b_dof, double *h_dof, double *hu_dof, double *hv_dof, double *heta_dof, double *hw_dof, double *h_dof_sge, double *hu_dof_sge, double *hv_dof_sge, double *heta_dof_sge, double *hw_dof_sge, double *q_mass_acc, double *q_mom_hu_acc, double *q_mom_hv_acc, double *q_mass_adv, double *q_mass_acc_beta_bdf, double *q_mom_hu_acc_beta_bdf, double *q_mom_hv_acc_beta_bdf, double *q_cfl, int *sdInfo_hu_hu_rowptr, int *sdInfo_hu_hu_colind, int *sdInfo_hu_hv_rowptr, int *sdInfo_hu_hv_colind, int *sdInfo_hv_hv_rowptr, int *sdInfo_hv_hv_colind, int *sdInfo_hv_hu_rowptr, int *sdInfo_hv_hu_colind, int offset_h, int offset_hu, int offset_hv, int offset_heta, int offset_hw, int stride_h, int stride_hu, int stride_hv, int stride_heta, int stride_hw, double *globalResidual, int nExteriorElementBoundaries_global, int *exteriorElementBoundariesArray, int *elementBoundaryElementsArray, int *elementBoundaryLocalElementBoundariesArray, int *isDOFBoundary_h, int *isDOFBoundary_hu, int *isDOFBoundary_hv, int *isAdvectiveFluxBoundary_h, int *isAdvectiveFluxBoundary_hu, int *isAdvectiveFluxBoundary_hv, int *isDiffusiveFluxBoundary_hu, int *isDiffusiveFluxBoundary_hv, double *ebqe_bc_h_ext, double *ebqe_bc_flux_mass_ext, double *ebqe_bc_flux_mom_hu_adv_ext, double *ebqe_bc_flux_mom_hv_adv_ext, double *ebqe_bc_hu_ext, double *ebqe_bc_flux_hu_diff_ext, double *ebqe_penalty_ext, double *ebqe_bc_hv_ext, double *ebqe_bc_flux_hv_diff_ext, double *q_velocity, double *ebqe_velocity, double *flux, double *elementResidual_h, double *Cx, double *Cy, double *CTx, double *CTy, int numDOFsPerEqn, int NNZ, int *csrRowIndeces_DofLoops, int *csrColumnOffsets_DofLoops, double *lumped_mass_matrix, double cfl_run, double hEps, double *hReg, double *hnp1_at_quad_point, double *hunp1_at_quad_point, double *hvnp1_at_quad_point, double *hetanp1_at_quad_point, double *hwnp1_at_quad_point, double *extendedSourceTerm_hu, double *extendedSourceTerm_hv, double *extendedSourceTerm_heta, double *extendedSourceTerm_hw, double *dH_minus_dL, double *muH_minus_muL, double cE, int LUMPED_MASS_MATRIX, double dt, int LINEAR_FRICTION, double mannings, double *quantDOFs, int SECOND_CALL_CALCULATE_RESIDUAL, int COMPUTE_NORMALS, double *normalx, double *normaly, double *dLow, double *hBT, double *huBT, double *hvBT, double *hetaBT, double *hwBT, int lstage, double *new_SourceTerm_hu, double *new_SourceTerm_hv, double *new_SourceTerm_heta, double *new_SourceTerm_hw)=0</div></div>
<div class="ttc" id="a_g_n___s_w2_d_c_v_8h_html_a21559f9cd7c5b706288915fff2559f5f"><div class="ttname"><a href="_g_n___s_w2_d_c_v_8h.html#a21559f9cd7c5b706288915fff2559f5f">LAMBDA_MGN</a></div><div class="ttdeci">#define LAMBDA_MGN</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00021">GN_SW2DCV.h:21</a></div></div>
<div class="ttc" id="anamespaceproteus_html_af05ccedae3a5249ffcee18ba28860db4"><div class="ttname"><a href="namespaceproteus.html#af05ccedae3a5249ffcee18ba28860db4">proteus::f</a></div><div class="ttdeci">double f(const double &amp;g, const double &amp;h, const double &amp;hZ)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00090">GN_SW2DCV.h:90</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_a293b9dac10d981553663f46a4e815674"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#a293b9dac10d981553663f46a4e815674">proteus::GN_SW2DCV::GN_SW2DCV</a></div><div class="ttdeci">GN_SW2DCV()</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00446">GN_SW2DCV.h:446</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v_html_aa0a53e618b89dc3e930acf7078c381a2"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v.html#aa0a53e618b89dc3e930acf7078c381a2">proteus::GN_SW2DCV::calculateResidual</a></div><div class="ttdeci">void calculateResidual(double *mesh_trial_ref, double *mesh_grad_trial_ref, double *mesh_dof, double *mesh_velocity_dof, double MOVING_DOMAIN, int *mesh_l2g, double *dV_ref, double *h_trial_ref, double *h_grad_trial_ref, double *h_test_ref, double *h_grad_test_ref, double *vel_trial_ref, double *vel_grad_trial_ref, double *vel_test_ref, double *vel_grad_test_ref, double *mesh_trial_trace_ref, double *mesh_grad_trial_trace_ref, double *dS_ref, double *h_trial_trace_ref, double *h_grad_trial_trace_ref, double *h_test_trace_ref, double *h_grad_test_trace_ref, double *vel_trial_trace_ref, double *vel_grad_trial_trace_ref, double *vel_test_trace_ref, double *vel_grad_test_trace_ref, double *normal_ref, double *boundaryJac_ref, double *elementDiameter, int nElements_global, double useRBLES, double useMetrics, double alphaBDF, double nu, double g, int *h_l2g, int *vel_l2g, double *h_dof_old, double *hu_dof_old, double *hv_dof_old, double *heta_dof_old, double *hw_dof_old, double *b_dof, double *h_dof, double *hu_dof, double *hv_dof, double *heta_dof, double *hw_dof, double *h_dof_sge, double *hu_dof_sge, double *hv_dof_sge, double *heta_dof_sge, double *hw_dof_sge, double *q_mass_acc, double *q_mom_hu_acc, double *q_mom_hv_acc, double *q_mass_adv, double *q_mass_acc_beta_bdf, double *q_mom_hu_acc_beta_bdf, double *q_mom_hv_acc_beta_bdf, double *q_cfl, int *sdInfo_hu_hu_rowptr, int *sdInfo_hu_hu_colind, int *sdInfo_hu_hv_rowptr, int *sdInfo_hu_hv_colind, int *sdInfo_hv_hv_rowptr, int *sdInfo_hv_hv_colind, int *sdInfo_hv_hu_rowptr, int *sdInfo_hv_hu_colind, int offset_h, int offset_hu, int offset_hv, int offset_heta, int offset_hw, int stride_h, int stride_hu, int stride_hv, int stride_heta, int stride_hw, double *globalResidual, int nExteriorElementBoundaries_global, int *exteriorElementBoundariesArray, int *elementBoundaryElementsArray, int *elementBoundaryLocalElementBoundariesArray, int *isDOFBoundary_h, int *isDOFBoundary_hu, int *isDOFBoundary_hv, int *isAdvectiveFluxBoundary_h, int *isAdvectiveFluxBoundary_hu, int *isAdvectiveFluxBoundary_hv, int *isDiffusiveFluxBoundary_hu, int *isDiffusiveFluxBoundary_hv, double *ebqe_bc_h_ext, double *ebqe_bc_flux_mass_ext, double *ebqe_bc_flux_mom_hu_adv_ext, double *ebqe_bc_flux_mom_hv_adv_ext, double *ebqe_bc_hu_ext, double *ebqe_bc_flux_hu_diff_ext, double *ebqe_penalty_ext, double *ebqe_bc_hv_ext, double *ebqe_bc_flux_hv_diff_ext, double *q_velocity, double *ebqe_velocity, double *flux, double *elementResidual_h_save, double *Cx, double *Cy, double *CTx, double *CTy, int numDOFsPerEqn, int NNZ, int *csrRowIndeces_DofLoops, int *csrColumnOffsets_DofLoops, double *lumped_mass_matrix, double cfl_run, double hEps, double *hReg, double *hnp1_at_quad_point, double *hunp1_at_quad_point, double *hvnp1_at_quad_point, double *hetanp1_at_quad_point, double *hwnp1_at_quad_point, double *extendedSourceTerm_hu, double *extendedSourceTerm_hv, double *extendedSourceTerm_heta, double *extendedSourceTerm_hw, double *dH_minus_dL, double *muH_minus_muL, double cE, int LUMPED_MASS_MATRIX, double dt, int LINEAR_FRICTION, double mannings, double *quantDOFs, int SECOND_CALL_CALCULATE_RESIDUAL, int COMPUTE_NORMALS, double *normalx, double *normaly, double *dLow, double *hBT, double *huBT, double *hvBT, double *hetaBT, double *hwBT, int lstage, double *new_SourceTerm_hu, double *new_SourceTerm_hv, double *new_SourceTerm_heta, double *new_SourceTerm_hw)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l01582">GN_SW2DCV.h:1582</a></div></div>
<div class="ttc" id="anamespaceproteus_html_a9db7dbbd169fd6f6b5a8d999bcdf9db1"><div class="ttname"><a href="namespaceproteus.html#a9db7dbbd169fd6f6b5a8d999bcdf9db1">proteus::DENTROPY_DHV</a></div><div class="ttdeci">double DENTROPY_DHV(const double &amp;g, const double &amp;h, const double &amp;hu, const double &amp;hv, const double &amp;z, const double &amp;one_over_hReg)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00070">GN_SW2DCV.h:70</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a7342dcea80aada49ec3c6e2c225501a4"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a7342dcea80aada49ec3c6e2c225501a4">proteus::GN_SW2DCV_base::hvLow</a></div><div class="ttdeci">std::valarray&lt; double &gt; hvLow</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00163">GN_SW2DCV.h:163</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a502f4f7aa291898c7da52a885c329295"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a502f4f7aa291898c7da52a885c329295">proteus::GN_SW2DCV_base::convexLimiting</a></div><div class="ttdeci">virtual void convexLimiting(double dt, int NNZ, int numDOFs, double *lumped_mass_matrix, double *h_old, double *hu_old, double *hv_old, double *heta_old, double *hw_old, double *b_dof, double *high_order_hnp1, double *high_order_hunp1, double *high_order_hvnp1, double *high_order_hetanp1, double *high_order_hwnp1, double *extendedSourceTerm_hu, double *extendedSourceTerm_hv, double *extendedSourceTerm_heta, double *extendedSourceTerm_hw, double *limited_hnp1, double *limited_hunp1, double *limited_hvnp1, double *limited_hetanp1, double *limited_hwnp1, int *csrRowIndeces_DofLoops, int *csrColumnOffsets_DofLoops, double *MassMatrix, double *dH_minus_dL, double *muH_minus_muL, double hEps, double *hReg, int LUMPED_MASS_MATRIX, double *dLow, double *hBT, double *huBT, double *hvBT, double *hetaBT, double *hwBT, double *new_SourceTerm_hu, double *new_SourceTerm_hv, double *new_SourceTerm_heta, double *new_SourceTerm_hw)=0</div></div>
<div class="ttc" id="anamespaceproteus_html_ac5017200ca551e2c3c646a25c6619391"><div class="ttname"><a href="namespaceproteus.html#ac5017200ca551e2c3c646a25c6619391">proteus::ENTROPY_FLUX2</a></div><div class="ttdeci">double ENTROPY_FLUX2(const double &amp;g, const double &amp;h, const double &amp;hu, const double &amp;hv, const double &amp;z, const double &amp;one_over_hReg)</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00082">GN_SW2DCV.h:82</a></div></div>
<div class="ttc" id="agroup__analytical_solutions_html_gaffe776513b24d84b39af8ab0930fef7f"><div class="ttname"><a href="group__analytical_solutions.html#gaffe776513b24d84b39af8ab0930fef7f">max</a></div><div class="ttdeci">#define max(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="analytical_solutions_8h_source.html#l00014">analyticalSolutions.h:14</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_ac6bd84763068cb470a81a333430bdf42"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#ac6bd84763068cb470a81a333430bdf42">proteus::GN_SW2DCV_base::FCTStep</a></div><div class="ttdeci">virtual void FCTStep(double dt, int NNZ, int numDOFs, double *lumped_mass_matrix, double *h_old, double *hu_old, double *hv_old, double *heta_old, double *hw_old, double *b_dof, double *high_order_hnp1, double *high_order_hunp1, double *high_order_hvnp1, double *high_order_hetanp1, double *high_order_hwnp1, double *extendedSourceTerm_hu, double *extendedSourceTerm_hv, double *extendedSourceTerm_heta, double *extendedSourceTerm_hw, double *limited_hnp1, double *limited_hunp1, double *limited_hvnp1, double *limited_hetanp1, double *limited_hwnp1, int *csrRowIndeces_DofLoops, int *csrColumnOffsets_DofLoops, double *MassMatrix, double *dH_minus_dL, double *muH_minus_muL, double hEps, double *hReg, int LUMPED_MASS_MATRIX, double *dLow, double *hBT, double *huBT, double *hvBT, double *hetaBT, double *hwBT)=0</div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a8056139265642caee29ad29ec52d5788"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a8056139265642caee29ad29ec52d5788">proteus::GN_SW2DCV_base::hLow</a></div><div class="ttdeci">std::valarray&lt; double &gt; hLow</div><div class="ttdef"><b>Definition:</b> <a href="_g_n___s_w2_d_c_v_8h_source.html#l00163">GN_SW2DCV.h:163</a></div></div>
<div class="ttc" id="a_headers_8h_html_acf2aa06bc881a993584c334b2b7c6e03"><div class="ttname"><a href="_headers_8h.html#acf2aa06bc881a993584c334b2b7c6e03">psi</a></div><div class="ttdeci">Double psi</div><div class="ttdef"><b>Definition:</b> <a href="_headers_8h_source.html#l00078">Headers.h:78</a></div></div>
<div class="ttc" id="aclassproteus_1_1_g_n___s_w2_d_c_v__base_html_a3ce25285b7615ee67d67513149711ed3"><div class="ttname"><a href="classproteus_1_1_g_n___s_w2_d_c_v__base.html#a3ce25285b7615ee67d67513149711ed3">proteus::GN_SW2DCV_base::calculateEdgeBasedCFL</a></div><div class="ttdeci">virtual double calculateEdgeBasedCFL(double g, int numDOFsPerEqn, double *lumped_mass_matrix, double *h_old, double *hu_old, double *hv_old, double *heta_old, double *b_dof, int *csrRowIndeces_DofLoops, int *csrColumnOffsets_DofLoops, double hEps, double *hReg, double *Cx, double *Cy, double *CTx, double *CTy, double *dLow, double run_cfl, double *edge_based_cfl, int debug)=0</div></div>
<div class="ttc" id="a_n_c_l_s3_p_8h_html_ac3a8009eac7340083df50a7d681f77bc"><div class="ttname"><a href="_n_c_l_s3_p_8h.html#ac3a8009eac7340083df50a7d681f77bc">cE</a></div><div class="ttdeci">#define cE</div><div class="ttdef"><b>Definition:</b> <a href="_n_c_l_s3_p_8h_source.html#l00008">NCLS3P.h:8</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jan 21 2020 21:07:08 for proteus by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
