dist: trusty
sudo: required

language: python

env:
- TEST_PROFILE="test.proteus.yaml"

python:
- 2.7

addons:
  apt:
    packages:
    - cmake
    - g++-4.8
    - gcc-4.8
    - gfortran
    - gfortran-4.8
    - gfortran-4.8-multilib
    - gfortran-4.8-doc
    - libgfortran3
    - libgfortran3-dbg
    - libxau6
    - libxdmcp6
    - libx11-6
    - libc6
    - libgcc-6-dev
    - libxcb1
    - libquadmath0
    - libquadmath0-dbg
    - dpkg

before_install:
- dpkg --list
- wget https://dl.dropboxusercontent.com/u/26353144/hashdist_trusty.tgz
- tar xzf hashdist_trusty.tgz 
- mv .hashdist $HOME

install:
- make hashdist
- make stack
- make stack/default.yaml
- FC=gfortran-4.8 CFLAGS='-w -fno-var-tracking-assignments' make install
- export PATH=$PWD/linux2/bin:$PATH
- export LD_LIBRARY_PATH=$PWD/linux2/lib:$PATH
- export SSL_CERT_DIR=/etc/ssl/certs
- ls $SSL_CERT_DIR

script:
- py.test --boxed -v linux2/lib/python2.7/site-packages/proteus-1.1.0-py2.7-linux-x86_64.egg/proteus/tests

notifications:
  email:
    on_success: change
    on_failure: always
